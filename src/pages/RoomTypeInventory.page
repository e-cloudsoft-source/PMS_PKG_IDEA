<!-- 予約ポップ -->
<apex:page controller="RoomTypeInventory" action="{!init}" id="RoomTypeInventory" 
sidebar="false" title="{!$Label.ps__msg_003_0097}">

<apex:stylesheet value="{!URLFOR($Resource.yahooFiles, 'css/skin.css')}"/>
<!-- 2019/04/30 予約ポップの在庫設定(AGT)の変更機能 BY zyz BEGIN -->
<apex:stylesheet value="{!URLFOR($Resource.kendoFiles, 'styles/kendo.common.min.css')}"/>
<apex:stylesheet value="{!URLFOR($Resource.kendoFiles, 'css/ui-lightness/jquery-ui-1.10.2.custom.min.css')}"/>
<apex:stylesheet value="{!URLFOR($Resource.kendoFiles, 'styles/kendo.default.min.css')}"/>
<!-- 2019/04/30 予約ポップの在庫設定(AGT)の変更機能 BY zyz END -->
<apex:includeScript value="{!URLFOR($Resource.yahooFiles, 'js/yahoo-dom-event.js')}"/>
<apex:includeScript value="{!URLFOR($Resource.yahooFiles, 'js/container-min.js')}"/>
<apex:includeScript value="{!URLFOR($Resource.yahooFiles, 'js/animation-min.js')}"/>
<apex:includeScript value="{!URLFOR($Resource.yahooFiles, 'js/dragdrop-min.js')}"/>
<!-- 2019/04/30 予約ポップの在庫設定(AGT)の変更機能 BY zyz BEGIN -->
<apex:includeScript value="{!URLFOR($Resource.kendoFiles, 'js/jquery.min.js')}"/>
<apex:includeScript value="{!URLFOR($Resource.kendoFiles, 'js/jquery-ui-1.10.2.custom.min.js')}"/>
<!-- 2019/04/30 予約ポップの在庫設定(AGT)の変更機能 BY zyz END -->
<apex:includeScript value="{!URLFOR($Resource.queryfiles, 'js/jquery.tablehover.min.js')}"/>
<apex:includeScript value="{!URLFOR($Resource.queryfiles, 'js/jquery.blockUI.js')}"/>
<apex:includeScript value="{!URLFOR($Resource.queryfiles, 'js/jquery.stickytableheaders.min.js')}"/>
<apex:includeScript value="{!URLFOR($Resource.dateplugin, 'date/date.js')}"/>
<!-- 2014/11/25 六曜計算追加 -->
<apex:includeScript value="{!URLFOR($Resource.dateplugin, 'date/qreki.js')}" />
<apex:includeScript value="{!URLFOR($Resource.dateplugin, 'date/qrekiHelp.js')}" /> <!-- 和暦LIBのサポート関数 -->
<!-- 2014/11/27 CKEDITOR追加 -->
<apex:includeScript value="{!URLFOR($Resource.ckeditor, 'ckeditor.js')}" />
<apex:includeScript value="{!URLFOR($Resource.ckeditor, 'util.js')}" />
<apex:includeScript value="{!URLFOR($Resource.kendoFiles, 'js/kendo.web.min.js')}"/>
<apex:includeScript value="{!$Resource.CommJs}"/>
<apex:includeScript value="{!$Resource.planExtendPlug}"/>
<!-- 2015/07/10 KeyDefine追加 -->
<apex:includeScript value="{!URLFOR($Resource.queryfiles, 'js/keymaster.js')}"/>
<!-- 2019/10/30 予約ポップで表示されている残室数を期間指定してcsv出力 BY zyz BEGIN -->
<apex:includeScript value="{!URLFOR($Resource.csvexport,'kendoCsv/Blob.js')}"/>
<apex:includeScript value="{!URLFOR($Resource.csvexport,'kendoCsv/FileSaver.js')}"/>
<apex:includeScript value="{!URLFOR($Resource.csvexport,'kendoCsv/encoding.js')}"/>
<!-- 2019/10/30 予約ポップで表示されている残室数を期間指定してcsv出力 BY zyz END -->
<!-- 2016/06/09 共通JS定数を定義追加する -->
<c:CommHeaderComp loadJsLib="false"/>
<style>
td.hover, tr.hover{background-color: #69f !important;}
td.click, th.click{background-color: yellow;}
.leftPanel{
	/* 2020/08/15 予約画面、ブラウザの表示ズームによらず縦ずれします。 by zy BEGIN */
	{!IF(isHaveTravelInfo, 'min-width: 150px;', '')}
	/* 2020/08/15 予約画面、ブラウザの表示ズームによらず縦ずれします。 by zy END */
	white-space:nowrap;
}
.leftPanelItem {
	{!IF(isHaveTravelInfo, 'white-space:normal;', 'white-space:nowrap;')}
}
/**** Clear Icon Css ****/
.headerSearchClearButton {
	/*background-color: #fff;*/
	background-image: url('/img/alohaSkin/search_clear_sprite.png');
	background-repeat: no-repeat;
	cursor: pointer;
	display: inline-block;
	height: 16px;
	margin-top: 0px;
	margin-left: 0px;
	margin-right: 0px;
	overflow: hidden;
	position: relative;
	width: 16px;
}
/**** SF STYLE MODIFY *****/
.datatable{
	/*2020/04/30 bug fixed 6173 by zy BEGIN
	{!IF(isHaveTravelInfo && !isStockFlag, 'table-layout:fixed;', 'table-layout:auto;')}
	*/
	table-layout:auto;
	/*2020/04/30 bug fixed 6173 by zy END*/
	/* 2020/08/15 予約画面、ブラウザの表示ズームによらず縦ずれします。 by zy BEGIN */
	border-collapse: collapse;
	/* 2020/08/15 予約画面、ブラウザの表示ズームによらず縦ずれします。 by zy END */
}
.datePicker {
   position:fixed;
}
/* CKEDITOR RICH TEXTAREA CSS */
/*.cke_contents {
    height: 80px !important;
}*/
/* 2018/03/12 ラックレート部屋タイプ別の対応　by　zy　BEGIN */
.tierClass{
	position: absolute;
    width: 0;
    height: 0;
    top: 0;
    left: 0;
    border-style: solid;
    border-width: 4px;
    border-color: #1B8AF7  transparent transparent #1B8AF7 ;
    padding: 0;
    overflow: hidden;
    vertical-align: top;
}
#floatTierPanel{
	display: none;
}
#floatTierPanel > .foot {
	text-align: center;
	position: absolute;
    bottom: 0px;
    width: 100%;
}
.floatHead {
	width: 100%;
	position: fixed;
	background: rgba(14,14,14,.25);
	z-index: 3;
	bottom:0;
    left: 0;
    height:70px;
}
/* 2020/11/30 リアルAGT増返室ボタン機能新規追加 WGCH BEGIN */
#dTableAgt > .k-picker-wrap .k-select, .k-numeric-wrap .k-select, .k-dropdown-wrap .k-select{
	width: 1em !important;
}
#dTableAgt > .k-textbox, .k-autocomplete, .k-dropdown-wrap, .k-picker-wrap, .k-numeric-wrap {
    padding: 0 1em 0 0 !important;
}
#floatAgtPanel{
	display: none;
}
#floatAgtPanel > .foot {
	text-align: center;
	position: absolute;
    bottom: 0px;
    width: 100%;
}
.agtFootBtn{
	width: 200px;
	height: 30px;
	font-size: 20px;
	line-height: 30px;
	position: relative;
	text-transform: uppercase;
	padding: 0 10px 0 10px;
	display: inline-block;
	background: black;
	filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#d60041', endColorstr='#a90040',GradientType=0 );
	color: #fff;
	cursor: pointer;
	margin: 10px;
}
/* 2020/11/30 リアルAGT増返室ボタン機能新規追加 WGCH END */
.dataCell{
	position: relative;
	/* 2020/04/30 予約ポップの残室数画面を改修 WGCH BEGIN */
	{!IF(isRaceRateComFlg, 'padding: 1px !important;', '')}
	/* 2020/04/30 予約ポップの残室数画面を改修 WGCH END */
}
.roomtypepanel{
	position: absolute;
	z-index:1;
	position: absolute;
    top: 0;
    left: 70px;
    height: 185px;
    overflow-x: hidden;
    overflow-y: scroll;
    border-left: 2px solid lightgrey;
}
/* 2019/04/30 予約ポップの在庫設定(AGT)の変更機能 BY zyz BEGIN */
.roomtypepanel1{
	position: absolute;
	z-index:1;
    top: 0;
    left: 70px;
    height: 185px;
    overflow-x: hidden;
    overflow-y: scroll;
    border-left: 2px solid lightgrey;
}
/* 2019/04/30 予約ポップの在庫設定(AGT)の変更機能 BY zyz END */
.selectRow {
	background: lightgray;
}
.roomFunBtn{
	width: 200px;
    height: 50px;
    font-size: 20px;
    line-height: 50px;
	position: relative; 
	text-transform: uppercase;
	padding: 0 10px 0 10px;
	display: inline-block;
    background: black;
    filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#d60041', endColorstr='#a90040',GradientType=0 );
    color: #fff;
    cursor: pointer;
    margin: 10px;
}
 <apex:repeat var="tier" value="{!tierSetLst}" rendered="{!isTierFlag}">
 {!tier.tierName}{
 	background:{!tier.background};
 	color:{!tier.textColor};
 }
</apex:repeat>
/* 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz BEGIN */
.planpanel{
	position: absolute;
	z-index:1;
	position: absolute;
    top: 0;
    left: 70px;
    height: 185px;
    overflow-x: hidden;
    overflow-y: scroll;
    border-left: 2px solid lightgrey;
}
.PlanscheduleScreen{
	z-index: 10004;
    border: none;
    margin: 0px;
    padding: 0px;
    width: 100%;
    height: 100%;
    top: 0px;
    left: 0px;
    background-color: rgb(0, 0, 0);
    opacity: 0.6;
    cursor: wait;
    position: fixed;
    display:none;
}
 .changeClassPlan{
	background: lightskyblue !important;
}
.salesStatusPlan{
	color: red !important;
}
<apex:outputPanel id="BasePlanCssId">
.baseCls{
	{!IF(isBasePlanFlg, 'white-space:normal;', 'white-space:nowrap;')}
}
.oddCls {
	padding: 1px 1px 2px 2px;
	font-size: 100%;
	background-color: #f5f5f5;
}
.evenCls {
	background-color: #c5c5c5;
	padding: 1px 1px 2px 2px;
	font-size: 100%;
}
 /* 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz END */
.defaultTierClass {
  -moz-appearance: none;
  -webkit-appearance: none;
  appearance: none;
  border-radius: 0;
  margin: 0;
  padding: 0px 0px 0px 2px;
  vertical-align: middle;
  width:38px;
  height:20px;
}
 /* 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz BEGIN */
  <apex:repeat var="tier" value="{!tierSetLst}">

 {!tier.tierName}{
 	background:{!tier.background};
 	color:{!tier.textColor};
 }
</apex:repeat>
</apex:outputPanel>
 /* 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz END */
 /* 2018/03/12 ラックレート部屋タイプ別の対応　by　zy　END */
/* 2018/12/15 在庫調整と販売状態管理 by zy BEGIN */
 .changeClass{
	background: lightskyblue !important;
}
 .roomInput{
	font-size: 13px;
    width: calc(100% - 8px);
    line-height: 21px;
    height: 21px;
    text-align: center;
    background: transparent;
}
.changeTable{
	width: 100%;
	height:100%;
	margin: 0;
	border-collapse: separate;
	border-spacing: 0;
	empty-cells: show;
	border-width: 0;
	outline: 0;
}
.salesStatus{
	color: red !important;
}
/* 2018/12/15 在庫調整と販売状態管理 by zy END */
</style>
<script>
	// 2018/12/15 ルームインジケータ画面に連絡事項は１項目に変更対応 by cxw BEGIN
	CKEDITOR && (CKEDITOR.config.height = 80);
	// 2018/12/15 ルームインジケータ画面に連絡事項は１項目に変更対応 by cxw END
    $j=jQuery.noConflict();
    var useMode = {!orgPopWindowFlag};
	var JS_StayPersons = 1 * {!BLANKVALUE($Setup.CommDefine__c.ps__BookingMansDef__c,0)} + 1 * {!BLANKVALUE($Setup.CommDefine__c.ps__BookingFemailsDef__c,0)} + 1 * {!BLANKVALUE($Setup.CommDefine__c.ps__BookingChildrenDef__c,0)};
	
	// 2018/03/07 Security Check BEGIN
	//var timerInterval = 1*{!$Setup.CommDefine__c.ps__TimerSecond__c}*1000;
	var timerInterval = 1*{!JSENCODE(TEXT($Setup.CommDefine__c.ps__TimerSecond__c))}*1000;
	// 2018/03/07 Security Check END
	var intervalId = null;
	var _g_isCanUpdateFlg = {!(isCanUpdateLead)};
	// Js Event Bind
	function bindEvent() {
	    // TabelHover
        var numCols = $j("#dTable").find('tr')[0].cells.length;
		var numColsAgt = $j("#dTableAgt").length > 0 ? $j("#dTableAgt").find('tr')[0].cells.length+2 : 0;
        $j('#dTable').tableHover({
            colClass: 'hover',
            cellClass: 'hovercell',
            headCols: true,
            spanCols: false,
            ignoreCols: [1, numCols]
        });
        $j('#dTableAgt').tableHover({
            colClass: 'hover',
            cellClass: 'hovercell',
            headCols: true,
            ignoreCols: [1,2, (numColsAgt-1),numColsAgt]
        });
        
        // Booking Btn Click
		// 2020/05/29 bug fixed 6422 by zy BEGIN
		$j("input[name='bookingBtn']").unbind("click");
		$j("input[name='bookingBtn']").bind("click",function() {
		// 2020/05/29 bug fixed 6422 by zy END
        	if(!_g_isCanUpdateFlg)return;
			// 2020/04/30 複数のプランとそれぞれのプランの人数を選択し機能対応 WGCH BEGIN
			if (isBasePlanMode() && !("J_RACK_TIER_MAP" in window)) {
				getTierMap(this);
				return;
			}
			// 2020/04/30 複数のプランとそれぞれのプランの人数を選択し機能対応 WGCH END
        	$this = this;
        	// 2018/07/27 宿泊税計算 WGCH BEGIN
        	var roomspcd = $j($this).attr('roomspcd');
        	thisRoomSpcd = roomspcd == null || roomspcd == undefined ? "" : roomspcd;
        	// 2018/07/27 宿泊税計算 WGCH END
            //var p1 = $j(this).attr("stockDate");
            //var p2 = $j(this).attr("roomTypeId");
            //var p3 = $j(this).attr("roomTyNm");
            // Clean Form Value to InitValue
            $j("#formresetbtn").click();
            // 2015/10/28 プラン明細表示のRESET
            // Setup Value To Form
            if ( useMode ) {
            	planRest();
	            setValue($this);
            } else {
            	var p1 = $j(this).attr("stockDate");
	            var p2 = $j(this).attr("roomTypeId");
	            var p3 = $j(this).attr("roomTyNm");
            	// 予約人数自動設定(ラックレートの場合、画面選択する予約人数を設定する、残室する場合、予約の予約人数で設定を行う)
	            var stayPersons = $j("select[id$=':persionSel']").length > 0 ? $j("select[id$=':persionSel']").val() : JS_StayPersons;
	            var selPlanId = $j("select[id$=':pageModeType']").val();
				var selPlanNm = $j("#hidPlanNm").val();
				var selAccId = $j("#hidPlanAccId").val();
				var selHadRoomFlag = $j("#hidZeroFlag").val();
				if (selPlanNm == "") { selPlanId = ""; }
	            var travelId = $j(this).attr("travelId");
	            if (typeof travelId == "undefined") {
					travelId = '';
				}		
	            var messageObject = new Object();
	            messageObject["input[id$=hidTravelId]"] = travelId;
	            var entryDate = comDateFormat(new Date(p1), JINYACONNECT.DateFormat);
	            messageObject["[element=lead_EntryTime__c]"] = entryDate;
	            messageObject["input[id$=hidStartDays]"] = entryDate;
	            messageObject["[element=lead_refTypeOfRooms__c]"] = p3;
	            messageObject["input[id$=hidRefTypeOfRooms]"] = p2;
	            messageObject["td.refTypeOfRooms__c input[id$=lkid]"] = p2;
	            messageObject["td.refTypeOfRooms__c input[id$=lkold]"] = p3;
	            messageObject["input[element=lead_StayPersons__c]"] = stayPersons;
	            messageObject["input[id$=':planItem:plan']"] = selPlanNm;
	            messageObject["input[id$=':planItem:plan_lkid']"] = selPlanId;
	            messageObject["input[id$=':planItem:plan_lkold']"] = selPlanNm;
	            messageObject["input[id$=':planItem:plan_mod']"] = (selPlanNm != "") ? "1" : "0";
	            var planPrice = 0;
	            // 2019/03/29 JINYABUG-1527 bug fix by zy BEGIN
	            // baseplanの場合
	            var basePlanFlag = selPlanNm != "" && selAccId != "";
	            // 2019/03/29 JINYABUG-1527 bug fix by zy END
	            if (selPlanNm != "" && selAccId != ""){
		            messageObject["input[id$=':0:productName']"] = selPlanNm;
		            messageObject["input[id$=':0:hidProductId']"] = selAccId;
		            messageObject["input[id$=':0:hidProductNm']"] = selPlanNm;
		            messageObject["input[id$=':0:hidActionType']"] = 'プラン';
		            messageObject["input[id$=':0:orderNums']"] = stayPersons;
			    	planPrice = commUtils.deleteRightZero($j("#hidPlanPrice").val(), JINYACONNECT.NumberPointLen),
	            	serviceTax = $j("#hidServicePriceIncTax").val(),
	            	specialTax = $j("#hidSpecialTax").val(),
	            	taxRate = $j("#hidTaxRate").val();
		            
		            messageObject["input[id$=':0:price']"] = planPrice;
		            var taxValLabel = (kendo.toString(commUtils.mathNumDiv(taxRate, 100), "{!JSENCODE(TaxNumberFormat)}"));
		            var serviceLabel = (kendo.toString(commUtils.mathNumDiv(serviceTax, 100), "{!JSENCODE(TaxNumberFormat)}"));
		            messageObject["input[id$=':0:hidTaxRateType']"] = taxRate;
		            messageObject["span[id$=':0:taxRateType']"] = taxValLabel;
		            messageObject["span[id$=':0:serviceRate']"] = serviceLabel;
		            
		            messageObject["input[id$=':0:hidServiceRate']"] = serviceTax;
		            messageObject["span[id$=':0:specialTax']"] = kendo.toString(specialTax, "p");
		            messageObject["input[id$=':0:hidSpecialTax']"] = specialTax;
		            messageObject["dispExtendImg('visible', 0)"] = function(){};
		            // 2019/03/29 JINYABUG-1527 bug fix by zy BEGIN
		            // messageObject["setupCalAmoutPrice(0,false)"] = function(){};
		          	// 2019/03/29 JINYABUG-1527 bug fix by zy END
	            }
	            // 2019/06/14 4.2.予約ポップからベースプランを選択した状態で新規予約作成をすると、予約見積明細に該当のプランが登録された状態で予約を取ることができますが、 by zy BEGIN
		    	messageObject["input[id$=':hidBasePlanId']"] = selPlanId;
	            messageObject["input[id$='hidBaseAccId']"] = selAccId;
	            // 2019/06/14 4.2.予約ポップからベースプランを選択した状態で新規予約作成をすると、予約見積明細に該当のプランが登録された状態で予約を取ることができますが、 by zy END
	            var curRate = 0;
	            // 該当プランの室料情報を格納する
				if ($j("#hidIsRateRateFlg").val() == "true") {
					var ratePrice = $j(this).val();
	            	curRate = commUtils.mathNumSub(ratePrice, planPrice);
	            	// 2019/03/29 JINYABUG-1561 bug fix by zy BEGIN
	            	messageObject["input[id$=':0:hidHadRoomFlag']"] = selHadRoomFlag == "true";
	            	/*
	            	後のバージョン、室料自動計算
					if (selPlanNm != "" && selAccId != "") {
						if (selHadRoomFlag == "true" && ratePrice != 0){
			            	messageObject["input[id$=':0:price']"] = ratePrice;
			            }
			        }
			        */
					// 2019/03/29 JINYABUG-1561 bug fix by zy END
					// 2020/04/30 6221 bug fix by zy BEGIN 
					// messageObject["#hidCurRackRatePrice"] = curRate;
					// 2020/04/30 6221 bug fix by zy END
			        // 2018/05/11 ラックレート設定の自動なしの場合故障修正 by ZY BEGIN
			        var syncInfo = $j("#hidPlanSyncInfo").val();
		            if (syncInfo != "") {
		            	if (curRate < 0) curRate = 0;
		            	syncInfo = syncInfo.replace('_price_',curRate);
		            	// 2018/07/27 宿泊税計算 WGCH BEGIN
		            	hotelData = JSON.parse($j("#hidHotelInfoJson").val());
		            	var pdInfoArr = hotelData.planItemPriceMap[selAccId]; // 获取当前Plan明细数据
		            	if(pdInfoArr){
		            		var syncArr = syncInfo.split(';');
		            		for(var i = 0; i < syncArr.length; i++){
		            			var pdArr = syncArr[i].split(':');
		            			if(!pdArr) continue;
		            			for(var n = 0; n < pdInfoArr.length; n++){
		            				var pd = pdInfoArr[n]; // 获取当前Plan明细
		            				if(pd[pdArr[0]] != undefined) hotelData.planItemPriceMap[selAccId][n][pdArr[0]] = pdArr[1].replaceAll(",","") * 1; // 替换最新设定值
		            			}
		            		}
		            	}
		            	// 2018/07/27 宿泊税計算 WGCH END
		            	messageObject["input[id$=':0:hidSyncInfo']"] = syncInfo;
		            }
		            // 2018/05/11 ラックレート設定の自動なしの場合故障修正 by ZY END
				} else {
					// 2020/05/29 エステなど商品を追加したプラン機能 WGCH BEGIN
					var raceRatePrice = $j(this).attr("raceRatePrice");
					if(!basePlanFlag && raceRatePrice) curRate = raceRatePrice;
					// 2020/05/29 エステなど商品を追加したプラン機能 WGCH END
				}
				
				// 2020/04/30 6221 bug fix by zy BEGIN 
				messageObject["#hidCurRackRatePrice"] = curRate;
				// 2020/04/30 6221 bug fix by zy END
				// 2019/06/15 新規予約を部屋ごとに時間と到着日をデフォルト設定 BY zyz BEGIN
				var defJson = $j("#hidDefJson").val();
				var defObj = defJson != "" ? JSON.parse(defJson) : undefined;
				if (defObj && (p2 in defObj)) {
					defObj[p2].forEach(function(def){
						messageObject["[element=lead_" + def.nm + "],[id$='" + def.nm + "']"] = def.val;
					});
				}
				// 2019/06/15 新規予約を部屋ごとに時間と到着日をデフォルト設定 BY zyz END
				// 2019/03/29 JINYABUG-1527 bug fix by zy BEGIN
				if (basePlanFlag) {
					// ウィンドウ開くの場合料金設定
					messageObject["initBaseplanCall(0," + curRate + ")"] = function(){};
					// 金額自動計算
	            	messageObject["showProduInfoToView(0)"] = function(){};
				}
				// 2020/04/03 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz BEGIN
				messageObject['input[id$=hidGuestType]'] = $("[id$=planVipStr]").val() || "";
				// 2020/04/03 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz END
	          	// 2019/03/29 JINYABUG-1527 bug fix by zy END
				$j("tr.tranDetailRow").show();
				SetDefaultValue(messageObject);
            }
            // Setup Value To Form
            YAHOO.force.com.showMe();
			// 2016/12/14 zyz CTI予約 BEGIN
			var $ctiContactInf = $j("input[id$=':ctiContactInf']");
			var ctiContactInf = $ctiContactInf.val();
			if(ctiContactInf != "") {
				cti_call_pasteInfo(null,ctiContactInf);
			}
			$ctiContactInf.val("");
			// 2016/12/14 zyz CTI予約 END
        });
        
		// Bind Event Clear
		/*
		if (useMode){
		$j("#cancelBtn").unbind("click");
		$j("img[name='accountPopup']").unbind("click");
		$j("img[name='roomPopup']").unbind("click");
		$j("input[id$=':relcontact']").unbind("blur");
		$j("[id$=':relcontact']").unbind("focus");
		$j("input[id$=':leadName']").unbind("focus");
		
        $j("#cancelBtn").click(function(e){
            // Error Message Panel Clear[Attention: Error Class IDはSF設定依存]
            //$j(".message").hide();
            $j("span[id$=':inputFormMsg']").hide();
            //$j(".ui-autocomplete").hide();
            //$j(".ui-autocomplete").empty();
            clearAutoCompletePanel();
            // 入力画面クリアする
            YAHOO.force.com.hideMe();
        });
		// 2013/10/07 一括予約入力項目統一するため、部屋割り当てるを削除する
		// 2013/10/18 回復する
	    $j("img[name='roomPopup']").click(function() {
            if (!checkRoomsNumber()) return false;
	        // 引き渡し値を設定して、選択画面を開く
	        ctrlNm = $j("input:text[id$=':broom:name']").get(0);
	        ctrlId = $j("input:hidden[id$=':broom:id']").get(0);
	        doBeforeSave();
	        ctrlDt = $j("input:hidden[id$=':hidStartDays']").val();
	        ctrlDt = comDateFormat(new Date(ctrlDt), 'yyyy-MM-dd');
	        // 出発日取得
	        ctlDeapartDt = $j("[id$=':departureDateItem:departureDate']").text();
	        ctlDeapartDt =  comDateFormat(new Date(ctlDeapartDt), 'yyyy-MM-dd');
	        var roomTypeId = $j("input:hidden[id$=':hidRoomType']").val();
	        var openUrl = "/apex/RoomSelector?pidx=" + roomTypeId + "&pdt=" + ctrlDt + "&pde=" +ctlDeapartDt ;
	        // 呼び出し順番とPOPUP画面の設定順番は必ず一致するが必要
	        objs = new Array(ctrlNm, ctrlId);
	        commUtils.popup(openUrl, "roomSelector", objs);
	    });
		// *****************************
		// 2015/10/28 CTI->PAST機能対応
		// *****************************
		//_call_pasteInfo();
	    
		// お客様情報を選択する
	    $j("img[name='accountPopup']").click(function() {
	        var lkfmVal = $j("form[id$=':createForm']").attr("id");
	        var lknmVal= $j("input[id$=':relcontact']").attr("id");
	        var lktpVal ="003";
	        var lksrchVal =  escape($j("input[id$=':relcontact']").val());
			var url = "/_ui/common/data/LookupPage?lkfm=" + lkfmVal + "&lknm=" +lknmVal + "&lktp=" + lktpVal; 
			openLookup(url, 670, '1', "&lksrch=" + lksrchVal);
	    });
		// お客名はクリアする場合、自動的にIDをクリアする
		$j("input[id$=':relcontact']").blur(function() {
			if ($j(this).val() == "") {
				$j("input[id$=':relcontact_lkid']").val("");
				$j("input[id$=':relcontact_lkold']").val("");
				$j("#relcontact_lkid_org").val("");
				$j("input[id$=':katakana']").val("");
				$j("input[id$=':kanaName']").val("");
				$j("input[id$=':custPhone']").val("");
			}
		});
		// 顧客変更する場合、顧客情報を自動取得、基本情報を画面に設定する　
		$j("[id$=':relcontact']").on('blur', function(){
			var $this = $j(this);
			// 設定内容が存在する場合
			if ($this.val() != "") {
		    	// Content Changed
			    //if ($this.attr("orgval") != $j("input[id$=':relcontact_lkid']").val()) {
			    if ($j("#relcontact_lkid_org").val().substring(0,15) != $j("input[id$=':relcontact_lkid']").val().substring(0,15)) {
			    	// お客様情報のID情報を格納する
			        //$this.attr("orgval",$j("input[id$=':relcontact_lkid']").val());
			        $j("#relcontact_lkid_org").val($j("input[id$=':relcontact_lkid']").val());
			        // 顧客情報を更新する
			        var contactId = $j("input[id$=':relcontact_lkid']").val();
			        var contactName = $this.val();
			        blockUi();
					// 既に定義する売価はプランカラ取得、画面に設定する
					Visualforce.remoting.Manager.invokeAction(
					"{!$RemoteAction.RoomTypeInventory.refreshContcatInfo}", contactId,contactName, function(result, event){
						if(event.type == 'exception') {
			                alert(event.message);
			            } else {
							// 取得するお客様情報を画面に設定する
							$j("input[id$=':katakana']").val(result.KatakanaName);
							$j("input[id$=':kanaName']").val(result.KanaName);
							$j("input[id$=':custPhone']").val(result.phone);
							// 予約名自動設定を行う
							autoSetupLeadName();
						}
						// 画面解除する
						unblock();
					});
				}
				
			};
		});
		// お客名にて、自動予約名に設定を行う
		$j("input[id$=':leadName']").focus(function() {
			autoSetupLeadName();
		});
		
		$j("#dTable,#dTableAgt").stickyTableHeaders();
		
		// Timer Define
		//startRunning();
	 	// プランを切り替えする場合、関連のプラン明細・非表示制御追加
	 	$j("input[id$=':plan']").unbind("change");
		$j("input[id$=':plan']").change(function () {
			// 2015/10/28 プラン明細表示のRESET
			planRest();
		})
		
		$j("#planCustomeBtn").unbind("jinyaPlanExtend");
		$j("#planCustomeBtn").jinyaPlanExtend({
	        selectorRoot : $j("#planCustomeBtn").parent().parent().parent().parent(),
	        planInputField : $j("input[id$=':planItem:plan_lkid']"),
	        colspanNum : 4,
	        planSetupSyncField : $j("input[id$=':nl_hidPlanDetailInfo']"),
	        startfun : blockUi,
	        endfun : unblock,
			actionOpenImg : "{!URLFOR($Resource.AppImages, 'extend/jiahao.png')}",
			actionCloseImg: "{!URLFOR($Resource.AppImages, 'extend/jianhao.png')}",
	        raceRateCalFunction : calRoomRateFun,
	        remotePlanQuery  : "{!$RemoteAction.RoomTypeInventory.getPlanDetailListById}",
	        remoteProdQuery  : "{!$RemoteAction.RoomTypeInventory.getArrayProductItemInfo}"
		});
			$j(".requiredCls").each(function(){
				$j(this).before($j("<span class='requiredBlockClass'/>"));
			});
			
			
		}*/
		// *****************************
		// HeaderのFloat機能対応
		// *****************************
		// 2020/08/15 予約画面、ブラウザの表示ズームによらず縦ずれします。 by zy BEGIN
		var stickTables = $j("#dTable,#dTableAgt");
		stickTables.stickyTableHeaders();
		var refreshStickyWidth = function(){
			$j("#dTable,#dTableAgt").each(function(){
				var stickTable = $j(this).data("plugin_stickyTableHeaders");
				// 2020/08/31 7470 bug fixed by zy BEGIN
				stickTable.setPositionValues();
				// 2020/08/31 7470 bug fixed by zy END
			});
		}
		stickTables.each(function(){
			var stickTable = $j(this).data("plugin_stickyTableHeaders");
			var befSetPosition = stickTable.setPositionValues;
			stickTable.setPositionValues = function(){
				befSetPosition.call(this);
				var positionType = this.$originalHeader.css("position"),
					styleStr = this.$originalHeader.attr("style"),
					d = this;
					e = d.$window.scrollTop();
				if (positionType == "fixed" && styleStr.replaceAll(" ","").indexOf(";top:") < 0) 
					d.$originalHeader.css("top",d.topOffset - (d.isWindowScrolling ? 0 : e));
			}
		});
		$j(window).resize(function(){
			if (window.outerWidth / window.innerWidth < 1)  $("div.bodyDiv,#dTable,#dTableAgt,#bodyTable").css("width","100%");
			else $("div.bodyDiv,#dTable,#dTableAgt,#bodyTable").css("width","1800");
			refreshStickyWidth();
		});
		refreshStickyWidth();
		// 2020/08/15 予約画面、ブラウザの表示ズームによらず縦ずれします。 by zy END
		// *****************************
		// 2015/10/28 CTI->PAST機能対応
		// *****************************
		_call_pasteInfo();	
		// Timer Define
		startRunning();
		// 2018/12/15 在庫調整と販売状態管理 by zy BEGIN
		refreshSalesBtns();
		// 2018/12/15 在庫調整と販売状態管理 by zy END
		// 2020/11/30 リアルAGT増返室ボタン機能新規追加 WGCH BEGIN
		setNumTextBoxFun();
		// 2020/11/30 リアルAGT増返室ボタン機能新規追加 WGCH END
    }
    // 2020/04/30 予約ポップの残室数画面を改修 WGCH BEGIN
    function openNewWindow(e){
    	var $btn = $j(e).parents("td.dataCell").find("input.btnCls");
		// 2020/05/29 bug fixed 6422 by zy BEGIN
		// 残室数出现重复click现象
    	if($btn.length > 0) $btn.click();
		event.stopImmediatePropagation();
		// 2020/05/29 bug fixed 6422 by zy END
    }
    // 2020/04/30 予約ポップの残室数画面を改修 WGCH END

    // Create a namespace for our custom functions
    YAHOO.namespace("force.com");

    // Function called when we want to show the dialog
    YAHOO.force.com.showMe = function() {
        document.getElementById("myPanel").style.display = "block";
        stopRunning();
        YAHOO.force.com.myDialog.show();
    	// CKEDITOR処理の呼び出し
   		CKEDITOR.jinya.initInstance($j, "ckeditorClass");
    }
    // Function called when we want to hide the dialog
    YAHOO.force.com.hideMe = function() {
    	startRunning();
	// 2020/04/30 複数のプランとそれぞれのプランの人数を選択し機能対応 WGCH BEGIN
		delete window.J_RACK_TIER_MAP;
	// 2020/04/30 複数のプランとそれぞれのプランの人数を選択し機能対応 WGCH END
        YAHOO.force.com.myDialog.hide();
    }

	// 2014/01/17 Schedule Panel Add
    // Function called when we want to show the dialog
    YAHOO.force.com.showSchedule = function(dtVal, tierName) {
    	if(!_g_isCanUpdateFlg) return;
    	$j("#scheduleFormresetbtn").click();
    	// CheckBox Clear
    	$j("input[name='weekOpts']:checked").removeAttr("checked");
		// 初期設定
        document.getElementById("schedule").style.display = "block";
        //document.getElementById("sch_startDate").value=dtVal;
        $j("input[id$=':sch_startDate']").val(dtVal);
        // 開始日
        // 2016/11/25 TIMEZON fix BEGIN by zh
        //var startDt = Date.parse(dtVal);
        var startDt = kendo.parseDate(dtVal,JINYACONNECT.DateFormat);
        // 2016/11/25 TIMEZON fix END by zh
        // 曜日
        var weekday = startDt.toString("dddd");
        // 日付
        //var selectday = startDt.toString("d");
        // 終了日
        var endDt = startDt;
        //document.getElementById("sch_endDate").value=endDt.toString('yyyy/MM/dd');
        $j("input[id$=':sch_endDate']").val(endDt.toString(JINYACONNECT.DateFormat));
        // 曜日初期値設定
        // 2019/04/30 予約ポップの在庫設定(AGT)の変更機能 BY zyz BEGIN
        // $j("#"+weekday).attr("checked", true);
        // 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz BEGIN
        // $j("#"+weekday).prop("checked", true);
        $j("input[name=weekOpts][id="+weekday+"]").prop("checked", true);
        // 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz END
        // 2019/04/30 予約ポップの在庫設定(AGT)の変更機能 BY zyz END
        //$j("#dayOfMonth").val(selectday);
        //$j("#dayOfWeek").val(weekday);
        // Tier初期値設定
        $j("#tierSelect").val(tierName);
        // 初期化設定
        //switchOption($j("#repeatWeek").val());
		stopRunning();
        YAHOO.force.com.schedule.show();
        // 2018/03/12 ラックレート部屋タイプ別の対応　by　zy　BEGIN
        initBindSchedule();
        // 2018/03/12 ラックレート部屋タイプ別の対応　by　zy　END
    }
	// 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz BEGIN
    YAHOO.force.com.showPlanSchedule = function(dtVal, tierName) {
    	if(!_g_isCanUpdateFlg) return;
    	// BEGIN
    	var floatPanel = $j("#floatTierPanel").attr("class");
    	if (floatPanel != undefined && floatPanel != "") {
    		if (window.confirm( "{!$label.MSG_9004}")) {
    			$j("#floatTierPanel").removeClass("floatHead");
    			cancelChgTier();
    		} else return;
    	}
    	// END
    	$j("#PlanscheduleFormresetbtn").click();
    	// CheckBox Clear
    	$j("input[name='PlanweekOpts']:checked").removeAttr("checked");
		// 初期設定
        document.getElementById("Planschedule").style.display = "block";
        $j("input[id$=':Plansch_startDate']").val(dtVal);
        // 開始日
        var startDt = kendo.parseDate(dtVal,JINYACONNECT.DateFormat);
        // 曜日
        var weekday = startDt.toString("dddd");
        // 日付
        //var selectday = startDt.toString("d");
        // 終了日
        var endDt = startDt;
        $j("input[id$=':Plansch_endDate']").val(endDt.toString(JINYACONNECT.DateFormat));
        // 曜日初期値設定
        $j("input[name=PlanweekOpts][value="+weekday+"]").prop("checked", true);
        // Tier初期値設定
        $j("#tierSelectId").val(tierName);
        // 初期化設定
		stopRunning();
        YAHOO.force.com.Planschedule.show();
        initBindPlanSchedule();
    }
    YAHOO.force.com.hidePlanSchedule = function() {
    	// ErrMessage Clear
    	$j("span[id$=':inputTierFormMsg']").hide();
    	startRunning();
        YAHOO.force.com.Planschedule.hide();
    }

	// 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz END
    // Function called when we want to hide the dialog
    YAHOO.force.com.hideSchedule = function() {
    	// ErrMessage Clear
    	$j("span[id$=':inputTierFormMsg']").hide();
    	startRunning();
        YAHOO.force.com.schedule.hide();
    }


	// 2014/01/17 LayOff Panel Add
    // Function called when we want to show the dialog
    // dtVal:  setup date
   	// staType: 通常/休館/全館貸切
    YAHOO.force.com.showLayoffPanel = function(dtVal, staType) {
    	if(!_g_isCanUpdateFlg) return;
        document.getElementById("layoffPanel").style.display = "block";
        //document.getElementById("layoff_startDate").value=dtVal;
        $j("input[id$=':layoff_startDate']").val(dtVal);
        // 2016/11/25 TIMEZON fix BEGIN by zh
        //var startDt = Date.parse(dtVal);
        var startDt = kendo.parseDate(dtVal,JINYACONNECT.DateFormat);
        // 2016/11/25 TIMEZON fix END by zh
        var endDt = startDt;
        //document.getElementById("layoff_endDate").value=endDt.toString('yyyy/MM/dd');
        $j("input[id$=':layoff_endDate']").val(endDt.toString(JINYACONNECT.DateFormat));
        // 通常・休館切り替え設定
        $j("input[name='roomstatusRadio']").each(function(){
        	if (this.value == staType) {
        		this.checked = true;
        		return false;	// Loop Break
        	}
        });
        /*
        $j("input[id$=':hidRestHotelStatus']").val(!isOpen);
        // Windowのタイトル設定
        if (isOpen) {
        	// 正常ー＞休館の場合
        	$j("span[id$=':restFormTitle']").text("休館期間設定");
        } else {
        	// 休館ー＞正常の場合
        	$j("span[id$=':restFormTitle']").text("通常期間設定");
        }*/
        stopRunning();
        YAHOO.force.com.layoffPanel.show();
    }

    // Function called when we want to hide the dialog
    YAHOO.force.com.hideLayoffPanel = function() {
    	startRunning();
        YAHOO.force.com.layoffPanel.hide();
    }
    
    // Function called when the DOM is ready to create the dialog,
    // render the dialog into the document body, add our dialog skin
    // css to the body tag, and wire up the buttons on our dialog
    YAHOO.force.com.init = function() {
        document.body.className = document.body.className + " yui-skin-sam";
        YAHOO.force.com.myDialog = new YAHOO.widget.Panel(
            "myPanel",  // The id of our dialog container
            {
                    width           :   660,    // You can play with this until it's right
                    visible         :   false,  // Should be invisible when rendered
                    draggable       :   true,   // Make the dialog draggable
                    close           :   false,  // Don't include a close title button
                    modal           :   true,   // Make it modal
                    fixedCenter     :   true,   // Keep centered if window is scrolled
                    zindex          :   4,     // Make sure it's on top of everything

                    // This line adds the appear/vanish fade effect
                    effect          :   {
                                          effect:YAHOO.widget.ContainerEffect.FADE,
                                          duration:0.35
                                        }
            }
         );

        // Render the dialog to the document.body level of the DOM
        YAHOO.force.com.myDialog.render(document.body);
        
		YAHOO.force.com.schedule = new YAHOO.widget.Panel(
            "schedule",  // The id of our dialog container
            {
                    width           :   660,    // You can play with this until it's right
                    visible         :   false,  // Should be invisible when rendered
                    draggable       :   true,   // Make the dialog draggable
                    close           :   false,  // Don't include a close title button
                    modal           :   true,   // Make it modal
                    fixedCenter     :   true,   // Keep centered if window is scrolled
                    zindex          :   4,     // Make sure it's on top of everything

                    // This line adds the appear/vanish fade effect
                    effect          :   {
                                          effect:YAHOO.widget.ContainerEffect.FADE,
                                          duration:0.35
                                        }
            }
         );

        // Render the dialog to the document.body level of the DOM
        YAHOO.force.com.schedule.render(document.body);
         // 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz BEGIN
		YAHOO.force.com.Planschedule = new YAHOO.widget.Panel(
            "Planschedule",  // The id of our dialog container
            {
                    width           :   660,    // You can play with this until it's right
                    visible         :   false,  // Should be invisible when rendered
                    draggable       :   true,   // Make the dialog draggable
                    close           :   false,  // Don't include a close title button
                    modal           :   true,   // Make it modal
                    fixedCenter     :   true,   // Keep centered if window is scrolled
                    zindex          :   4,     // Make sure it's on top of everything

                    // This line adds the appear/vanish fade effect
                    effect          :   {
                                          effect:YAHOO.widget.ContainerEffect.FADE,
                                          duration:0.35
                                        }
            }
         );
        // Render the dialog to the document.body level of the DOM
        YAHOO.force.com.Planschedule.render(document.body);
         // 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz END
        
		YAHOO.force.com.layoffPanel = new YAHOO.widget.Panel(
            "layoffPanel",  // The id of our dialog container
            {
                    width           :   660,    // You can play with this until it's right
                    visible         :   false,  // Should be invisible when rendered
                    draggable       :   true,   // Make the dialog draggable
                    close           :   false,  // Don't include a close title button
                    modal           :   true,   // Make it modal
                    fixedCenter     :   true,   // Keep centered if window is scrolled
                    zindex          :   4,     // Make sure it's on top of everything

                    // This line adds the appear/vanish fade effect
                    effect          :   {
                                          effect:YAHOO.widget.ContainerEffect.FADE,
                                          duration:0.35
                                        }
            }
         );

        // Render the dialog to the document.body level of the DOM
        YAHOO.force.com.layoffPanel.render(document.body); 
    }

    // Add the init method to the window.load event
    //YAHOO.util.Event.addListener(window, "load", YAHOO.force.com.init);
    function comDateFormat(date, format){
    	return kendo.toString(date, format );
    	/*
        var result = format;
        var f;
        var rep;
        var yobi = new Array('日', '月', '火', '水', '木', '金', '土');
        f = 'yyyy';
        if ( result.indexOf(f) > -1 ) {
            rep = date.getFullYear();
            result = result.replace(/yyyy/, rep);
        }
        f = 'MM';
        if ( result.indexOf(f) > -1 ) {
            rep = comPadZero(date.getMonth() + 1, 2);
            result = result.replace(/MM/, rep);
        }
        f = 'ddd';
        if ( result.indexOf(f) > -1 ) {
            rep = yobi[date.getDay()];
            result = result.replace(/ddd/, rep);
        }
        f = 'dd';
        if ( result.indexOf(f) > -1 ) {
            rep = comPadZero(date.getDate(), 2);
            result = result.replace(/dd/, rep);
        }
        f = 'HH';
        if ( result.indexOf(f) > -1 ) {
            rep = comPadZero(date.getHours(), 2);
            result = result.replace(/HH/, rep);
        }
        f = 'mm';
        if ( result.indexOf(f) > -1 ) {
            rep = comPadZero(date.getMinutes(), 2);
            result = result.replace(/mm/, rep);
        }
        f = 'ss';
        if ( result.indexOf(f) > -1 ) {
            rep = comPadZero(date.getSeconds(), 2);
            result = result.replace(/ss/, rep);
        }
        f = 'fff';
        if ( result.indexOf(f) > -1 ) {
            rep = comPadZero(date.getMilliseconds(), 3);
            result = result.replace(/fff/, rep);
        }
        return result;*/
    }
    function comPadZero(value, length){
        return new Array(length - ('' + value).length + 1).join('0') + value;
    }
    //function setValue(p1,p2,p3){ 
	function setValue(obj) {
		var $btnObj = $j(obj);
        var p1 = $btnObj.attr("stockDate");
        var p2 = $btnObj.attr("roomTypeId");
        var p3 = $btnObj.attr("roomTyNm");
		var travelId = $btnObj.attr("travelId"); 	
		if (typeof travelId != "undefined") {
			$j("input[id$=':hidTravelId']").val(travelId);
		} else {
			$j("input[id$=':hidTravelId']").val("");
		}
        document.getElementById("RoomTypeInventory:createForm:createPageBlock:createPageBlockSection:entryDateItem:entryDate").innerHTML=comDateFormat(new Date(p1), JINYACONNECT.DateFormat);
        var hideItem = "{!$Component.createForm}:hidRoomType";
        document.getElementById(hideItem).value = p2;
        document.getElementById("RoomTypeInventory:createForm:createPageBlock:createPageBlockSection:refTypeOfRoomsItem:refTypeOfRooms").innerHTML=p3;
        // 初期値指定
        document.getElementById("RoomTypeInventory:createForm:createPageBlock:createPageBlockSection:leadNameItem:leadName").value="";
// 2013/10/07 一括予約入力項目統一するため、部屋割り当てるを削除する
//        document.getElementById("RoomTypeInventory:createForm:createPageBlock:createPageBlockSection:relcontactItem:relcontact_lkid").value="";
//        document.getElementById("RoomTypeInventory:createForm:createPageBlock:createPageBlockSection:relcontactItem:relcontact_lkold").value="";
//        document.getElementById("RoomTypeInventory:createForm:createPageBlock:createPageBlockSection:relcontactItem:relcontact").value="";
//        document.getElementById("RoomTypeInventory:createForm:createPageBlock:createPageBlockSection:relcontactItem:relcontact_mod").value="0";
        document.getElementById('{!$Component.RoomTypeInventory.createForm.createPageBlock.createPageBlockSection.relcontactItem.relcontact}').value = '';
        document.getElementById('{!$Component.RoomTypeInventory.createForm.createPageBlock.createPageBlockSection.relcontactItem.relcontact_lkid}').value = '';
		$j("input[id$=':relcontact_lkold']").val("");
		$j("#relcontact_lkid_org").val("");
// 2013/10/07 お客様関連項目内容をクリアする		
		$j("input[id$=':katakana']").val("");
		$j("input[id$=':kanaName']").val("");
		$j("input[id$=':custPhone']").val("");
// 2013/10/07 クリア機能補足項目を追加
		$j("select[id$=':paymentType']").val("");
		$j("select[id$=':chanelId']").val("");
		$j("input[id$=':seminarOrderFlg']").removeAttr('checked');
		$j("input[id$=':extrabedFlg']").removeAttr('checked');
// 2013/10/25 部屋存在する場合、街頭設定値をクリアする
		if ($j("input[id$=':broom:id']").length > 0) {
	        $j("input[id$=':broom:id']").val("");
	        $j("input[id$=':broom:name']").val("");
		}
        // 予約人数自動設定(ラックレートの場合、画面選択する予約人数を設定する、残室する場合、予約の予約人数で設定を行う)
        var stayPersons = $j("select[id$=':persionSel']").length > 0 ? $j("select[id$=':persionSel']").val() : JS_StayPersons;
        //document.getElementById("RoomTypeInventory:createForm:createPageBlock:createPageBlockSection:stayPersonItem:stayPerson").value=JS_StayPersons;
        document.getElementById("RoomTypeInventory:createForm:createPageBlock:createPageBlockSection:stayPersonItem:stayPerson").value=stayPersons;
        document.getElementById("RoomTypeInventory:createForm:createPageBlock:createPageBlockSection:staysNumsItem:staysNums").value="1";
        document.getElementById("RoomTypeInventory:createForm:createPageBlock:createPageBlockSection:bookingRoomsItem:bookingRooms").value="1";
// 2014/05/21 PLAN ID設定 BEGIN
//        document.getElementById("RoomTypeInventory:createForm:createPageBlock:createPageBlockSection:planItem:plan_lkid").value="";
//        document.getElementById("RoomTypeInventory:createForm:createPageBlock:createPageBlockSection:planItem:plan_lkold").value="";
//        document.getElementById("RoomTypeInventory:createForm:createPageBlock:createPageBlockSection:planItem:plan").value="";
//        document.getElementById("RoomTypeInventory:createForm:createPageBlock:createPageBlockSection:planItem:plan_mod").value="0";
		var selPlanId = $j("select[id$=':pageModeType']").val();
		var selPlanNm = $j("#hidPlanNm").val();
		if (selPlanNm == "") { selPlanId = ""; }
		$j("input[id$=':planItem:plan']").val(selPlanNm);
		$j("input[id$=':planItem:plan_lkid']").val(selPlanId);
		$j("input[id$=':planItem:plan_lkold']").val(selPlanNm);
		$j("input[id$=':planItem:plan_mod']").val( (selPlanNm != "") ? "1" : "0");
		// 該当プランの室料情報を格納する
		if ($j("#hidIsRateRateFlg").val() == "true") {
			$j("#hidRackratePrice").val($btnObj.val());
		} else {
			$j("#hidRackratePrice").val("0");
		}
// 2014/05/21 PLAN ID設定 END
        document.getElementById("RoomTypeInventory:createForm:createPageBlock:createPageBlockSection:segmentItem:segment").value="";
// 2013/10/07 一括予約入力項目統一するため、部屋割り当てるを削除する
//        document.getElementById("RoomTypeInventory:createForm:createPageBlock:createPageBlockSection:broom:id").value="";
//        document.getElementById("RoomTypeInventory:createForm:createPageBlock:createPageBlockSection:broom:name").value="";
        //document.getElementById("RoomTypeInventory:createForm:createPageBlock:createPageBlockSection2:comment3").value="";
        if(typeof editor != "undefined") editor.setData("");
        document.getElementById("RoomTypeInventory:createForm:createPageBlock:createPageBlockSection:departureDateItem:departureDate").innerHTML=comDateFormat(new Date((new Date(p1)).getTime() + 24*60*60*1000), JINYACONNECT.DateFormat);
    }
    function setDepartureDateAuto(){
        var starts = document.getElementById("RoomTypeInventory:createForm:createPageBlock:createPageBlockSection:entryDateItem:entryDate").innerHTML;
        var stays = document.getElementById("RoomTypeInventory:createForm:createPageBlock:createPageBlockSection:staysNumsItem:staysNums").value;
        document.getElementById("RoomTypeInventory:createForm:createPageBlock:createPageBlockSection:departureDateItem:departureDate").innerHTML=comDateFormat(new Date((new Date(starts)).getTime() + stays*24*60*60*1000), JINYACONNECT.DateFormat);
    }
    // 保存前処理
    function doBeforeSave() {
		// CKEDITOR情報は実勢の項目にコピーする
		CKEDITOR.jinya.copyValue($j, "ckeditorClass");
	
		if (!checkRoomsNumber()) return false;
		
        var hideItem = "{!$Component.createForm}:hidStartDays";
        document.getElementById(hideItem).value = document.getElementById("RoomTypeInventory:createForm:createPageBlock:createPageBlockSection:entryDateItem:entryDate").innerHTML;
        //$j(".ui-autocomplete").hide();
        //$j(".ui-autocomplete").empty();
        clearAutoCompletePanel();
        return true;
    }
    // 画面Lockする
    function blockUi() {
        $j.blockUI({
            //Processing...
             message: '<h1><img src="{!URLFOR($Resource.queryfiles, 'css/blockui/busy.gif')}" /> {!$Label.MSG_003_0099}</h1>'
        });
        return true;
    }
    // 画面Lock解除
    function unblock() {
        $j.unblockUI({ fadeOut: 200 }); 
    }
    // 選択する月分の在庫更新を行う
    function stockRefresh() {
        //宜しいでしょうか
       if (window.confirm('{!$Label.MSG_003_0014}')) {
           stockRefreshFun();
       }
    }
    // 予約データを登録処理後の自動処理
    function bookingCreateCallBack() {
    	if (useMode) {
    	var createResult = $j("input[id$=':hidDataCreateOK']").val();
    	if (createResult.toLowerCase() == "true") {
    		$j("input[id$=':hidDataCreateOK']").val("");
    		YAHOO.force.com.hideMe();
    	}
    	} else initFun();
    }
    function AfterFun(){
    	YAHOO.force.com.hideMe();
    	unblock();
    }
	// 予約名自動設定機能
	function autoSetupLeadName() {
		var contactName = $j("input[id$=':relcontact']").val();
		var leadName = $j("input[id$=':leadName']").val();
		if (leadName == "" && contactName != "") {
			$j("input[id$=':leadName']").val(contactName);
		}
	}
	/*
	function focusField(filedId) {
	    $j("[id$='"+filedId+"']").focus();
	}*/
	// ３０日間連泊情報照会画面起動
	function openBookingInfoWin() {
		// 指定日 // 支店コード
	    var branchCd = $j("select[id$=':branchShopCd']").length > 0 ? $j("select[id$=':branchShopCd']").val() : "";
	    window.open("/apex/RoomScheduleReport?spcd="+branchCd);
	}
    function syncSelectInfo (val, id) {
    	var key = "select[id$=':" + id + "']";
    	var objs = $j(key);
    	if (objs.length > 1) {
    		for (i =0; i < objs.length; i++) {
    			$j(objs[i]).val(val);
    		}
    	}
    }
    /*
    // Switch Option Function
    function switchOption(optVal) {
    	$j("#weekBlock").hide();
    	$j("#monthBlock").hide();
    	if (optVal == "week") {
    		$j("#weekBlock").show();
    	} else {
    		$j("#monthBlock").show();
    	}
    }*/
    function switchMonthOption(optVal) {
    	$j("#monthOfDay").attr("disabled", "disabled");
    	$j("#weekOfMonth").attr("disabled", "disabled");
    	$j("#dayOfWeek").attr("disabled", "disabled");
    	if (optVal == "month1") {
    		$j("#monthOfDay").removeAttr("disabled");
    	} else {
    		$j("#weekOfMonth").removeAttr("disabled");
    		$j("#dayOfWeek").removeAttr("disabled");
    	}
    }
    // 選択情報はHIDDEN項目へ反映する
    function createRaceRateFun() {

    	// Tier
    	var varTier = $j("#tierSelect").val();
    	// 頻度
    	var repeatType = $j("input[name='repeatDayType']:checked").val();
    	// PlanNm
    	var varPlanNm = $j("#planNmSelect").val();
    	
    	$j("input[id$=':hidTier']").val(varTier);
    	
    	// 毎週
    	if (repeatType == "week") {
    		//weekOpts
    		var weekdays = $j("input[name='weekOpts']:checked");
    		if (weekdays.length == 0) {
                //曜日を選択してください
    			alert("{!$Label.MSG_003_0015}");
    			return false;
    		}
    		// 
    		var weekopts = new Array();
    		weekdays.each(function(){
		        weekopts.push($j(this).val());
		    });
		    // 週別で設定
		    $j("input[id$=':hidRepeatType']").val(true);
		    // 毎週：月曜日〜日曜日
		    $j("input[id$=':hidWeekOpts']").val(weekopts.toString());
    	} 
    	// 毎月
    	else if(repeatType == "month"){
 		    // 週別で設定
		    $j("input[id$=':hidRepeatType']").val(false);
    		// repeatMonthType
    		var repeatMonthType = $j("input[name='repeatMonthType']:checked").val();
    		
    		if (repeatMonthType == "month1") {
    			// 1-31(最終)
    			var dayOfmonth = $j("select[id='dayOfMonth']").val();
    			
    			$j("input[id$=':hidIsDayOfMonth']").val(true);
    			$j("input[id$=':hidDayOfMonth']").val(dayOfmonth);
    		} else if(repeatMonthType == "month2") {
    			// 毎月X週Y曜日
    			var weekOfMonth = $j("select[id='weekOfMonth']").val();
    			var dayOfWeek = $j("select[id='dayOfWeek']").val();
    			
    			$j("input[id$=':hidIsDayOfMonth']").val(false);
    			$j("input[id$=':hidWeekOfMonth']").val(weekOfMonth);
    			$j("input[id$=':hidDayOfWeek']").val(dayOfWeek);
    		}
    	}
        // 2018/03/12 ラックレート部屋タイプ別の対応　by　zy　BEGIN
        // 2019/06/30 JINYABUG-1935 bug fix by zy BEGIN
    	var selLen = $j("div.roomtypepanel.rackset tr.selectRow").length;
    	var hadLen = $j("div.roomtypepanel.rackset tr.checkRow").length;
    	// 2019/06/30 JINYABUG-1935 bug fix by zy END
    	if (hadLen != selLen && selLen > 0) {
    		var selectArr = [];
    		// 2019/06/30 JINYABUG-1935 bug fix by zy BEGIN
	    	$j("div.roomtypepanel.rackset tr").not(".selectRow").each(function(){
	    	// 2019/06/30 JINYABUG-1935 bug fix by zy END
	    		selectArr.push($j(this).attr("name"));
	    	});
	    	if (selectArr.length > 0) {
	    		$j("input[id$=':hidRoomTypes']").val(selectArr.join(','));
	        }
        }
        // 2018/03/12 ラックレート部屋タイプ別の対応　by　zy　END
        // 2019/04/30 予約ポップの在庫設定(AGT)の変更機能 BY zyz BEGIN
    	var selLen1 = $j("div.roomtypepanel1 tr.selectRow").length;
    	var hadLen1 = $j("div.roomtypepanel1 tr.checkRows").length;
    	if (hadLen1 != selLen1 && selLen1 > 0) {
    		var selectArr = [];
	    	$j("div.roomtypepanel1 tr").not(".selectRow").each(function(){
	    		selectArr.push($j(this).attr("name"));
	    	});
	    	if (selectArr.length > 0) {
	    		$j("input[id$=':hidRoomTypes']").val(selectArr.join(','));
	        }
        }
        // 2019/04/30 予約ポップの在庫設定(AGT)の変更機能 BY zyz END
        // 開始日
        var varStartDt = $j("input[id$=':sch_startDate']").val();
        var varEndDt = $j("input[id$=':sch_endDate']").val();
        // 有効な日付をチェックする
        // 2016/11/25 TIMEZON fix BEGIN by zh
        //var startDt = Date.parse(varStartDt);
        var startDt = kendo.parseDate(varStartDt,JINYACONNECT.DateFormat);
        //var endDt = Date.parse(varEndDt);
        var endDt = kendo.parseDate(varEndDt,JINYACONNECT.DateFormat);
        // 2016/11/25 TIMEZON fix END by zh
        if (startDt == null || endDt == null) {
            //開始日付、終了日付に有効な日付の値を入力してください。
        	alert("{!$Label.MSG_003_0016}");
        	return false;
        }
        // 曜日
        var tmpEndDt = new Date(startDt.getTime());;
        if (tmpEndDt.addYears(1) < endDt ) {
            //設定期間は最大１年まで設定してください。
        	alert("{!$Label.MSG_003_0017}");
        	return false;
        }
        // 期間チェック
        if (startDt > endDt ) {
        	alert("{!$Label.ERR_0108}");
        	return false;
        }
    	$j("input[id$=':hidStartDate']").val(startDt.toString(JINYACONNECT.DateFormat));
    	$j("input[id$=':hidEndDate']").val(endDt.toString(JINYACONNECT.DateFormat));
    	// Call ActionFunction
    	scheduleSaveFun();
    }
    // 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz BEGIN
    // 選択情報はHIDDEN項目へ反映する
    function createPlanFun() {

    	// Tier
    	var varTier = $j("#tierSelectId").val();
    	// 頻度
    	var repeatType = $j("input[name='repeatDayType']:checked").val();
    	// PlanNm
    	// var varPlanNm = $j("#planNmSelect").val();
    	// 获取会员种别
    	var varVip = $j("#vipSelectId").val();
    	// 获取贩卖状态
    	var saleType = $j("#salesSelId").val();
    	
    	// $j("input[id$=':hidTier']").val(varTier);
    	
    	// 毎週
   		// 
   		var weekopts = new Array();
    	if (repeatType == "week") {
    		//weekOpts
    		var weekdays = $j("input[name='PlanweekOpts']:checked");
    		if (weekdays.length == 0) {
                //曜日を選択してください
    			alert("{!$Label.MSG_003_0015}");
    			return false;
    		}
    		weekdays.each(function(){
		        weekopts.push($j(this).val());
		    });
		    // 週別で設定
		    // $j("input[id$=':hidRepeatType']").val(true);
		    // 毎週：月曜日〜日曜日
		    // $j("input[id$=':hidWeekOpts']").val(weekopts.toString());
    	} 
    	var selLen1 = $j("div.planpanel tr.selectRow").length;
    	var hadLen1 = $j("div.planpanel tr.checkRow").length;
    	var selectArr = [];
    	if (hadLen1 > 0) {
	    	$j("div.planpanel tr").not(".selectRow").each(function(){
	    		// 2020/05/30 予約ポップラックレート設定[プラン]bug対応 BY zyz BEGIN
	    		if($j(this).is(":visible")) selectArr.push($j(this).attr("name"));
	    		// 2020/05/30 予約ポップラックレート設定[プラン]bug対応 BY zyz END
	    	});
        }
        // 開始日
        var varStartDt = $j("input[id$=':Plansch_startDate']").val();
        var varEndDt = $j("input[id$=':Plansch_endDate']").val();
        // 有効な日付をチェックする
        var startDt = kendo.parseDate(varStartDt,JINYACONNECT.DateFormat);
        var endDt = kendo.parseDate(varEndDt,JINYACONNECT.DateFormat);
        if (startDt == null || endDt == null) {
            //開始日付、終了日付に有効な日付の値を入力してください。
        	alert("{!$Label.MSG_003_0016}");
        	return false;
        }
        // 曜日
        var tmpEndDt = new Date(startDt.getTime());;
        if (tmpEndDt.addYears(1) < endDt ) {
            //設定期間は最大１年まで設定してください。
        	alert("{!$Label.MSG_003_0017}");
        	return false;
        }
        // 期間チェック
        if (startDt > endDt ) {
        	alert("{!$Label.ERR_0108}");
        	return false;
        }
    	var startDtVal = startDt.toString(JINYACONNECT.DateFormat);
    	var endDtVal = endDt.toString(JINYACONNECT.DateFormat);
    	// 2020/05/30 予約ポップラックレート設定[プラン]bug対応 BY zyz BEGIN
    	var baselanFlg = "";
    	if($j("#roomTypeCtlCheckBoxs").is(":visible")){
    		baselanFlg = $j("#roomTypeCtlCheckBoxs").prop("checked");
    	}
    	// 2020/05/30 予約ポップラックレート設定[プラン]bug対応 BY zyz END
    	// 开始时间，结束时间，planId，星期，Tier，贩卖状态，会员种别,全部plan一括处理
    	if(selectArr.length > 0){
			var reqObj = {
				beg:startDtVal,
				endDt:endDtVal,
				plps:selectArr,
				weekOpts:weekopts,
				tierType:varTier,
				salesType:saleType,
				vipType:varVip,
				allPlanFlg:baselanFlg
			};
			$("input[id$=hidPlanJsonStr]").val(JSON.stringify(reqObj));
	    	// Call ActionFunction
	    	updatePlanFun();
    	}
    	YAHOO.force.com.hidePlanSchedule();
    }
	function onPlanClick(el){
		$j(el).toggleClass("selectRow");
		$j("input[name=planSel]",el).prop("checked",!$j(el).hasClass("selectRow"));
		// 全选控制
		var allSelect = $j("input[name=planSel]:checked").length == $j("input[name=planSel]").length;
		$j("#roomTypeCtlCheckBoxs").prop("checked",allSelect);
		
	}
	// 启动窗口
	function initBindPlanSchedule(){
		$j("tr.selectRow").removeClass("selectRow");
		$j("tr.checkRow input[name=planSel]").prop("checked",true);
		// 外观调整
		var PlanweekRows = $j("#PlanweekBlock table tr");
		var PlanfirstRow = PlanweekRows.first();
		var Planwid = $j("#PlanweekBlock").width() - PlanfirstRow.width();
		var Planght = $j("#PlanweekBlock").height();
		$j("div.planpanel").css({width:Planwid - 8,height:Planght});
	}
	// Plantier变更
	function changeTierClassPlan(el){
		stopRunning();
		var oldValue = $j(el).attr("oldvalue");
		var curTd = $j(el).closest("td.dataCell");
		var updSpan = $j("span[name=updateSpan]",curTd);
		if (el.value == oldValue) {
			$j(el).removeClass("changeClassPlan");
			updSpan.removeClass("tierClass");
		} else {
			$j(el).addClass("changeClassPlan");
			updSpan.addClass("tierClass");
		}
		var orgValue = $j(el).attr("orgvalue");
		if (orgValue == undefined || orgValue == "") orgValue = oldValue;
		$j(el).attr("orgvalue",el.value);
		changClassTo(el,el.value,orgValue);
		/*if ($j(".tierClass").length > 0 && !$j("#floatTierPanel").is(":visible")) {
			$j("#floatTierPanel").addClass("floatHead");
			$j("#floatTierPanel").show();
		} else if ($j(".tierClass").length == 0){
			$j("#floatTierPanel").hide();
		}*/
		tierFloatWindow();
	}
	// 販売ステータス変更対応
	function salesStatusPlan(_this){
		// 自動刷新機能停止
		stopRunning();
		var ect = event.currentTarget;
		var orgValue = $(ect).data("orgvalue");
		if (ect.value == '{!JSENCODE(STOCK_SETTYPE_SALE)}'){
			ect.value = '{!JSENCODE(STOCK_SETTYPE_STOP)}';
			$j(ect).addClass("salesStatusPlan");
		} else {
			ect.value = '{!JSENCODE(STOCK_SETTYPE_SALE)}';
			$j(ect).removeClass("salesStatusPlan");
		}
		if (orgValue != ect.value){
			var updSpan = $j(_this).closest("td.dataCell").find("span[name='updateSpan']");
			if(updSpan.length > 0) updSpan.addClass("stypeClass");
			
			$(ect).addClass("onchanged");
		}
		else $(ect).removeClass("onchanged");
		// toggleTierClass(".salesClassPlan,.onchanged");
		tierFloatWindow();
	}
	function tierFloatWindow(){
		if (($j(".tierClass").length > 0 || $j(".salesClassPlan,.onchanged").length > 0 )) {
			$j("#floatTierPanel").addClass("floatHead");
			$j("#floatTierPanel").show();
		} else $j("#floatTierPanel").hide();
	}
	// 保存事件
	function saveBasePlan(){
		$("input[id$=hidPlanJsonStr]").val("");
		$("input[id$=hidPlanOneJsonStr]").val("");
		var basePlanShopId = $j("#hidBasePlanShopId").val();
		var ShopId = '';
		if(basePlanShopId != null && basePlanShopId != undefined && basePlanShopId != "") ShopId = basePlanShopId +'_';
		var planInfoMap = new Map();
		// 2020/04/29 6232 bug fix BY zyz BEGIN
		var _thisAll = [];
		var _tierAll = $j("span[name=updateSpan].tierClass");
		for(var i = 0; i < _tierAll.length ; i++){
			_thisAll.push(_tierAll.eq(i));
		}
		var _stypeAll = $j("span[name=updateSpan].stypeClass");
		for(var i = 0; i < _stypeAll.length ; i++){
			_thisAll.push(_stypeAll.eq(i));
		}
		// 2020/04/29 6232 bug fix BY zyz END
		if(_thisAll.length > 0){
			for (var i = 0 ; i < _thisAll.length ; i++) {
			var _this = _thisAll[i];
			// 开始时间，结束时间，planId，星期，Tier，贩卖状态，会员种别
			var $curTd = _this.closest("td.dataCell");
			var curTd = $j($curTd);
			// 获取planId
			var planid = curTd.attr("planid");
			// 获取会员等级
			var planVip = curTd.attr("planVip");
			// 获取当前数据的设定日
			var date = kendo.toString(new Date(curTd.attr("date")),'yyyy-MM-dd');
			// 数据的key
			var managerkey = ShopId + planVip +'_' + date + ' 00:00:00' + '_' + planid; // kendo.toString(new Date(curTd.attr("date")), JINYACONNECT.DateFormat);
			
			// 获取的tier值
			var planTier = $j(".selectCls",curTd).val();
			// 获取贩卖状态
			var plansaleStr = $j(".btn",curTd).val();
			var plansale = "1";
			if(plansaleStr == "{!JSENCODE(STOCK_SETTYPE_STOP)}") plansale = "2";
			// 变更的数据
			var planInfo = new Object();
			planInfo["searchKey"] = managerkey;
			planInfo["setupDate"] = date;
			planInfo["basePlanId"] = planid;
			planInfo["tierType"] = planTier;
			planInfo["salesType"] = plansale;
			planInfo["vipType"] = planVip;
			planInfoMap.set(managerkey, planInfo);
			}
		}
		//});
		$j("#floatTierPanel").removeClass("floatHead");
		$j("#floatTierPanel").hide();
		if (planInfoMap.size > 0) {
			$("input[id$=hidPlanOneJsonStr]").val(JSON.stringify(planInfoMap.map));
			updatePlanFun();
		}
	}
	function cancelBasePlan(){
		
		// tier状态
		$j(".tierClass").each(function(){
			var curTd = $j(this).closest("td.dataCell");
			var classNm = $j("select",curTd).attr("oldvalue");
			changClassTo($j("select",curTd).get(0),classNm,$j("select",curTd).val());
			$j("select",curTd).val(classNm);
		});
		// 去除颜色的变更状态
		$j(".changeClassPlan").removeClass("changeClassPlan");
		// 贩卖状态
		$j(".salesStatusPlan").each(function(){
			var val = $j(this).data("orgvalue");
			$j(this).val(val);
			$j(this).removeClass("salesStatusPlan");
			if ($j(this).hasClass("btn")) {
				if ($j(this).val() == '{!JSENCODE(STOCK_SETTYPE_STOP)}'){
					$j(this).addClass("salesStatusPlan");
				} else {
					$j(this).removeClass("salesStatusPlan");
				}
			}
		});
		$j(".tierClass").removeClass("tierClass");
		// 贩卖状态
		$j("span[name=updateSpan].stypeClass").removeClass("stypeClass");
	}
	// 取消按钮事件
	function changeSelectRmPlan(el){
		$j("div.planpanel table tr input[name=planSel]").prop("checked",$j(el).is(":checked"));
		if (!$j(el).is(":checked")) {
			$j("tr.checkRow").addClass("selectRow");
		} else {
			$j("tr.checkRow").removeClass("selectRow");
		}
	}
	// 翻页功能
	function openPageFun(openNum){
		// 翻页时，页面修改是否放弃
    	var floatPanel = $j("#floatTierPanel").attr("class");
    	if (floatPanel != undefined && floatPanel != "") {
    		if (window.confirm( "{!$label.MSG_9004}")) {
    			$j("#floatTierPanel").removeClass("floatHead");
    			cancelChgTier();
    		} else return;
    	}
    	// 翻页功能开启
    	if(openNum =='1') {
    		firstPageFun();
    	}else if(openNum =='2') {
    		previousPageFun();
    	}else if(openNum =='3') {
    		nextPageFun();
    	}else if(openNum =='4') {
    		lastPageFun();
    	}
	}
    // 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz END
    // 予約データを登録処理後の自動処理
    function raceRateCreateCallBack() {
        var createResult = $j("input[id$=':sch_hidDataCreateOK']").val();
        if (createResult.toLowerCase() == "true") {
            $j("input[id$=':sch_hidDataCreateOK']").val("");
            YAHOO.force.com.hideSchedule();
        }
    }
    // 日付書式処理
    function dateFormatFun(obj) {
    	// 2016/11/25 TIMEZON fix BEGIN by zh
		//var inputDt = Date.parse(obj.value);
		var inputDt = kendo.parseDate(obj.value,JINYACONNECT.DateFormat);
		// 2016/11/25 TIMEZON fix END by zh
		if (inputDt == null) return;
		obj.value = inputDt.toString(JINYACONNECT.DateFormat);
    }
    
    // 休館情報設定を行う
    function createRestHotelInfoJsFun() {
        // 開始日
        var varStartDt = $j("input[id$=':layoff_startDate']").val();
        var varEndDt = $j("input[id$=':layoff_endDate']").val();
        // 有効な日付をチェックする
        // 2016/11/25 TIMEZON fix BEGIN by zh
        //var startDt = Date.parse(varStartDt);
        var startDt = kendo.parseDate(varStartDt,JINYACONNECT.DateFormat);
        //var endDt = Date.parse(varEndDt);
        var endDt = kendo.parseDate(varEndDt,JINYACONNECT.DateFormat);
        // 2016/11/25 TIMEZON fix END by zh
        if (startDt == null || endDt == null) {
            //開始日付、終了日付に有効な日付の値を入力してください。
        	alert("{!$Label.MSG_003_0016}");
        	return false;
        }
        // 曜日
        var tmpEndDt = new Date(startDt.getTime());;
        if (tmpEndDt.addYears(1) < endDt ) {
            //設定期間は最大１年まで設定してください。
        	alert("{!$Label.MSG_003_0017}");
        	return false;
        }
        // 期間チェック
        if (startDt > endDt ) {
        	alert("{!$Label.ERR_0108}");
        	return false;
        }
    	$j("input[id$=':hidRestStartDate']").val(startDt.toString(JINYACONNECT.DateFormat));
    	$j("input[id$=':hidRestEndDate']").val(endDt.toString(JINYACONNECT.DateFormat));
    	// 指定の形式
    	var hotelstatus = $j("input[name='roomstatusRadio']:checked").val();
    	$j("input[id$=':hidRestHotelStatus']").val(hotelstatus);
    	// Call Ajax Acation
    	createRestHotelInfoFun();
    }
    // 予約データを登録処理後の自動処理
    function restUpdateCallBack() {
        var createResult = $j("input[id$=':rest_hidDataCreateOK']").val();
        if (createResult.toLowerCase() == "true") {
            $j("input[id$=':rest_hidDataCreateOK']").val("");
            YAHOO.force.com.hideLayoffPanel();
        }
    }
    // AutoComplete項目選べるリストクリックする処理
    function clearAutoCompletePanel() {
		$j(".ui-autocomplete").hide();
		$j(".ui-autocomplete").empty();
    }
    // プラン設定機能
    function openMiniPlanSetup(item) {
		// プラン明細を展開する 
		var planItem = $j("#planCustomeBtn").data("jinyaPlanExtend");
		planItem.switchStatus();
   	}
	// Check部屋数
	function checkRoomsNumber() {
		if ($j("input:text[id$=':broom:name']").length == 0 ||
			($j("input:text[id$=':broom:name']").length > 0 &&
			 $j("input:text[id$=':broom:name']").val() == "")) return true;
		var rooms = $j("input:text[id$=':bookingRooms']").val();
		if (rooms > 1) {
            //部屋数は複数場合、部屋設定することができません。
			alert('{!$Label.MSG_003_0018}');
            return false;
		}
		return true;
   	}
   	// 室料計算用Method
   	function calRoomRateFun() {
   		// 現状の画面はラックレートするがどうかチェックする
		if ($j("#hidIsRateRateFlg").val() == "true") {
			//$j("input[id$=':hidRackratePrice']").val($btnObj.val());
			var roomPrice = $j("#hidRackratePrice").val();	// ボタンに記載する金額を取得する
			var planPrice = $j("#hidPlanPrice").val();	// 選択するプラン金額を格納する
			return commUtils.mathNumSub(roomPrice, planPrice);// 室料のみプラン設定画面へ引き渡す
		} else {
			// ラックレートじゃない場合、室料は自動設定を行わない
			//return 0;
			return null;
		}
   	}
	function stopRunning() {
		clearTimeout(intervalId);
	}
	function startRunning() {
		// Timer Define
		clearTimeout(intervalId);
		// 2018/12/30 予約ポップ画面上で現在1日ごとに表示されている「残数」「販売」の月の合計を予約ポップ上に表示してほしい by cxw BEGIN
		intervalId = setTimeout(function(){
			timerPollerFun();
			calcRoomNum();
		}, timerInterval);
		// 2018/12/30 予約ポップ画面上で現在1日ごとに表示されている「残数」「販売」の月の合計を予約ポップ上に表示してほしい by cxw END
	}
	// 2015/10/28 プラン明細表示のRESET
	function planRest(){
		// 前に設定するプラン商品と金額情報をクリアする
		var planItem = $j("#planCustomeBtn").data("jinyaPlanExtend");
		planItem.reset();
	}
	// 2015/10/28 CTI->PAST機能対応
	function _call_pasteInfo() {
		$j("[id$=':relcontact']").unbind('paste');
		$j("[id$=':relcontact']").bind('paste',function(e){
	        // 2017/09/23 新規予約ウインドウ、お客様情報反映されない不具合改修 WGCH BEGIN
	        var $relcontact = $j(this);
	        $relcontact.autocomplete('search', this.value);
	        // 2017/09/23 新規予約ウインドウ、お客様情報反映されない不具合改修 WGCH END
			var pastedText = undefined;
			if (window.clipboardData && window.clipboardData.getData) {
				pastedText = window.clipboardData.getData('Text');
			}else {
				pastedText = e.originalEvent.clipboardData.getData('Text');
			}
			/* 2015/11/09 CTI->PAST機能対応
			if (pastedText.indexOf('#') > 0) {
				e.preventDefault();
				$j("[id$=':relcontact']").val(pastedText.split('#')[0]);
				$j("input[id$=':relcontact_lkid']").val(pastedText.split('#')[1]);
				$j("[id$=':relcontact']").blur();
			}*/
			cti_call_pasteInfo(e, pastedText);
		});
	}
	// 2015/11/09 CTI->PAST機能対応
	function cti_call_pasteInfo(e, pastedText) {
		if ($j("#myPanel_c").css("visibility") == "hidden") return false;
		if (pastedText != undefined && pastedText.indexOf('#') > 0) {
			if (e != null) e.preventDefault();
			$j("[id$=':relcontact']").val(pastedText.split('#')[0]);
			$j("input[id$=':relcontact_lkid']").val(pastedText.split('#')[1]);
			$j("[id$=':relcontact']").blur();
		}
		return true;
	}
// 2018/03/12 ラックレート部屋タイプ別の対応　by　zy　BEGIN
function initBindSchedule() {
	$j("tr.selectRow").removeClass("selectRow");
	$j("tr.checkRow input[name=roomTypeSel]").prop("checked",true);
	$j("input[id$=hidRoomTypes]").val("");
	$j("input[id$=hidMoreTypeMsg]").val("");
	// 外观调整
	var weekRows = $j("#weekBlock table tr");
	var firstRow = weekRows.first();
	var wid = $j("#weekBlock").width() - firstRow.width();
	var ght = $j("#weekBlock").height();
	$j("div.roomtypepanel").css({width:wid - 8,height:ght});
	// 2019/04/30 予約ポップの在庫設定(AGT)の変更機能 BY zyz BEGIN
	$j("div.roomtypepanel1").css({width:wid - 8,height:ght});
	// 2019/04/30 予約ポップの在庫設定(AGT)の変更機能 BY zyz END
}
//Tier画面に部屋タイプ選択対応
function onTierRoomTypeClick(el){
	$j(el).toggleClass("selectRow");
	$j("input[name=roomTypeSel]",el).prop("checked",!$j(el).hasClass("selectRow"));
	// 全选控制
	var allSelect = $j("input[name=roomTypeSel]:checked").length == $j("input[name=roomTypeSel]").length;
	$j("#roomTypeCtlCheckBox").prop("checked",allSelect);
	
}
// tier变更
function changeTierClass(el){
	stopRunning();
	var oldValue = $j(el).attr("oldvalue");
	var curTd = $j(el).closest("td.dataCell");
	var updSpan = $j("span[name=updateSpan]",curTd);
	if (el.value == oldValue) updSpan.removeClass("tierClass");
	else updSpan.addClass("tierClass");
	var orgValue = $j(el).attr("orgvalue");
	if (orgValue == undefined || orgValue == "") orgValue = oldValue;
	$j(el).attr("orgvalue",el.value);
	changClassTo(el,el.value,orgValue);
	if ($j(".tierClass").length > 0 && !$j("#floatTierPanel").is(":visible")) {
		$j("#floatTierPanel").addClass("floatHead");
		$j("#floatTierPanel").show();
	} else if ($j(".tierClass").length == 0){
		$j("#floatTierPanel").hide();
	}
}
// toolbar hide
function hideTier() {
	$j("#floatTierPanel").hide();
	$j("#floatTierPanel").removeClass("floatHead");
}
// 取消按钮响应
function cancelChgTier() {
	// toolbar hide
	hideTier();
	// 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz BEGIN
	// if($j(".changeClassPlan").length > 0 || $j(".salesStatusPlan").length > 0) cancelBasePlan();
	if($j(".changeClassPlan").length > 0 || $j(".salesClassPlan,.onchanged").length > 0) cancelBasePlan();
	// 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz END
	// 2018/12/15 在庫調整と販売状態管理 by zy BEGIN
	if ($(".changeClass,.changed").length > 0) return cancelChgStock();
	// 2018/12/15 在庫調整と販売状態管理 by zy END
	$j(".tierClass").each(function(){
		var curTd = $j(this).closest("td.dataCell");
		var classNm = $j("select",curTd).attr("oldvalue");
		changClassTo($j("select",curTd).get(0),classNm,$j("select",curTd).val());
		$j("select",curTd).val(classNm);
	});
	$j(".tierClass").removeClass("tierClass");
	$j("input[id$=hidMoreTypeMsg]").val("");
	$j("input[id$=hidRoomTypes]").val("");
	startRunning();
}
// ボタン「保存」対応
function saveChangeTier() {
	// 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz BEGIN
	// if($j(".changeClassPlan").length > 0 || $j(".salesStatusPlan").length > 0) return saveBasePlan();
	if($j(".changeClassPlan").length > 0 || $j(".salesClassPlan,.onchanged").length > 0) return saveBasePlan();
	// 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz END
	// 2018/12/15 在庫調整と販売状態管理 by zy BEGIN
	if ($(".changeClass,.changed").length > 0) return saveChgStock();
	// 2018/12/15 在庫調整と販売状態管理 by zy END
	var srachKeyArr = [];
	$j("input[id$=hidRoomTypes]").val("");
	$j("input[id$=hidMoreTypeMsg]").val("");
	$j(".tierClass").each(function(){
		var curTd = $j(this).closest("td.dataCell");
		var selectEl = $j("select",curTd);
		var queryDt = kendo.toString(new Date(selectEl.attr('date')),'yyyy/MM/dd');
		var searchKey = selectEl.attr("typeid") + '_' + queryDt + '_' + selectEl.val();
		srachKeyArr.push(searchKey);
	});
	if (srachKeyArr.length > 0) {
		$j("input[id$=hidMoreTypeMsg]").val(srachKeyArr.join(','));
		scheduleSaveFun();
	}
	$j("#floatTierPanel").removeClass("floatHead");
	$j("#floatTierPanel").hide();
}
// 去掉原有class 并根据给的class名添加class
function changClassTo(el,className,orgName){
	if ( orgName != undefined && orgName != "") {
		$j(el).removeClass(orgName);
	} else if (el.classList.length > 0) {
		for (var i = 0 ; i < el.classList.length ; i++) {
			var curClass = el.classList[i];
			$j(el).removeClass(curClass);
		}
	}
	$j(el).addClass(className);
}
function changeSelectRm(el){
	$j("div.roomtypepanel table tr input[name=roomTypeSel]").prop("checked",$j(el).is(":checked"));
	if (!$j(el).is(":checked")) {
		$j("tr.checkRow").addClass("selectRow");
	} else {
		$j("tr.checkRow").removeClass("selectRow");
	}
}
// 2018/03/12 ラックレート部屋タイプ別の対応　by　zy　END
// 2018/12/15 在庫調整と販売状態管理 by zy BEGIN
// 取消按钮响应
function cancelChgStock() {
	$j(".changeClass,.changed").each(function(){
		var val = $j(this).data("orgvalue");
		$j(this).val(val);
		$j(this).removeClass("changeClass changed");
		if ($j(this).hasClass("btn")) {
			if ($j(this).val() == '{!JSENCODE(STOCK_SETTYPE_STOP)}'){
				$j(this).addClass("salesStatus");
			} else {
				$j(this).removeClass("salesStatus");
			}
		}
	});
}
// 保存按钮响应
function saveChgStock() {
	var stockInfoMap = new Map();
	$j(".changeClass").each(function(){
		var curTd = $j(this).closest("td.dataCell");
		var typeid = curTd.attr("typeid");
		var date = kendo.toString(new Date(curTd.attr("date")),'yyyy-MM-dd');
		var managerkey = typeid + '_' + kendo.toString(new Date(curTd.attr("date")), JINYACONNECT.DateFormat);
		var stockInfo = new Object();
		var diffInt = kendo.parseInt($j(this).attr("rmngval"));
		if (diffInt == null) diffInt = 0; 
		var changeValue = kendo.parseInt($j(this).val());
		if (changeValue == null) changeValue = 0;
		stockInfo["qtyOfStock"] = changeValue;
		stockInfo["maxRooms"] = changeValue + diffInt;
		stockInfo["roomTypeId"] = typeid;
		stockInfo["stockDate"] = date;
		stockInfo["salesStatusLst"] = $j("input:button",curTd).val();
		stockInfoMap.set(managerkey, stockInfo);
	});
	$j(".changed").each(function(){
		var curTd = $j(this).closest("td.dataCell");
		var typeid = curTd.attr("typeid");
		var date = kendo.toString(new Date(curTd.attr("date")),'yyyy-MM-dd');
		var managerkey = typeid + '_' + kendo.toString(new Date(curTd.attr("date")), JINYACONNECT.DateFormat);
		if(stockInfoMap.get(managerkey)){
			var stockInfo = stockInfoMap.get(managerkey);
			stockInfo["salesStatusLst"] = $j(this).val();
		} else{
			var stockInfo = new Object();
			var diffInt = kendo.parseInt($j("input.roomInput", curTd).attr("rmngval"));
			if (diffInt == null) diffInt = 0; 
			var changeValue = kendo.parseInt($j("input.roomInput", curTd).val());
			if (changeValue == null) changeValue = 0;
			stockInfo["salesStatusLst"] = $j(this).val();
			stockInfo["qtyOfStock"] = changeValue;
			stockInfo["maxRooms"] = changeValue + diffInt;
			stockInfo["roomTypeId"] = typeid;
			stockInfo["stockDate"] = date;
			stockInfoMap.put(managerkey, stockInfo);
		}
	});
	$j("#floatTierPanel").removeClass("floatHead");
	$j("#floatTierPanel").hide();
	if (stockInfoMap.size > 0) {
		$("input[id$=hidRequestJson]").val(JSON.stringify(stockInfoMap.map));
		updateSalesFun();
	}
}
// 2019/04/30 予約ポップの在庫設定(AGT)の変更機能 BY zyz BEGIN
var tabFlg = {!StockFlg};
// 表示画面
function openSalesPanel(){
	var floatPanel = $j("#floatTierPanel").attr("class");
	if (floatPanel != undefined && floatPanel != "" && tabFlg) {
		if (window.confirm( "{!$label.MSG_9004}")) {
			$j("#floatTierPanel").removeClass("floatHead");
			cancelChgTier();
			openPanel();
		}
	} else openPanel();
}
function openPanel(){
// 转换为tab选择形式
    var tabStrip = $("#salesSched").data("kendoTabStrip");
    if (tabStrip == undefined && tabFlg) {
		tabStrip = $("#salesSched").kendoTabStrip({
			activate:function(){
				chkChgPanel(this);
			}
		}).data("kendoTabStrip");
	}
	$j(".taskContPanel").show();
	$j(".taskScreen").show();
	if(!tabFlg){
		showSalesPanel($(event.currentTarget).attr("date"));
	} else { 
		tabStrip.dt = $(event.currentTarget).attr("date");
		chkChgPanel(tabStrip);
	}
}
function chkChgPanel(tab){
	var selTab = tab.select()[0];
	var tabName = $(selTab).attr("name");
	if (tabName == "sales") {
		showSalesPanel(tab.dt);
	} else {
		showStockPanel(tab.dt);
	}
}
function showStockPanel(dt){
	var curDt = kendo.parseDate(dt,JINYACONNECT.DateFormat);
	// 曜日
    var weekday = curDt.toString("dddd");
    var parIndx = $(".salesBtn[date='" + dt + "']").first().closest("td").index();
	$("input[id$=sale_startDate1],input[id$=sale_endDate1]").val(dt);
    $j("input[name=weekOpts1]").prop("checked",false);
    $j("input[name=weekOpts1][value="+weekday+"]").prop("checked", true);
	$j("input[name^=roomTypeStock_]").each(function(){
		var curStock = $j(this);
		var curRow = curStock.closest(".checkRows");
		var typeId = curRow.attr("typeid");
		var inputVal = $j("tr.stockRow[typeid='" + typeId + "']>td:eq(" + parIndx + ") input.roomInput").val();
		var inputmax = $j("tr.stockRow[typeid='" + typeId + "']>td:eq(" + parIndx + ") input.roomInput").attr("data-maxvalue");
		var inputDiff = $j("tr.stockRow[typeid='" + typeId + "']>td:eq(" + parIndx + ") input.roomInput").attr("rmngval");
		$j(this).val(inputVal);
		$j(this).data("orgvalue",inputVal);
		$j(this).data("maxvalue",inputmax);
		$j(this).data("rmngval",inputDiff);
		$j("[id$=roomTypeStocklabel]",curRow).text(inputVal);
	});
	var weekBlock1 = $j("#salesSched .weekBlock1");
	var weekRows1 = $j("table tr",weekBlock1);
	var firstRow1 = weekRows1.first();
	var wid1 = weekBlock1.width() - firstRow1.width();
	var ght1 = weekBlock1.height();
	$j("div.roomtypepanel1",weekBlock1).css({width:wid1 - 8,height:ght1});
	// 外观调整
	var weekBlock = $j("#salesSched .weekBlock");
	var weekRows = $j("table tr",weekBlock);
	var firstRow = weekRows.first();
	var wid = weekBlock.width() - firstRow.width();
	var ght = weekBlock.height();
	//$j("div.roomtypepanel",weekBlock).css({width:wid - 8,height:ght});
	var weekBlock1 = $j("#salesSched .weekBlock1");
	var weekRows1 = $j("table tr",weekBlock1);
	var firstRow1 = weekRows1.first();
	var wid1 = weekBlock1.width() - firstRow1.width();
	var ght1 = weekBlock1.height();
	var widStr = 0;
	var ghtStr = 0;
	if (wid != 0) widStr = wid;
	else widStr = wid1;
	if (ght != 0) ghtStr = ght;
	else ghtStr = ght1;
	$j("div.roomtypepanel",weekBlock).css({width:widStr - 8,height:ghtStr});
	$j("div.roomtypepanel1",weekBlock1).css({width:widStr - 8,height:ghtStr});
	stopRunning();
}
function showSalesPanel(dt){
	$("input[id$=sale_startDate1],input[id$=sale_endDate1]").val(dt);
	$("input[id$=sale_startDate],input[id$=sale_endDate]").val(dt);
	// 曜日
    var weekday = kendo.parseDate(dt,JINYACONNECT.DateFormat).toString("dddd");
    // 曜日初期値設定
    $j("input[name=weekOpts]").prop("checked",false);
    // $j("input[name=weekOpts][value="+weekday+"]").attr("checked", true);
    $j("tr.checkRow input[name=roomTypeSel]").prop("checked",true);
    $j("input[name=weekOpts][value="+weekday+"]").prop("checked", true);
    $j("tr.selectRow").removeClass("selectRow");
    $j("#rtpCheckBox").prop("checked",true);
    $j(".taskContPanel").show();
	$j(".taskScreen").show();
	// 外观调整
	var weekBlock = $j("#salesSched .weekBlock");
	var weekRows = $j("table tr",weekBlock);
	var firstRow = weekRows.first();
	var wid = weekBlock.width() - firstRow.width();
	var ght = weekBlock.height();
	var widStr = 0;
	var ghtStr = 0;
	if (wid != 0) widStr = wid;
	else widStr = wid1;
	if (ght != 0) ghtStr = ght;
	else ghtStr = ght1;
	$j("div.roomtypepanel",weekBlock).css({width:widStr - 8,height:ghtStr});
	stopRunning();
}
// 2019/04/30 予約ポップの在庫設定(AGT)の変更機能 BY zyz END
// 画面閉じる
function panelHide(){
	// 2019/04/30 予約ポップの在庫設定(AGT)の変更機能 BY zyz BEGIN
	// 画面关闭后，内容恢复
	if(tabFlg){
		$(".checkRows").each(function(){
			var StockNM = $(this).attr('Name');
			$("[name=roomTypeStockstockName]",$(this)).each(function(){
				$("input[class$='changeClass']").val("");
			});
		});
		cancelChgStock1();
	}
	// 2019/04/30 予約ポップの在庫設定(AGT)の変更機能 BY zyz END
	$(".taskContPanel").hide();
	$(".taskScreen").hide();
	startRunning();
}
// 販売設定画面保存
function salesSavePanel(){
	var sch = $("#salesSched");
	var weekOpts = [];
	var typeSels = [];
	var startDt = $("input[id$=sale_startDate]").val();
	var endDt = $("input[id$=sale_endDate]").val();
	var saleType = $("#salesSel").val();
	var typeRowSel = [];
	var indexArr = [];
    // 有効な日付をチェックする
    var vStartDt = kendo.parseDate(startDt,JINYACONNECT.DateFormat);
    var vEndDt = kendo.parseDate(endDt,JINYACONNECT.DateFormat);
    if (vStartDt == null || vEndDt == null) {
        //開始日付、終了日付に有効な日付の値を入力してください。
    	alert("{!$Label.MSG_003_0016}");
    	return false;
    }
    // 2019/03/12 画面外の販売状態設定不正修正 by zy BEGIN
    /*
    // 曜日
    var tmpEndDt = new Date(vStartDt.getTime());
    if (tmpEndDt.addYears(1) < endDt ) {
        //設定期間は最大１年まで設定してください。
    	alert("{!$Label.MSG_003_0017}");
    	return false;
    }
    */
    // 2019/03/12 画面外の販売状態設定不正修正 by zy END
    // 期間チェック
    if (vStartDt > vEndDt ) {
      alert("{!$Label.ERR_0108}");
      return false;
    }
	$("input[name=weekOpts]:checked",sch).each(function(){
		weekOpts.push($(this).val());
	});
	$("input[name=roomTypeSel]:checked",sch).each(function(){
		var curRow = $(this).closest("tr.checkRow");
		var typeId = curRow.attr("name");
		typeSels.push(typeId);
		typeRowSel.push("[typeid = '" + typeId + "']");
	});
	var dtRow = $("tr.headerRow").has("th[dt]").first();
	var startCol = dtRow.find("[dt='" + startDt + "']");
	indexArr.push({dt:startDt,index:startCol.index()});
	startCol.nextAll().each(function(){
		var col = $(this);
		var dt = col.attr("dt");
		if (dt != undefined) indexArr.push({dt:dt,index:col.index()});
	});
	// 2019/03/12 画面外の販売状態設定不正修正 by zy BEGIN
	// 画面外期間限定チェック
	var lastDt = indexArr[indexArr.length - 1].dt;
	if (endDt > lastDt) {
		// 今日
		var dt = kendo.toString(new Date(),JINYACONNECT.DateFormat);
		var begDt = $j("input.salesBtn:first").attr("date");
		var endDt = $j("input.salesBtn:last").attr("date");
		if (begDt < dt) begDt = dt;
	 	var alretMsg = '開始日付が「' + begDt + '」以後、終了日付が「' + endDt + '」以前の日付を設定してください。';
		alert(alretMsg);
		return false;
	}
	// 2019/03/12 画面外の販売状態設定不正修正 by zy END
	//weekOpts
	if (weekOpts.length == 0) {
           //曜日を選択してください
		alert("{!$Label.MSG_003_0015}");
		return false;
	}
	if (weekOpts.length > 0) {
		var remainCntMap = {};
		var curRows = $("#dTable").find(typeRowSel.join(','));
		if (curRows.length > 0) {
			curRows.each(function(){
				var curRow = $(this);
				var typeid = curRow.attr("typeid");
				var cols = $(">td.dataCell",this);
				for (var i = 0 ; i < indexArr.length ; i++) {
					var arrObj = indexArr[i];
					var idx = arrObj.index;
					var dt = arrObj.dt;
					var curTd = cols.eq(idx);
					var roomInput = curTd.find(".roomInput");
					if (roomInput.length > 0) {
						var roomCnt = kendo.parseInt(roomInput.attr("rmngval"));
						if (roomCnt == null) roomCnt = 0; 
						var changeValue = kendo.parseInt(roomInput.val());
						if (changeValue == null) changeValue = 0;
						roomCnt += changeValue;
						var key = typeid + '_' + dt;
						remainCntMap[key] = kendo.parseInt(roomCnt);
					}
				}
			});
		}
		var reqObj = {
			beg:startDt,
			endDt:endDt,
			rtps:typeSels,
			weekOpts:weekOpts,
			salesType:saleType,
			remanMap:remainCntMap
		};
		$("input[id$=hidRequestJson]").val(JSON.stringify(reqObj));
		updateWeekOptsFun();
	}
	panelHide();
}
// 販売ステータス変更対応
function salesStatus(){
	// 自動刷新機能停止
	stopRunning();
	var ect = event.currentTarget;
	var orgValue = $(ect).data("orgvalue");
	if (ect.value == '{!JSENCODE(STOCK_SETTYPE_SALE)}'){
		ect.value = '{!JSENCODE(STOCK_SETTYPE_STOP)}';
		$j(ect).addClass("salesStatus");
	} else {
		ect.value = '{!JSENCODE(STOCK_SETTYPE_SALE)}';
		$j(ect).removeClass("salesStatus");
	}
	if (orgValue != ect.value) $(ect).addClass("changed");
	else $(ect).removeClass("changed");
	toggleTierClass(".changeClass,.changed");
}
function reGainFun(){
	if ($j(".changeClass,.changed").length == 0) startRunning();
}
// 販売数変更
function roomChange(){
	// 該当入力対象
	var ect = event.currentTarget;
	// 前回入力値
	var val = $(ect).data("orgvalue");
	// 最大残室数
	var maxVal = $(ect).data("maxvalue");
	var newValue = kendo.parseInt(ect.value);
	// 負数チェック
	if (val < 0) val = 0;
	// 無効値チェック
	if (newValue == null || newValue < 0) {
		ect.value = val;
		newValue = val;
	// 最大数チェック
	} else if (newValue > maxVal) {
		ect.value = maxVal;
		newValue = maxVal;
	}
	// 変更チェック
	if (newValue != val) $(ect).addClass("changeClass");
	else $(ect).removeClass("changeClass");
	//　浮動バー表示機能
	toggleTierClass(".changeClass,.changed");
}
//　浮動バー表示機能
function toggleTierClass(claSelector){
	// 指定条件あり浮動バー表示
	if ($(claSelector).length > 0) showTier();
	// 指定条件なし浮動バー非表示
	else hideTier();
}
// 浮動バー表示
function showTier() {
	$j("#floatTierPanel").addClass("floatHead");
	$j("#floatTierPanel").show();
}
// 浮動バー非表示
function hideTier() {
	$j("#floatTierPanel").hide();
	$j("#floatTierPanel").removeClass("floatHead");
}
// 過去日の「販売状態」ボタン無効機能
function refreshSalesBtns(){
	// 今日
	var dt = kendo.toString(new Date(),JINYACONNECT.DateFormat);
	$j("input.salesBtn").each(function(){
		var curBtn = $j(this);
		var curDt = curBtn.attr("date");
		if (curDt < dt) {
			curBtn.attr("disabled","disabled");
			curBtn.css("color","gray");
		}
	});
}
// 2018/12/15 在庫調整と販売状態管理 by zy END
// 2018/12/30 予約ポップ画面上で現在1日ごとに表示されている「残数」「販売」の月の合計を予約ポップ上に表示してほしい by cxw BEGIN
	function calcRoomNum() {
		var $trs = $j("#dTable tr");
		//			残室							販売							E/B
		var keys = ["{!$Label.ps__msg_003_0049}", "{!$Label.ps__msg_003_0048}", "{!$Label.ps__msg_003_0050}"];
		var index = 0;
		$trs.each(function(){
			if(index == keys.length) return false;
			var $th = $j(this).children("th:eq(0)");
			var $tds = $j(this).children("td");
			var text = $th.text().trim();
			if(keys.indexOf(text) >= 0) {
				index++;
				var num = 0;
				$tds.each(function(){
					num += (this.innerText * 1) || 0;
				});
				$th.css("position", "relative").append('<span style="position:absolute;right:2px">' + num + '</span>');
				
			}
		});
	}
	// 2018/12/30 予約ポップ画面上で現在1日ごとに表示されている「残数」「販売」の月の合計を予約ポップ上に表示してほしい by cxw END
// 2020/05/30 予約ポップラックレート設定[プラン]bug対応 BY zyz BEGIN
function onWindowOf(colName,colDay){
	var isPlanActionFlg = $j("#hidisPlanActionFlg").val();
	if(isPlanActionFlg =="true") YAHOO.force.com.showPlanSchedule(colName,colDay);
	else YAHOO.force.com.showSchedule(colName,colDay);
}
// 2020/05/30 予約ポップラックレート設定[プラン]bug対応 BY zyz END
// 2020/11/30 リアルAGT増返室ボタン機能新規追加 WGCH BEGIN
function conModeFun(_this){
	var table_td = $j("[id='dTableAgt'] td");
	var new_lab_btn = $j("label", table_td);
	var pro_lab_btn = new_lab_btn.not( new_lab_btn.filter(".showCls") );
	var new_div_btn = $j("div[disableFlg='false']", table_td);
	var con_num_btn = $j("span.numerictextbox.showCls", table_td);
	if($j(_this).hasClass("newleadmode")){
		// 増返室キャンセル
		$j(_this).val("{!$Label.MSG_003_0114}").removeClass("newleadmode");
		// 隐藏新规按钮
		pro_lab_btn.hide();
		new_div_btn.hide();
		// 显示变更按钮
		con_num_btn.show();
		// 暂停自动刷新
		stopRunning();
		if($j("#dTableAgt span[name='updateSpan'].onChange").length == 0 ) $j("#floatAgtPanel").hide();
		else $j("#floatAgtPanel").show();
	} else {
		// 増返室、増返室キャンセル
		$j(_this).val("{!$Label.MSG_003_0113}").addClass("newleadmode");
		// 显示新规按钮
		pro_lab_btn.show();
		new_div_btn.show();
		// 隐藏变更按钮
		con_num_btn.hide();
		// 重置
		agtRoomsCancelFun();
		// 开启自动刷新
		startRunning();
		$j("#floatAgtPanel").hide();
	}
}
function agtRoomsSaveFun(){
	var roomsChangeMap = new Map();
	$j(".onChange").each(function(){
		var input = $j("input.numerictextbox", $(this).closest("td.dataCell"));
		if(input.length < 1) return true;
		kendoNumData = input.eq(1).data("kendoNumericTextBox");
		if(!kendoNumData) return true;
		var date = kendo.toString(new Date(kendoNumData.element.attr("stockDate")),'yyyy-MM-dd');
		var newVal = kendo.parseInt(kendoNumData.value());
		if (newVal == null) newVal = 0;
		var oldval = kendo.parseInt(kendoNumData.element.attr("oldval"));
		if (oldval == null) oldval = 0;
		var diffInt = kendo.parseInt(kendoNumData.element.attr("rmngval"));
		if (diffInt == null) diffInt = 0;
		var sfQtyOfStock = kendo.parseInt(kendoNumData.element.attr("sfQtyOfStock"));
		if (sfQtyOfStock == null) sfQtyOfStock = 0;
		var maxRooms = kendo.parseInt(kendoNumData.element.attr("maxRooms"));
		if (maxRooms == null) maxRooms = 0;
		var roomsInfo = new Object();
		roomsInfo["managerKey"] = kendoNumData.element.attr("managerKey");
		roomsInfo["managerKey2"] = kendoNumData.element.attr("managerKey2");
		roomsInfo["newVal"] = newVal;
		roomsInfo["oldval"] = oldval;
		roomsInfo["roomTypeId"] = kendoNumData.element.attr("roomTypeId");
		roomsInfo["stockDate"] = date;
		roomsInfo["accountId"] = kendoNumData.element.attr("accountId");
		roomsInfo["changeVal"] = newVal - oldval;
		roomsInfo["diffIntVal"] = diffInt; // SF故障房间数
		roomsInfo["sfQtyOfStock"] = sfQtyOfStock; // SF最大残室数
		roomsInfo["maxRooms"] = maxRooms; // SF最大販売室数
		roomsInfo["accountRoomsMap"] = {};
		roomsChangeMap.set(roomsInfo["managerKey2"], roomsInfo);
	});
	if (roomsChangeMap.size > 0) {
		$("input[id$=hidRoomsChangeJsonStr]").val(JSON.stringify(roomsChangeMap.map));
		upRoomsChangeFun();
	}
	$j(".onChange").hide().removeClass("onChange");
	$j("#floatAgtPanel").hide();
	$j("input.newleadmode").click();
}
function agtRoomsCancelFun(){
	$j(".onChange").each(function(){
		var input = $j("input.numerictextbox", $(this).closest("td.dataCell"));
		if(input.length < 1) return true;
		kendoNumData = input.eq(1).data("kendoNumericTextBox");
		if(!kendoNumData) return true;
		kendoNumData.value(kendoNumData.element.attr("oldval"));
	});
	$j(".onChange").hide().removeClass("onChange");
	$j("#floatAgtPanel").hide();
}
function onChange(){
	if(this.value() == null) this.value(0)
	var updSpan = $j(this.wrapper).closest("td.dataCell").find("span[name='updateSpan']");
	if(this.element.attr("oldval") != this.value()){
		if(updSpan.length > 0) updSpan.show().addClass("onChange");
		// $j(".k-formatted-value.numerictextbox.k-input", this.wrapper).addClass("onChange");
	} else{
		if(updSpan.length > 0) updSpan.hide().removeClass("onChange");
		// $j(".k-formatted-value.numerictextbox.k-input", this.wrapper).removeClass("onChange");
	}
	if($j("#dTableAgt span[name='updateSpan'].onChange").length == 0 ) $j("#floatAgtPanel").hide();
	else $j("#floatAgtPanel").show();
	// console.log("Change :: " + this.value());
}
function setNumTextBoxFun(){
	$j(".numerictextbox").each(function(){
		$(this).kendoNumericTextBox({
			format: "n0", // 整数格式
			change: onChange,
	 		min: 0,
	 		max: $(this).attr("maxval")
		});
	});
	// 初期隐藏
	$j("[id='dTableAgt'] td span.numerictextbox").hide();
}
// 2020/11/30 リアルAGT増返室ボタン機能新規追加 WGCH END
</script>

<!-- This is the page that we want to display to the user -->
<!-- Room Inventry for Booking -->    <!-- 予約と残室 -->
<apex:sectionHeader title="{!$Label.ps__msg_003_0019}" subtitle="{!$Label.ps__msg_003_0020}"/>
<apex:outputPanel rendered="{!$Setup.CommDefine__c.RoomTypeMessageIsShowFlg__c}">
<c:MessageItemComp yyyymmddStr="{!messageObj.name}" maxRows="{!$Setup.CommDefine__c.MessageRows__c}" id="messageForm" refreshMessageFunName="_messageComp_refreshMessage" shopcode="{!branchShopNm}" rendered="{!isShowMessageCompFlg}" ckeditor="{!$Setup.CommDefine__c.RoomTypeMessageIsRichTextFlg__c}"/>
</apex:outputPanel>
<!-- 室料情報を格納 -->
<apex:actionStatus onstart="_messageComp_refreshMessage();" id="refStatusTimer"/>
<apex:actionStatus onstart="javascript:blockUi();" onstop="unblock();" id="refStatusBlock"/>
<apex:form id="dispForm">
<!-- 2021/03/16 最大部屋タイプ数表示制限機能追加 WSQ BEGIN -->
<!-- ALL店舗の警告メッセージ追加-->
<apex:outputPanel rendered="{!isOverRoomTypeLimitFlg}">
	<div class="message errorM3" role="alert" style="margin-left:0px;margin-right: 0px;">
	  	<table border="0" cellpadding="0" cellspacing="0" class="messageTable" style="padding:0px;margin:0px;">
	  		<tbody>
	  			<tr>
	  				<td><img src="/img/msg_icons/warning16.png" title="ERROR"/></td>
	                <td class="messageCell">
	                    <div class="messageText">
	                        <span><h4></h4></span><span class="errorText"></span>
	                        処理制限を超えました、一部の部屋タイプは表示されていません。
	                        <br/>
	                    </div>
	                </td>
	            </tr>
	  			<tr>
	  				<td></td>
	  				<td></td>
	  			</tr>
	  		</tbody>
	  	</table>
	</div>
</apex:outputPanel>
<!-- 2021/03/16 最大部屋タイプ数表示制限機能追加 WSQ END -->
<!-- 2020/04/30 bug fixed 6173 by zy BEGIN -->
<style>
.leftBasePanel{
{!IF(isBasePlanFlg, 'width: 170px;white-space:inherit !important;', '')}
}
</style>
<!-- 2020/04/30 bug fixed 6173 by zy END -->
<!-- 在庫更新を行う -->
<apex:actionFunction name="stockRefreshFun" action="{!refreshStockInfo}" status="refStatusBlock" reRender="dispForm" />
<apex:actionFunction name="timerPollerFun" action="{!refreshNewInfo}" reRender="dispForm" status="refStatusTimer"/>
<!-- 2018/12/15 在庫調整と販売状態管理 by zy BEGIN -->
<apex:actionFunction name="updateSalesFun" action="{!updateSalesType}" reRender="dispForm" status="refStatusBlock"/>
<apex:actionFunction name="updateWeekOptsFun" action="{!updateWeekOpts}" reRender="dispForm" status="refStatusBlock"/>
<!-- 2018/12/15 在庫調整と販売状態管理 by zy END -->
<!-- 2019/04/30 予約ポップの在庫設定(AGT)の変更機能 BY zyz BEGIN -->
<apex:actionFunction name="updateWeekOptsFun1" action="{!updateWeekOpt}" reRender="dispForm,StockForm" status="refStatusBlock"/>
<!-- 2019/04/30 予約ポップの在庫設定(AGT)の変更機能 BY zyz END -->
<!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz BEGIN -->
<!-- 2020/05/30 予約ポップラックレート設定[プラン]bug対応 BY zyz BEGIN -->
<apex:actionFunction name="updatePlanFun" action="{!updPlanDetailInfo}" reRender="dispForm,StockForm,repeat" status="refStatusBlock"/>
<!-- 2020/05/30 予約ポップラックレート設定[プラン]bug対応 BY zyz END -->
<!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz END -->
<!-- 2020/11/30 リアルAGT増返室ボタン機能新規追加 WGCH BEGIN -->
<apex:actionFunction name="upRoomsChangeFun" action="{!upRoomsChange}" reRender="dispForm,StockForm,repeat" status="refStatusBlock"/>
<!-- 2020/11/30 リアルAGT増返室ボタン機能新規追加 WGCH END -->
<script>
    $j(document).ready(function() {
        bindEvent();
        // 2018/12/30 予約ポップ画面上で現在1日ごとに表示されている「残数」「販売」の月の合計を予約ポップ上に表示してほしい by cxw BEGIN
        calcRoomNum();
        // 2018/12/30 予約ポップ画面上で現在1日ごとに表示されている「残数」「販売」の月の合計を予約ポップ上に表示してほしい by cxw END
		//--------------------------
		// 六曜計算(和暦計算表示制御共通関数呼び出し)
		//--------------------------
		if({!isShowQreqki})
			QREKI.jinya.bindInstance($j, "qrekispan", "dtval");
    });
</script>
    <!-- ラックレート -->  <!-- 残室数 -->
    <!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz BEGIN -->
    <apex:pageBlock id="blockId" title="{!thisYear}/{!thisMonth}{!$Label.ps__msg_003_0098}{!IF(isRaceRateFlg, $Label.ps__msg_003_0023, $Label.ps__msg_003_0024)}">
    <!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz END -->
    <apex:pageMessages rendered="{!(!isStockTlSalesInfoNoErrFlg && isTlSalesFlg)}"/>
	<input type="hidden" value="{!planName}" id="hidPlanNm" />
	<!--  2018/05/11 ラックレート設定の自動なしの場合故障修正 by ZY BEGIN -->
	<input type="hidden" value="{!planSyncInfo}" id="hidPlanSyncInfo" />
	<!--  2018/05/11 ラックレート設定の自動なしの場合故障修正 by ZY END -->
	<input type="hidden" value="{!planPrice}" id="hidPlanPrice" />
	<input type="hidden" value="{!planAccId}" id="hidPlanAccId" />
	<input type="hidden" value="{!hadZeroFlag}" id="hidZeroFlag" />
	<input type="hidden" value="{!servicePriceIncTax}" id="hidServicePriceIncTax" />
	<input type="hidden" value="{!specialTax}" id="hidSpecialTax" />
	<input type="hidden" value="{!taxRate}" id="hidTaxRate" />
	<input type="hidden" value="{!isRaceRateFlg}" id="hidIsRateRateFlg" />
	<!-- 2018/07/27 宿泊税計算 WGCH BEGIN -->
	<input type="hidden" value="{!hotelInfoJson}" id="hidHotelInfoJson" />
	<!-- 2018/12/15 在庫調整と販売状態管理 by zy BEGIN -->
	<apex:inputhidden value="{!requestStr}" id="hidRequestJson"/>
	<!-- 2018/12/15 在庫調整と販売状態管理 by zy END -->
	<!-- 2019/06/15 新規予約を部屋ごとに時間と到着日をデフォルト設定 BY zyz BEGIN -->
	<input type="hidden" value="{!leadTimeJsons}" id="hidDefJson"/>
	<!-- 2019/06/15 新規予約を部屋ごとに時間と到着日をデフォルト設定 BY zyz END -->
	<!-- 2018/07/27 宿泊税計算 WGCH END -->
	<!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz BEGIN -->
	<!-- 窗口保存josn -->
	<apex:inputhidden value="{!planJsonStr}" id="hidPlanJsonStr"/>
	<!-- 页面保存josn -->
	<apex:inputhidden value="{!planOneJsonStr}" id="hidPlanOneJsonStr"/>
	<input type="hidden"  id="hidBasePlanShopId" value="{!BasePlanShopId}" />
	<!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz END -->
	<!-- 2020/05/30 予約ポップラックレート設定[プラン]bug対応 BY zyz BEGIN -->
	<input type="hidden"  id="hidisPlanActionFlg" value="{!isPlanActionFlg}" />
	<!-- 2020/05/30 予約ポップラックレート設定[プラン]bug対応 BY zyz END -->
	<!-- 2020/11/30 リアルAGT増返室ボタン機能新規追加 WGCH BEGIN -->
	<apex:inputhidden value="{!roomsChangeJsonStr}" id="hidRoomsChangeJsonStr"/>
	<!-- 2020/11/30 リアルAGT増返室ボタン機能新規追加 WGCH END -->
	<!-- 2021/06/31 #11821 bug fixed by zy BEGIN-->
	<input type="hidden" value="{!basePlanShopCode}" id="hidBaePlanShopCode"/>
	<!-- 2021/06/31 #11821 bug fixed by zy END -->
    <apex:pageBlockButtons location="top">
    	<!-- 前月 -->
       	<apex:commandButton style="width:100px;" styleClass="btn" value="{!$Label.ps__msg_003_0025}" action="{!toPrev}" reRender="dispForm, messageForm" status="refStatusBlock"/>
       	<!-- 今月 -->
       	<apex:commandButton style="width:100px;" styleClass="btn" value="{!$Label.ps__msg_003_0026}" action="{!init}" reRender="dispForm, messageForm" status="refStatusBlock"/>
       	<!-- 来月 -->
       	<apex:commandButton style="width:100px;" styleClass="btn" value="{!$Label.ps__msg_003_0027}" action="{!toNext}" reRender="dispForm, messageForm" status="refStatusBlock"/>
       	<!-- 在庫更新 -->
       	<input type="button" class="btn"
           style="color: #ffffff; background-color: #00FF00; background-image: url({!URLFOR($Resource.reportFiles, 'img/blank')}); width: 100px"
           value="{!$Label.MSG_003_0028}" onclick="javascript:stockRefresh()"  />
		<!-- タイムテーブル -->
		<input type="button" value="{!$Label.MSG_003_0029}" class="btn" style="width:100px;" onclick="openBookingInfoWin()"/>
		<!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz BEGIN -->
		<!--<apex:selectList value="{!actionModeType}" styleClass="btn" id="pageModeType" size="1" style="max-width:420px;font-size:12px;height:22px;">-->
	    <apex:selectList value="{!actionModeType}" styleClass="btn" id="pageModeType" size="1" style="max-width:380px;font-size:12px;height:22px;">
	    <!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz END -->
	       <apex:selectOptions value="{!filterPlanList}"/>
	       	<!-- 2018/03/12 ラックレート部屋タイプ別の対応　by　zy　BEGIN -->
	       	<!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz BEGIN -->
			<apex:actionSupport event="onchange" action="{!switchPage}" onbeforedomupdate="hideTier()" rerender="BasePlanCssId,dispForm,blockId,windowFormId" status="refStatusBlock"/>
	    	<!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz END -->
	    	<!-- 2018/03/12 ラックレート部屋タイプ別の対応　by　zy　END -->
	    </apex:selectList>
	    <!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz BEGIN -->
	    <apex:selectList value="{!planVipStr}" styleClass="btn" id="planVipStr" size="1" style="max-width:420px;font-size:12px;height:22px;" rendered="{!planVipList.size > 0}">
	       <apex:selectOptions value="{!planVipList}"/>
			<apex:actionSupport event="onchange" action="{!switchPage}" onbeforedomupdate="hideTier()" rerender="dispForm,blockId" status="refStatusBlock"/>
	    </apex:selectList>
	    <!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz END -->
	    <!-- 2018/10/16 予約ポップの「月」の表示箇所を移動対応 zyz BEGIN -->
        <!-- 2019/10/30 予約ポップで表示されている残室数を期間指定してcsv出力 BY zyz BEGIN -->
        <apex:outputPanel rendered="{!OR(isStockFlg || isRakurateFlg)}">
			<!-- 2021/05/31 年、月を変えた後に送信ボタンで更新がかかる機能対応 by WSQ BEGIN-->
        	<input type="button" value="CSV出力" class="btn" style="width:80px;" onclick="downloadCsv();"/>
			<!-- 2021/05/31 年、月を変えた後に送信ボタンで更新がかかる機能対応 by WSQ END-->
        </apex:outputPanel>
        <!-- 2019/10/30 予約ポップで表示されている残室数を期間指定してcsv出力 BY zyz END -->
	    <!--<apex:outputPanel style="{!IF(yearMonthRightPosition, 'float:right;','float:left;margin-right:10px')};vertical-align:top;">-->
        <apex:outputPanel style="{!IF(yearMonthRightPosition,IF(yearMonthLeftFlg,'position:absolute;left:230px','float:right;') ,'float:left;margin-right:10px')};vertical-align:top;">
        <!-- 2018/10/16 予約ポップの「月」の表示箇所を移動対応 zyz　END -->
            <apex:selectList size="1" value="{!thisYear}" style="height:24px;font-size:16px;" id="selectYear">
                <apex:selectOptions value="{!yearList}" />
				<!-- 2021/05/31 年、月を変えた後に送信ボタンで更新がかかる機能対応 by WSQ BEGIN-->
                <apex:actionSupport event="onchange" onsubmit="syncSelectInfo(this.value, 'selectYear'); {!IF(yearMonthChangeEventByBtn, 'return false;', '')}"
                action="{!gotoYearMonth}" rerender="dispForm, messageForm" status="refStatusBlock" />
				<!-- 2021/05/31 年、月を変えた後に送信ボタンで更新がかかる機能対応 by WSQ END-->
            </apex:selectList>
            <!-- 2018/10/16 予約ポップの「月」の表示箇所を移動対応 zyz BEGIN -->
            <apex:commandButton value="<<" action="{!toPrev}" reRender="dispForm, messageForm"
                style="margin-left:-5px;margin-right:2px;height:24px;width:24px;vertical-align:top;" status="refStatusBlock"/>
            <!-- 2018/10/16 予約ポップの「月」の表示箇所を移動対応 zyz END -->
            <apex:selectList size="1" value="{!thisMonth}" style="height:24px;font-size:16px;" id="selectMonth">
                <!-- 1月 -->
                <apex:selectOption itemValue="1" itemLabel="{!$Label.ps__msg_003_0030}"/>
                <!-- 2月 -->
                <apex:selectOption itemValue="2" itemLabel="{!$Label.ps__msg_003_0031}"/>
                <!-- 3月 -->
                <apex:selectOption itemValue="3" itemLabel="{!$Label.ps__msg_003_0032}"/>
                <!-- 4月 -->
                <apex:selectOption itemValue="4" itemLabel="{!$Label.ps__msg_003_0033}"/>
                <!-- 5月 -->
                <apex:selectOption itemValue="5" itemLabel="{!$Label.ps__msg_003_0034}"/>
                <!-- 6月 -->
                <apex:selectOption itemValue="6" itemLabel="{!$Label.ps__msg_003_0035}"/>
                <!-- 7月 -->
                <apex:selectOption itemValue="7" itemLabel="{!$Label.ps__msg_003_0036}"/>
                <!-- 8月 -->
                <apex:selectOption itemValue="8" itemLabel="{!$Label.ps__msg_003_0037}"/>
                <!-- 9月 -->
                <apex:selectOption itemValue="9" itemLabel="{!$Label.ps__msg_003_0038}"/>
                <!-- 10月 -->
                <apex:selectOption itemValue="10" itemLabel="{!$Label.ps__msg_003_0039}"/>
                <!-- 11月 -->
                <apex:selectOption itemValue="11" itemLabel="{!$Label.ps__msg_003_0040}"/>
                <!-- 12月 -->
                <apex:selectOption itemValue="12" itemLabel="{!$Label.ps__msg_003_0041}"/>
				<!-- 2021/05/31 年、月を変えた後に送信ボタンで更新がかかる機能対応 by WSQ BEGIN-->
                <apex:actionSupport event="onchange" onsubmit="syncSelectInfo(this.value, 'selectMonth'); {!IF(yearMonthChangeEventByBtn, 'return false;', '')}"
                action="{!gotoYearMonth}" rerender="dispForm, messageForm" status="refStatusBlock"/>
				<!-- 2021/05/31 年、月を変えた後に送信ボタンで更新がかかる機能対応 by WSQ BEGIN-->
            </apex:selectList>
            <!-- 2018/10/16 予約ポップの「月」の表示箇所を移動対応 zyz BEGIN -->
            <apex:commandButton value=">>" action="{!toNext}"
                reRender="dispForm, messageForm" style="margin-left:-5px;height:24px;width:24px;vertical-align:top;" status="refStatusBlock"/>
            <!-- 2018/10/16 予約ポップの「月」の表示箇所を移動対応 zyz END -->
	    	<!-- 2021/05/31 年、月を変えた後に送信ボタンで更新がかかる機能対応 by WSQ BEGIN-->
            <apex:commandButton value="送信" action="{!gotoYearMonth}" 
                reRender="dispForm, messageForm" style="height:24px;width:60px;vertical-align:top;" status="refStatusBlock"
                rendered="{!yearMonthChangeEventByBtn}"/>
	    	<!-- 2021/05/31 年、月を変えた後に送信ボタンで更新がかかる機能対応 by WSQ END-->

        </apex:outputPanel>
    </apex:pageBlockButtons>
	<!-- 支店機能 -->
	<apex:outputLabel >
	<table><tr>
	<td nowrap="nowrap">
	    <apex:selectList size="1" value="{!branchShopNm}" id="branchShopCd" rendered="{!branchShopLst.size > 0}">
            <!-- All -->
	        <apex:selectOption itemValue="" itemLabel="{!$Label.ps__msg_003_0042}"/>
	        <apex:selectOptions value="{!branchShopLst}" />
	        <apex:actionSupport event="onchange" action="{!changeBranchShop}" />
    </apex:selectList>
    <!-- ラクレットの場合（残室数）以外の場合、該当情報を表示すうる -->
    <!-- 2020/04/30 予約ポップの残室数画面を改修 WGCH BEGIN -->
    <!-- <apex:outputLabel rendered="{!isRaceRateFlg}"> -->
    <apex:outputLabel rendered="{!(isRaceRateFlg || isRaceRateComFlg)}">
    <!-- 2020/04/30 予約ポップの残室数画面を改修 WGCH END -->
    <!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz BEGIN -->
    <apex:outputLabel rendered="{!!isBasePlanFlg}">
    <!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz END -->
    <!-- 人数 -->
    <span>{!$Label.ps__msg_003_0043}</span>
    <apex:selectList size="1" value="{!persons}" id="persionSel">
    	<apex:selectOptions value="{!personsLst}" />
    	<apex:actionSupport event="onchange" action="{!refreshNewInfo}" rerender="dispForm" status="refStatusBlock"/>
    </apex:selectList>
    <apex:outputLabel rendered="{!(value(persons) > 1)}">
        <!-- 名様ご利用で、1名様のご利用金額を表示 -->
    	<span>{!persons}{!$Label.ps__msg_003_0044}</span>
    </apex:outputLabel>
    </apex:outputLabel>
    <!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz BEGIN -->
    </apex:outputLabel>
   	<!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz END -->

	</td>
	<td nowrap="nowrap">
		<!-- サイトコントローラ側から残室数照会する場合 -->
		<apex:outputPanel rendered="{!isTlSalesFlg}">
			<table><tr><td style="display: {!IF(isHaveTlSaleInfo,'','none')}">
			<apex:selectRadio value="{!actionModeType_TlSub}">
                <!-- 部屋タイプ別 -->
				<apex:selectOption itemValue="{!CONST_PAGELAYOUT_TLSTATUS_ROOMTYPE}" itemLabel="{!$Label.ps__msg_003_0109}"/>
                <!-- 販売先別 -->
				<apex:selectOption itemValue="{!CONST_PAGELAYOUT_TLSTATUS_NETSALES}" itemLabel="{!$Label.ps__msg_003_0110}"/>
				<apex:actionSupport event="onchange" action="{!refreshNewInfo}" rerender="dispForm" status="refStatusBlock"/>
			</apex:selectRadio>
			</td><td>
			<apex:outputPanel >
            <!-- 売止 -->
			<apex:outputPanel rendered="{!isHaveTlSaleInfo}" style="vertical-align: middle;margin-left: 20px ">&nbsp;{!$Label.MSG_003_0111}&nbsp;<img src="{!URLFOR($Resource.reportFiles, 'img/blank')}" style="height:12px;width:16px;vertical-align:top;" class="statusSalesStop" /></apex:outputPanel>
			
			<!-- 手仕舞い -->
			<apex:outputPanel rendered="{!isHaveTaSaleInfo}" style="vertical-align: middle;margin-left: 20px ">&nbsp;手仕舞い&nbsp;<img src="{!URLFOR($Resource.reportFiles, 'img/blank')}" style="height:12px;width:16px;vertical-align:top;" class="taStatusSalesStop" /></apex:outputPanel>
			</apex:outputPanel>
			</td></tr></table>
		</apex:outputPanel>
	</td>
	
	<td width="100%">
	    <apex:outputPanel style="float:right;margin-right:50px;vertical-align:top;" rendered="{!isRaceRateFlg}">
	    <!-- 通貨: 円 -->
        <span style="font-size: 14px"> {!currencyLabel}</span>
	    </apex:outputPanel>
	</td>
	</tr></table>
	</apex:outputLabel>
 <!-- 残室数表示Section -->
 <apex:outputPanel id="ciTable" rendered="{!!isTlSalesFlg}">
    <table id="dTable" class="list datatable" border="0" cellpadding="0" cellspacing="0">
        <thead class="rich-table-thead">
        <tr class="headerRow _firstrow" nowrap="nowrap">
        	<!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz BEGIN -->
            <th class="headerRow leftPanel leftBasePanel" colspan="2" nowrap="nowrap">
                <!-- 部屋タイプ -->
                <apex:outputText rendered="{!!isBasePlanFlg}" value="{!$Label.ps__msg_003_0046}"/>
                <!-- TODO:文字是否调整为label -->
                <apex:outputText rendered="{!isBasePlanFlg}" value="ベースプラン"/>
                <!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz END -->
            </th>
            <apex:repeat var="col" value="{!dispHeaders}">
	    	<!-- 2018/12/15 在庫調整と販売状態管理 by zy BEGIN -->
                <th class="headerRow" nowrap="nowrap" dt="{!col.name}" style="text-align:center;width:38px; background: {!headerColorMap[col.days]}; url({!URLFOR($Resource.reportFiles, 'img/blank')});">
                    <a	target="_blank" style ="text-decoration:underline" 
                   		href="{!IF(LEN($Setup.CommDefine__c.ps__RoomTypeDateLinkFlg__c) = 0 || $Setup.CommDefine__c.ps__RoomTypeDateLinkFlg__c == '1', '/apex/RoomIndicatorInfo?dt='+col.name, '/' + reportId + '?colDt_s=' + col.name + '&colDt_e=' + col.name )}" title="{!col.holidayLab}">{!col.label}</a>
                </th>
		<!-- 2018/12/15 在庫調整と販売状態管理 by zy END -->
            </apex:repeat>
            <!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz BEGIN -->
            <th class="headerRow leftPanel leftBasePanel" nowrap="nowrap">
                <!-- 部屋タイプ -->
                <apex:outputText rendered="{!!isBasePlanFlg}" value="{!$Label.ps__msg_003_0046}"/>
                <!-- TODO:文字是否调整为label -->
                <apex:outputText rendered="{!isBasePlanFlg}" value="ベースプラン"/>
                <!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz END -->
            </th>
        </tr>
        <!-- 六曜 -->
        <tr class="headerRow" nowrap="nowrap" style="display:{!IF(isShowQreqki,'','none')}">
            <!-- 六輝 -->
            <!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz BEGIN -->
            <th class="headerRow leftPanel" nowrap="nowrap" colspan="2">{!$Label.MSG_003_0047}</th>
            <!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz END -->
            <apex:repeat var="col" value="{!dispHeaders}">
                <td class="headerRow" nowrap="nowrap" style="text-align:center;width:38px;">
                    <span class="qrekispan" dtval="{!col.name}"></span>
                </td>
            </apex:repeat>
            <!-- 六輝 -->
            <th class="headerRow leftPanel" nowrap="nowrap">{!$Label.ps__msg_003_0047}</th>
        </tr>
        
        <tr style="background:#FFFACD; url({!URLFOR($Resource.reportFiles, 'img/blank')});">
        	<!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz BEGIN -->
            <th class="headerRow" nowrap="nowrap"  colspan="2">
            <!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz END -->
                <!-- 販売 -->
                <apex:outputText value="{!$Label.ps__msg_003_0048}"/>
            </th>
            <apex:repeat var="col" value="{!dispHeaders}">
                <td class="headerRow" nowrap="nowrap" style="text-align:center;">
                    <apex:outputText value="{0,number,###}">
                    <!-- 2020/05/29 在庫計算ロジック改修 WGCH BEGIN -->
                    <!-- <apex:param value="{!usedRoomsMap[col.days]}" /> -->
                    <apex:param value="{!IF(isStockSyncIsMode, (usedRoomsMap[col.days] + usedAgtRoomsMap[col.days]), usedRoomsMap[col.days])}" />
                    <!-- 2020/05/29 在庫計算ロジック改修 WGCH END -->
                    </apex:outputText>
                </td>
            </apex:repeat>
            <th class="headerRow" nowrap="nowrap">
                <!-- 販売 -->
                <apex:outputText value="{!$Label.ps__msg_003_0048}"/>
            </th>
        </tr>
        <tr style="background:#FFFACD; url({!URLFOR($Resource.reportFiles, 'img/blank')});">
        	<!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz BEGIN -->
            <th class="headerRow" nowrap="nowrap" colspan="2">
            <!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz END -->
                <!-- 残室 -->
                <apex:outputText value="{!$Label.ps__msg_003_0049}"/>
            </th>
            <apex:repeat var="col" value="{!dispHeaders}">
                <td class="headerRow" nowrap="nowrap" style="text-align:center;">
                    <!-- 2020/05/29 在庫計算ロジック改修 WGCH BEGIN -->
                    <!--
                    <apex:outputText value="{0,number,###}" style="color:{!IF((sumDayMaxRooms - usedRoomsMap[col.days] - badRoomsMap[col.days]) < minRooms, 'red','black')}">
		            <apex:param value="{!sumDayMaxRooms - usedRoomsMap[col.days] - badRoomsMap[col.days]}" />
		            </apex:outputText>
		            -->
		            <!-- 2020/06/15 BUGFIX-FLASE故障房间数未减 WGCH BEGIN -->
		            <apex:outputText value="{0,number,###}" style="color:{!IF((IF(isStockSyncIsMode, (sumDayMaxRooms - usedRoomsMap[col.days] - badRoomsMap[col.days] - mstMaxRoomsAllMap[col.days]), (sumDayMaxRooms - usedRoomsMap[col.days] - badRoomsMap[col.days]))) < minRooms, 'red','black')}">
		            <apex:param value="{!IF(isStockSyncIsMode, (sumDayMaxRooms - usedRoomsMap[col.days] - badRoomsMap[col.days] - mstMaxRoomsAllMap[col.days]), (sumDayMaxRooms - usedRoomsMap[col.days] - badRoomsMap[col.days]))}" />
		            </apex:outputText>
		            <!-- 2020/06/15 BUGFIX-FLASE故障房间数未减 WGCH END -->
		            <!-- 2020/05/29 在庫計算ロジック改修 WGCH END -->
                </td>
            </apex:repeat>
            <th class="headerRow" nowrap="nowrap">
                <!-- 残室 -->
                <apex:outputText value="{!$Label.ps__msg_003_0049}"/>
            </th>
        </tr>
        <!-- E/B -->
        <tr style="background:#FFFACD; url({!URLFOR($Resource.reportFiles, 'img/blank')}); display:{!if(isHaveEbInfo, 'true', 'none')}">
            <!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz BEGIN -->
            <th class="headerRow" nowrap="nowrap" colspan="2">
            <!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz END -->
                <!-- E/B -->
                <apex:outputText value="{!$Label.ps__msg_003_0050}"/>
            </th>
            <apex:repeat var="col" value="{!dispHeaders}" rendered="{!isHaveEbInfo}">
                <td class="headerRow" nowrap="nowrap" style="text-align:center;">
		            <apex:outputText value="{0,number,###}">
		            <apex:param value="{!sumEbRoomMap[col.days]}" />
		            </apex:outputText>
                </td>
            </apex:repeat>
            <th class="headerRow" nowrap="nowrap">
                <!-- E/B -->
                <apex:outputText value="{!$Label.ps__msg_003_0050}"/>
            </th>
        </tr>

        <!-- 休館 -->
        <tr style="background:#FFFACD; url({!URLFOR($Resource.reportFiles, 'img/blank')}); display:{!if(isShowTierHeader, 'true', 'none')}">
            <!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz BEGIN -->
            <th class="headerRow" nowrap="nowrap" colspan="2">
                <!-- 営業 -->
                <input type="button" value="{!$Label.ps__msg_003_0051}" class="btn" style="width:80px;display:{!if(isBasePlanFlg, 'none', '')}" onclick="javascript:window.open('/apex/CCalendar')"/>
            	<apex:outputPanel rendered="{!isBasePlanFlg}">{!$Label.ps__msg_003_0051}</apex:outputPanel>
            	<!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz END -->
            </th>
            <!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz BEGIN -->
            <apex:repeat var="col" value="{!dispHeaders}" rendered="{!!isBasePlanFlg}">
            <!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz END -->
           		<!-- 2016/07/26 wgch BEGIN -->
                <td class="headerRow" nowrap="nowrap" style="text-align:center;" >
                <!-- 2016/07/26 wgch END -->
                    <input 	type="button" class="btn" style="width:36px;color: {!colorInfoMap[col.days]}" 
                    		value="{!restInfoMap[col.days]}" title="{!restInfoMap[col.days]}" 
                    		onclick="YAHOO.force.com.showLayoffPanel('{!JSENCODE(col.name)}', '{!JSENCODE(restInfoMap[col.days])}')"/>
                </td>
            </apex:repeat>
            <!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz BEGIN -->
            <apex:repeat var="col" value="{!dispHeaders}" rendered="{!isBasePlanFlg}">
                <td class="headerRow" nowrap="nowrap" style="text-align:center;" >
                {!restInfoMap[col.days]}
                </td>
            </apex:repeat>
            <!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz END -->
            <th class="headerRow" nowrap="nowrap">
                <!-- 営業 -->
                <!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz BEGIN -->
                <input type="button" value="{!$Label.ps__msg_003_0051}" class="btn" style="width:80px;display:{!if(isBasePlanFlg, 'none', '')}" onclick="javascript:window.open('/apex/CCalendar')"/>
            	<apex:outputPanel rendered="{!isBasePlanFlg}">{!$Label.ps__msg_003_0051}</apex:outputPanel>
            	<!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz END -->
            </th>
        </tr>

        <!-- TIER --> 
        <tr style="background:#FFFACD; url({!URLFOR($Resource.reportFiles, 'img/blank')}); display:{!if(isShowTierHeader, 'true', 'none')}">
            <!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz BEGIN -->
            <th class="headerRow" nowrap="nowrap" colspan="2" >
            <!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz END -->
                <!-- ラックレート -->
                <input type="button" class="btn" style="width:80px;" value="{!$Label.MSG_003_0023}" onclick="javascript:window.open('/{!raceRateReportId}')"/>
            </th>
            <!-- 2018/03/12 ラックレート部屋タイプ別の対応　by　zy　BEGIN -->
            <!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz BEGIN -->
            <apex:repeat var="col" value="{!dispHeaders}" rendered="{!!isTierFlag && !isBasePlanFlg}">
            <!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz END -->
           <!-- 2018/03/12 ラックレート部屋タイプ別の対応　by　zy　END -->
            	<!-- 2016/07/26 wgch BEGIN -->
                <td class="headerRow" nowrap="nowrap" style="text-align:center;" >
                <!-- 2016/07/26 wgch END -->
                	<!-- 2020/05/30 予約ポップラックレート設定[プラン]bug対応 BY zyz BEGIN -->
                    <!--<input type="button" class="btn" style="font-size: {!IF(LEN(tierHeaderInfoMap[col.days]) > 5, '7pt', '8pt')}" value="{!tierHeaderInfoMap[col.days]}" onclick="YAHOO.force.com.showSchedule('{!JSENCODE(col.name)}','{!JSENCODE(tierHeaderInfoMap[col.days])}')"/>-->
                    <input type="button" class="btn" style="font-size: {!IF(LEN(tierHeaderInfoMap[col.days]) > 5, '7pt', '8pt')}" value="{!tierHeaderInfoMap[col.days]}" onclick="onWindowOf('{!JSENCODE(col.name)}','{!JSENCODE(tierHeaderInfoMap[col.days])}')"/>
                    <!-- 2020/05/30 予約ポップラックレート設定[プラン]bug対応 BY zyz END -->
                </td>
            </apex:repeat>
            <!-- 2018/03/12 ラックレート部屋タイプ別の対応　by　zy　BEGIN -->
            <apex:repeat var="col" value="{!dispHeaders}" rendered="{!isTierFlag}">
            	<!-- 2016/07/26 wgch BEGIN -->
                <td class="headerRow" nowrap="nowrap" style="text-align:center;" >
                <!-- 2016/07/26 wgch END -->
                    <input type="button" class="btn" style="width:36px;" value="設定" onclick="YAHOO.force.com.showSchedule('{!JSENCODE(col.name)}','{!JSENCODE(tierHeaderInfoMap[col.days])}')"/>
                </td>
            </apex:repeat>
            <!-- 2018/03/12 ラックレート部屋タイプ別の対応　by　zy　END -->
            <!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz BEGIN -->
            <apex:repeat var="col" value="{!dispHeaders}" rendered="{!!isTierFlag && isBasePlanFlg}">
                <td class="headerRow" nowrap="nowrap" style="text-align:center;" >
                	<!-- TODO:tier的显示设定可能需要调整 -->
                	<!-- 2020/05/30 予約ポップラックレート設定[プラン]bug対応 BY zyz BEGIN -->
                    <!--<input type="button" class="btn" style="font-size: {!IF(LEN(tierHeaderInfoMap[col.days]) > 5, '7pt', '8pt')}" value="設定" onclick="YAHOO.force.com.showPlanSchedule('{!JSENCODE(col.name)}','{!JSENCODE(tierHeaderInfoMap[col.days])}')"/>-->
                	<input type="button" class="btn" style="font-size: {!IF(LEN(tierHeaderInfoMap[col.days]) > 5, '7pt', '8pt')}" value="設定" onclick="onWindowOf('{!JSENCODE(col.name)}','{!JSENCODE(tierHeaderInfoMap[col.days])}')"/>
                	<!-- 2020/05/30 予約ポップラックレート設定[プラン]bug対応 BY zyz END -->
                </td>
            </apex:repeat>
            <!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz END -->
            <th class="headerRow" nowrap="nowrap">
                <!-- ラックレート -->
                <input type="button" class="btn" style="width:80px;" value="{!$Label.MSG_003_0023}" onclick="javascript:window.open('/{!raceRateReportId}')"/>
            </th>
        </tr>
        <!-- 2018/12/15 在庫調整と販売状態管理 by zy BEGIN -->
        <tr style="background:#FFFACD; url({!URLFOR($Resource.reportFiles, 'img/blank')}); display:{!if(!isTierFlag && isStockFlag, 'true', 'none')}">
        	<!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz BEGIN -->
        	<th class="headerRow" nowrap="nowrap" colspan="2">
        	<!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz END -->
            </th>
            <apex:repeat var="col" value="{!dispHeaders}" rendered="{!!isTierFlag && isStockFlag}">
            	<!-- 2016/07/26 wgch BEGIN -->
                <td class="headerRow" nowrap="nowrap" style="text-align:center;" >
                <!-- 2016/07/26 wgch END -->
                	<!-- 2019/04/30 予約ポップの在庫設定(AGT)の変更機能 BY zyz BEGIN -->
                    <input type="button" class="btn salesBtn" value="販売状態" date='{!JSENCODE(col.name)}' onclick="openSalesPanel()" />
                    <!-- 2019/04/30 予約ポップの在庫設定(AGT)の変更機能 BY zyz END -->
                </td>
            </apex:repeat>
            <th class="headerRow" nowrap="nowrap">
            </th>
        </tr>
        <!-- 2018/12/15 在庫調整と販売状態管理 by zy END -->
        </thead>
        <tbody>
        <apex:repeat id="repeat" var="typesobj" value="{!roomTypeLst}">
        <!-- 2018/12/15 在庫調整と販売状態管理 by zy BEGIN -->
        <!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz BEGIN -->
        <!--<apex:repeat var="row" value="{!dispRecordMap[typesobj.Id]}" rendered="{!!isStockFlag}">-->
        <apex:repeat var="row" value="{!dispRecordMap[typesobj.Id]}" rendered="{!!isStockFlag && !isBasePlanFlg}">
        <!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz END -->
       	<!-- 2018/12/15 在庫調整と販売状態管理 by zy END -->
        <tr  onmouseover="if (window.hiOn){hiOn(this);} " onmouseout="if (window.hiOff){hiOff(this);} " onBlur="if (window.hiOff){hiOff(this);}" onFocus="if (window.hiOn){hiOn(this);}">
            <!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz BEGIN -->
            <td class="dataCell leftPanelItem" colspan="2" >
            <!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz END -->
                <a href="/{!row.roomTypeId}" id="{!row.roomTypeId}1" onblur="LookupHoverDetail.getHover('{!row.roomTypeId}1').hide();" onfocus="LookupHoverDetail.getHover('{!row.roomTypeId}1', '/{!row.roomTypeId}/m?retURL=%2F{!row.roomTypeId}&isAjaxRequest=1').show();" onmouseout="LookupHoverDetail.getHover('{!row.roomTypeId}1').hide();" onmouseover="LookupHoverDetail.getHover('{!row.roomTypeId}1', '/{!row.roomTypeId}/m?retURL=%2F{!row.roomTypeId}&isAjaxRequest=1').show();">{!row.roomTypeNm}</a>
            </td>
            <!-- 2018/03/12 ラックレート部屋タイプ別の対応　by　zy　BEGIN -->
            <!-- TIER一覧 -->
		    <apex:repeat var="col" value="{!row.roomList}" rendered="{!isTierFlag}">
		    	 <td class="dataCell"  style="text-align: center;position: relative;">
		    	 	<!-- tierリスト -->
			    	<apex:selectList size="1" value="{!col.tier.tier}" html-oldvalue="{!col.tier.tier}" html-date="{!col.stock.StockDate__c}"  
			    				html-typeid="{!row.roomTypeId}" styleClass="defaultTierClass {!col.tier.tierClass} {!col.tier.tier}"
			    				onchange="changeTierClass(this)" id="curTier" disabled="{!colStatusMap[col.stock.StockDate__c].disable || !isShowTierHeader}">
		                <apex:selectOptions value="{!tiersLst}" />
		            </apex:selectList>
		            <!-- 残室数 -->
		            <div style="margin-top:2px;color:{!IF(FLOOR(col.stock.QtyOfStock__c) < 0, 'red','black')};">{!FLOOR(col.stock.QtyOfStock__c)}</div>
		            <!-- 变更角标 -->
		            <span name="updateSpan"></span>
	            </td>
		    </apex:repeat>
		    <!-- 2018/12/15 在庫調整と販売状態管理 by zy BEGIN -->
            <apex:repeat var="col" value="{!row.roomList}" rendered="{!!isTierFlag && !isStockFlag}">
            <!-- 2018/12/15 在庫調整と販売状態管理 by zy END -->
                <!-- 2020/04/30 予約ポップの残室数画面を改修 WGCH BEGIN -->
                <!-- <td class="dataCell {!col.tier.tier}"  nowrap="nowrap" style="text-align: center;height:18px"> -->
                <td class="dataCell {!col.tier.tier}"  nowrap="nowrap" style="text-align: center;{!IF(isRaceRateComFlg, 'height:32px;', 'height:18px;')}">
                <!-- 2020/04/30 予約ポップの残室数画面を改修 WGCH END -->
              <!-- 2018/03/12 ラックレート部屋タイプ別の対応　by　zy　END -->  	
                	<!-- 残室数 -->
                    <apex:outputLabel rendered="{!!isRaceRateFlg}">
                    <!-- 2018/03/12 ラックレート部屋タイプ別の対応　by　zy　BEGIN -->
	                    <apex:outputLabel value="{!FLOOR(col.stock.QtyOfStock__c)}" rendered="{!colStatusMap[col.stock.StockDate__c].disable}"
	                        style="width:36px;height:20px;
	                        color:{!IF(FLOOR(col.stock.QtyOfStock__c) < 0, 'red','black')};" />
	                    <!-- 2018/07/27 宿泊税計算 WGCH BEGIN -->
	                    <!-- 2020/04/30 予約ポップの残室数画面を改修 WGCH BEGIN -->
	                    <apex:outputLabel rendered="{!!isRaceRateComFlg}">
	                    <input  name="bookingBtn" type="button" class="btn"
	                        style="width:36px;height:20px;
	                        color:{!IF(FLOOR(col.stock.QtyOfStock__c) < 0, 'red','black')};
	                        display: {!if (colStatusMap[col.stock.StockDate__c].disable, 'none', 'true')};" 
	                        stockDate="{!col.stock.StockDate__c}" roomTypeId="{!row.roomTypeId}" roomTyNm="{!HTMLENCODE(row.roomTypeNm)}" roomspcd="{!HTMLENCODE(row.shopCode)}" 
	                        value="{!FLOOR(col.stock.QtyOfStock__c)}" />
	                    </apex:outputLabel>
	                    <apex:outputLabel rendered="{!isRaceRateComFlg}">
	                    <!-- 2020/05/29 エステなど商品を追加したプラン機能 WGCH BEGIN -->
	                    <input name="bookingBtn" type="button" class="btn btnCls"
	                        style="max-width:50px;height:32px;min-width:36px;
	                        color:{!IF(FLOOR(col.stock.QtyOfStock__c) < 0, 'red','black')};
	                        display: none;"
	                        raceRatePrice="{!TEXT(raceRatePriceMap[row.roomTypeId][col.stock.StockDate__c])}"
	                        stockDate="{!col.stock.StockDate__c}" roomTypeId="{!row.roomTypeId}" roomTyNm="{!HTMLENCODE(row.roomTypeNm)}" roomspcd="{!HTMLENCODE(row.shopCode)}" />
	                    <!-- 2020/05/29 エステなど商品を追加したプラン機能 WGCH END -->
	                    	<div class="k-button btnCls" style="min-width:96%;padding: 0px;margin: 0px; display: {!if (colStatusMap[col.stock.StockDate__c].disable, 'none', 'true')};" onclick="openNewWindow(this)" >
	                        	<div style="height: 14px;padding: 0px;margin: 0px;color:{!IF(FLOOR(col.stock.QtyOfStock__c) < 0, 'red','black')};">{!FLOOR(col.stock.QtyOfStock__c)}</div>
	                        	<div style="height: 16px;padding: 0px;margin: 0px;">{!TEXT(raceRatePriceMap[row.roomTypeId][col.stock.StockDate__c])}</div>
	                        </div>
	                    </apex:outputLabel>
	                    <!-- 2020/04/30 予約ポップの残室数画面を改修 WGCH END -->
	                    <!-- 2018/07/27 宿泊税計算 WGCH BEGIN -->
	                </apex:outputLabel>
	                <!-- 2018/03/12 ラックレート部屋タイプ別の対応　by　zy　END -->
                   	<!-- 料金情報 -->
                    <apex:outputLabel rendered="{!isRaceRateFlg}">
                    	<!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz BEGIN -->
                    	<apex:outputLabel rendered="{!!tierButtonInfoMap[col.stock.StockDate__c]}">
                    	<!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz END -->
						<!-- 料金情報を表示する -->
						<!-- 2018/03/12 ラックレート部屋タイプ別の対応　by　zy　BEGIN -->
	                    <apex:outputtext value="{0,number,###}" style="font-size: 12px" rendered="{!colStatusMap[col.stock.StockDate__c].disable}">
	                    	<apex:param value="{!raceRatePriceMap[row.roomTypeId][col.stock.StockDate__c]}" />
	                    </apex:outputtext>
	                   <!-- 2018/03/12 ラックレート部屋タイプ別の対応　by　zy　END -->
	                    <!-- 料金表から予約可能 -->
	                    <!-- 2018/03/12 ラックレート部屋タイプ別の対応　by　zy　BEGIN -->
	                    <!-- 2020/05/29 予約ポップの残室数画面を改修 WGCH BEGIN -->
	                    <!-- 2021/04/30 ベースプラン選択時も残室数と金額の同時表示機能追加 WGCH BEGIN -->
	                    <!-- 
	                    <apex:outputLabel rendered="true">
	                    -->
	                    <apex:outputLabel rendered="{!!isRaceRateComFlg}">
	                    <!-- 2021/04/30 ベースプラン選択時も残室数と金額の同時表示機能追加 WGCH END -->
	                    <apex:outputLabel rendered="{!!colStatusMap[col.stock.StockDate__c].disable}">
	                    	<!-- 2018/07/27 宿泊税計算 WGCH BEGIN -->
	                    	<!-- 2020/05/29 エステなど商品を追加したプラン機能 WGCH BEGIN -->
	                    	<input  name="bookingBtn" type="button" class="btn"
	                    	title="{!TEXT(raceRatePriceMap[row.roomTypeId][col.stock.StockDate__c])}"
	                        style="{!IF(raceRatePriceMap[row.roomTypeId][col.stock.StockDate__c]>99999, 
	                        			'font-size:8px;', 
	                        		(IF(raceRatePriceMap[row.roomTypeId][col.stock.StockDate__c]>9999, 
	                        		 	'font-size:10px', 'font-size:11px'))
	                        		)};width:36px;height:22px"
	                        raceRatePrice="{!TEXT(raceRatePriceMap[row.roomTypeId][col.stock.StockDate__c])}"
	                        stockDate="{!col.stock.StockDate__c}" roomTypeId="{!row.roomTypeId}" roomTyNm="{!HTMLENCODE(row.roomTypeNm)}" roomspcd="{!HTMLENCODE(row.shopCode)}" 
	                        value="{!TEXT(raceRatePriceMap[row.roomTypeId][col.stock.StockDate__c])}" />
	                        <!-- 2020/05/29 エステなど商品を追加したプラン機能 WGCH END -->
	                        <!-- 2018/07/27 宿泊税計算 WGCH END -->
	                   </apex:outputLabel>
	                   </apex:outputLabel>
	                   <!-- 2021/04/30 ベースプラン選択時も残室数と金額の同時表示機能追加 WGCH BEGIN -->
	                   <!--
	                   <apex:outputLabel rendered="false">
	                   -->
	                   <apex:outputLabel rendered="{!isRaceRateComFlg}">
	                   <apex:outputLabel rendered="{!!colStatusMap[col.stock.StockDate__c].disable}">
	                   <!-- 2021/04/30 ベースプラン選択時も残室数と金額の同時表示機能追加 WGCH END -->
	                   		<input  name="bookingBtn" type="button" class="btn btnCls"
		                    	title="{!TEXT(raceRatePriceMap[row.roomTypeId][col.stock.StockDate__c])}"
		                        style="display:none;width:36px;height:22px"
		                        stockDate="{!col.stock.StockDate__c}" roomTypeId="{!row.roomTypeId}" roomTyNm="{!HTMLENCODE(row.roomTypeNm)}" roomspcd="{!HTMLENCODE(row.shopCode)}" 
		                        value="{!TEXT(raceRatePriceMap[row.roomTypeId][col.stock.StockDate__c])}" />
	                        <div class="k-button btnCls" style="min-width:96%;padding: 0px;margin: 0px; display: {!if (colStatusMap[col.stock.StockDate__c].disable, 'none', 'true')};" onclick="openNewWindow(this)" >
	                        	<div style="height: 14px;padding: 0px;margin: 0px;color:{!IF(FLOOR(col.stock.QtyOfStock__c) < 0, 'red','black')};">{!FLOOR(col.stock.QtyOfStock__c)}</div>
	                        	<div style="height: 16px;padding: 0px;margin: 0px;">{!TEXT(raceRatePriceMap[row.roomTypeId][col.stock.StockDate__c])}</div>
	                        </div>
                        </apex:outputLabel>
                        <!-- 2020/05/29 予約ポップの残室数画面を改修 WGCH END -->
                        <!-- 2021/04/30 ベースプラン選択時も残室数と金額の同時表示機能追加 WGCH BEGIN -->
                        </apex:outputLabel>
                        <!-- 2021/04/30 ベースプラン選択時も残室数と金額の同時表示機能追加 WGCH END -->
                    	<!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz BEGIN -->
                    	</apex:outputLabel>
                    	<apex:outputtext value="{0,number,###}" style="font-size: 12px" rendered="{!tierButtonInfoMap[col.stock.StockDate__c]}">
	                    	<apex:param value="{!raceRatePriceMap[row.roomTypeId][col.stock.StockDate__c]}" />
	                    </apex:outputtext>
                    	<!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz END -->	                   
                   	</apex:outputLabel>
                   	<!-- 2018/03/12 ラックレート部屋タイプ別の対応　by　zy　END -->
                </td>
            </apex:repeat>
            <td class="dataCell leftPanelItem" >
                <a href="/{!row.roomTypeId}" id="{!row.roomTypeId}2" onblur="LookupHoverDetail.getHover('{!row.roomTypeId}2').hide();" onfocus="LookupHoverDetail.getHover('{!row.roomTypeId}2', '/{!row.roomTypeId}/m?retURL=%2F{!row.roomTypeId}&isAjaxRequest=1').show();" onmouseout="LookupHoverDetail.getHover('{!row.roomTypeId}2').hide();" onmouseover="LookupHoverDetail.getHover('{!row.roomTypeId}2', '/{!row.roomTypeId}/m?retURL=%2F{!row.roomTypeId}&isAjaxRequest=1').show();">{!row.roomTypeNm}</a>
            </td>
        </tr>
        </apex:repeat>
         <!-- 2018/12/15 在庫調整と販売状態管理 by zy BEGIN -->
       	 <apex:repeat var="row" value="{!dispRecordMap[typesobj.Id]}" rendered="{!isStockFlag}">
        	<tr class="stockRow" typeid="{!row.roomTypeId}" >
        		<!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz BEGIN -->
        		<td class="dataCell leftPanelItem" colspan="2">
        		<!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz END -->
	                <a href="/{!row.roomTypeId}" id="{!row.roomTypeId}1" onblur="LookupHoverDetail.getHover('{!row.roomTypeId}1').hide();" onfocus="LookupHoverDetail.getHover('{!row.roomTypeId}1', '/{!row.roomTypeId}/m?retURL=%2F{!row.roomTypeId}&isAjaxRequest=1').show();" onmouseout="LookupHoverDetail.getHover('{!row.roomTypeId}1').hide();" onmouseover="LookupHoverDetail.getHover('{!row.roomTypeId}1', '/{!row.roomTypeId}/m?retURL=%2F{!row.roomTypeId}&isAjaxRequest=1').show();">
	                	{!row.roomTypeNm}
	                </a>
	            </td>
	            <apex:repeat var="col" value="{!row.roomList}" rendered="{!!isTierFlag && isStockFlag}">
			    	<td class="dataCell"  style="text-align: center;position: relative;padding: 0px"  typeid="{!row.roomTypeId}" date="{!col.stock.StockDate__c}" >
			    		<apex:outputpanel rendered="{!colStatusMap[col.stock.StockDate__c].disable}">
			    			<span class="stockSpan">{!FLOOR(col.stock.QtyOfStock__c)}</span>
			    		</apex:outputpanel>
			    		<apex:outputpanel rendered="{!!colStatusMap[col.stock.StockDate__c].disable}">
			    			<!-- 残室数 -->
				            <table class="changeTable">
				            	<tr>
				            		<td style="width:20px;border: 0px">
				            			{!FLOOR(col.qtyStock)}
				            		</td>
				            		<td style="border: 0px;padding:0px;">
				            			<input type="text" onchange="roomChange()" onfocus="stopRunning()" onblur="reGainFun()" class="roomInput" data-maxvalue='{!FLOOR(col.qtyStock)}' data-orgvalue="{!FLOOR(col.stock.QtyOfStock__c)}" rmngval="{!FLOOR(col.diffRoomInt)}" value="{!FLOOR(col.stock.QtyOfStock__c)}"/>
				            		</td>
				            	</tr>
				            </table>
				            <input type="button" class="btn {!IF(col.stock.SalesStatusLst__c == '2', 'salesStatus', '')}" value="{!IF(col.stock.SalesStatusLst__c == '2', STOCK_SETTYPE_STOP,STOCK_SETTYPE_SALE)}" style="width:98%;margin-left: 1%;" data-orgvalue="{!IF(col.stock.SalesStatusLst__c == '2', STOCK_SETTYPE_STOP,STOCK_SETTYPE_SALE)}" onclick="salesStatus()"/>
			    		</apex:outputpanel>
		            </td>
			    </apex:repeat>
	           <td class="dataCell leftPanelItem" >
	           		<a href="/{!row.roomTypeId}" id="{!row.roomTypeId}2" onblur="LookupHoverDetail.getHover('{!row.roomTypeId}2').hide();" onfocus="LookupHoverDetail.getHover('{!row.roomTypeId}2', '/{!row.roomTypeId}/m?retURL=%2F{!row.roomTypeId}&isAjaxRequest=1').show();" onmouseout="LookupHoverDetail.getHover('{!row.roomTypeId}2').hide();" onmouseover="LookupHoverDetail.getHover('{!row.roomTypeId}2', '/{!row.roomTypeId}/m?retURL=%2F{!row.roomTypeId}&isAjaxRequest=1').show();">{!row.roomTypeNm}</a>
	           </td>
        	</tr>
	    </apex:repeat>
	    <!-- 2018/12/15 在庫調整と販売状態管理 by zy END -->
        </apex:repeat>
        <!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz BEGIN -->
        <apex:variable var="bgColor" value="evenCls"/>
        <apex:repeat var="plan" value="{!obaseplanLst}" rendered="{!isBasePlanFlg}">
        <apex:repeat var="p" value="{!planInfoMap[plan.Id]}" >
			<apex:variable var="heightSize" value="{!p.planTypeLst.size * 27 - p.planTypeLst.size*2}"/>
        <apex:variable var="bgColor" value="{!IF(bgColor == 'evenCls', 'oddCls', 'evenCls')}"/>
        <apex:variable var="idx" value="{!0}"/>
        <apex:repeat var="tpl" value="{!p.planTypeLst}" rendered="{!isBasePlanFlg}">
        <!--TODO:onmouseover="if (window.hiOn){hiOn(this);} " onmouseout="if (window.hiOff){hiOff(this);} "-->
        <tr class="{!bgColor}"  onBlur="if (window.hiOff){hiOff(this);}" onFocus="if (window.hiOn){hiOn(this);}">
            <td class="dataCell baseCls"  style="position: relative;min-width:118px;">
				<!-- 2020/08/15 予約画面、ブラウザの表示ズームによらず縦ずれします。 by zy BEGIN -->
                <a href="/{!p.s.id}" id="{!p.s.id}1" class="{!bgColor}" style="height:{!heightSize}px;width:calc(100% - 5px);{!if( idx == 0, 'position: absolute;z-index:1;left: 0px; top: 0px;overflow: hidden;', 'display:none;')}" onblur="LookupHoverDetail.getHover('{!p.s.id}1').hide();" onfocus="LookupHoverDetail.getHover('{!p.s.id}1', '/{!p.s.id}/m?retURL=%2F{!p.s.id}&isAjaxRequest=1').show();" onmouseout="LookupHoverDetail.getHover('{!p.s.id}1').hide();" onmouseover="LookupHoverDetail.getHover('{!p.s.id}1', '/{!p.s.id}/m?retURL=%2F{!p.s.id}&isAjaxRequest=1').show();">{!p.s.Name}</a>
				<!-- 2020/08/15 予約画面、ブラウザの表示ズームによらず縦ずれします。 by zy END -->
			</td>
            <td class="dataCell baseCls" style="width:50px;white-space: nowrap;"><span style="margin-right: 10px;float: right;">{!tpl}</span></td>
            <apex:repeat var="baseInfo" value="{!p.basePlanInfoMap[tpl]}" rendered="{!isBasePlanFlg}">
            <td class="dataCell baseCls"  nowrap="nowrap" style="text-align: center;height:18px" planid="{!p.s.id}" planVip="{!tpl}" date="{!baseInfo.bases.PriceSetupDate__c}">
            	<apex:outputPanel rendered="{!baseInfo.disable}">{!baseInfo.bases.Tier__c}&nbsp;</apex:outputPanel>
            	<apex:outputPanel rendered="{!baseInfo.disable}">{!IF(baseInfo.bases.SalesStatus__c == '2',STOCK_SETTYPE_STOP,STOCK_SETTYPE_SALE)}</apex:outputPanel>
            	<!-- tier值 -->
            	<!--TODO:disabled="true" 属性定义选择列表是否可用-->
		    	<apex:selectList size="1" value="{!baseInfo.bases.Tier__c}" html-oldvalue="{!baseInfo.bases.Tier__c}" html-date="{!baseInfo.bases.PriceSetupDate__c}"  
		    				html-typeid="{!p.s.id}" styleClass="selectCls defaultTierClass {!baseInfo.bases.Tier__c}"
		    				onchange="changeTierClassPlan(this)" id="curTier_three" rendered="{!!baseInfo.disable}">
	                <apex:selectOptions value="{!tiersLst}" />
	            </apex:selectList>
            	<!-- 贩卖状态 --> 
            	<input type="button" class="btn {!IF(baseInfo.bases.SalesStatus__c == '2', 'salesStatusPlan', '')}" value="{!IF(baseInfo.bases.SalesStatus__c == '2', STOCK_SETTYPE_STOP,STOCK_SETTYPE_SALE)}" style="width: 30px; margin-left:0px;display: {!IF(baseInfo.disable, 'none', 'true')}" data-orgvalue="{!IF(baseInfo.bases.SalesStatus__c == '2', STOCK_SETTYPE_STOP,STOCK_SETTYPE_SALE)}" onclick="salesStatusPlan(this)"/>
               	<!-- 变更角标 -->
	            <span name="updateSpan" style="display: {!IF(baseInfo.disable, 'none', 'true')}"></span>
            </td>
            </apex:repeat>
            <td class="dataCell baseCls" style="position: relative;min-width:168px;">
                <a href="/{!p.s.id}" id="{!p.s.id}2" class="{!bgColor}" style="height:{!heightSize}px;width:166px;{!if( idx == 0, 'position: absolute;z-index:1;left: 0px; top: 0px;overflow: hidden;', 'display:none;')}" onblur="LookupHoverDetail.getHover('{!p.s.id}2').hide();" onfocus="LookupHoverDetail.getHover('{!p.s.id}2', '/{!p.s.id}/m?retURL=%2F{!p.s.id}&isAjaxRequest=1').show();" onmouseout="LookupHoverDetail.getHover('{!p.s.id}2').hide();" onmouseover="LookupHoverDetail.getHover('{!p.s.id}2', '/{!p.s.id}/m?retURL=%2F{!p.s.id}&isAjaxRequest=1').show();">{!p.s.Name}</a>
            </td>
        </tr>
        <apex:variable var="idx" value="{!idx + 1}"/>
        </apex:repeat>
        </apex:repeat>
        </apex:repeat>
        <!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz END -->    
        </tbody>
    </table>
   	<!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz BEGIN -->
   	<table><tr><td>
		<apex:outputpanel style="" rendered="{!isBasePlanFlg}">
		<!-- of -->    <!-- items -->
	         <apex:outputLabel style="vertical-align: middle;" value="{!pageCtrl.StartRsNo} - {!pageCtrl.EndRsNo} {!$Label.ps__msg_009_0029} {!pageCtrl.TotalRs} {!$Label.ps__msg_009_0030}"/>
          <apex:commandLink onclick="openPageFun('1')" status="JINYACONNECT_LOADINGSTATUS" 
          	reRender="userInfoList" styleclass="k-button" style="margin-left: 2px">
          		<span class="k-icon k-i-seek-w"></span>
          </apex:commandLink>
          <apex:commandLink onclick="openPageFun('2')" status="JINYACONNECT_LOADINGSTATUS" 
          	reRender="userInfoList" styleclass="k-button" style="margin-left: 2px">
          		<span class="k-icon k-i-arrow-w"></span>
          </apex:commandLink> 
          <apex:commandLink onclick="openPageFun('3')" status="JINYACONNECT_LOADINGSTATUS" 
          	reRender="userInfoList" styleclass="k-button" style="margin-left: 2px">
          		<span class="k-icon k-i-arrow-e"></span>
          </apex:commandLink> 
          <apex:commandLink onclick="openPageFun('4')" status="JINYACONNECT_LOADINGSTATUS" 
          	reRender="userInfoList" styleclass="k-button" style="margin-left: 2px">
          		<span class="k-icon k-i-seek-e"></span>
          </apex:commandLink> 
          <apex:actionFunction name="firstPageFun" action="{!firstPage}" status="refStatusBlock" reRender="dispForm,StockForm" />
          <apex:actionFunction name="previousPageFun" action="{!previousPage}" status="refStatusBlock" reRender="dispForm,StockForm" />
          <apex:actionFunction name="nextPageFun" action="{!nextPage}" status="refStatusBlock" reRender="dispForm,StockForm" />
          <apex:actionFunction name="lastPageFun" action="{!lastPage}" status="refStatusBlock" reRender="dispForm,StockForm" />
	   	</apex:outputpanel>
   	</td></tr></table>
   	<!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz END -->
    </apex:outputPanel>



<!-- 販売先状態読み込む（TL2WAY） -->
<apex:outputPanel id="TlSalesTable" rendered="{!isTlSalesFlg}">
 <style>
.remaindCountItem {
	text-align: center;
}
.statusSalesStop{
	background-color: #FADBDA;
}
.statusSalesNormal{}
.taStatusSalesStop{
	background-color: #FADBDA;
}
.sfShopInfoLine {
	background-color: #FFFACD;
	white-space: nowrap;
	width:150px;
	overflow: hidden;
	text-overflow:ellipsis;
	word-break:keep-all;/* 改行せず */
}
.sfRoomTypeLine {
	background-color: #D6F2AC;
	white-space: nowrap;
	width:150px;
	overflow: hidden;
	text-overflow:ellipsis;
	word-break:keep-all;/* 改行せず */
}
.salesCompanyLine {
	background-color: #EEF6F1;
	white-space: nowrap;
	width:150px;
	overflow: hidden;
	text-overflow:ellipsis;
	word-break:keep-all;/* 改行せず */
}
.salesRoomTypeLine {
	white-space: nowrap;
	width:150px;
	overflow: hidden;
	text-overflow:ellipsis;
	max-width:150px;
	word-break:keep-all;/* 改行せず */
}
.bPageBlock .pbTitle {
	width: 25%;
}
</style>

    <table id="dTable" class="list datatable" border="0" cellpadding="0" cellspacing="0">
        <thead class="rich-table-thead">
        <tr class="headerRow" nowrap="nowrap">
            <th class="headerRow leftPanel" nowrap="nowrap" colspan="1">
            <!-- 部屋タイプ -->
                <apex:outputText value="{!$Label.ps__msg_003_0046}"/>
            </th>
            <apex:repeat var="col" value="{!dispHeaders}">
                <th class="headerRow" nowrap="nowrap" style="text-align:center;width:38px; background: {!headerColorMap[col.days]}; url({!URLFOR($Resource.reportFiles, 'img/blank')});">
                    <a	target="_blank" style ="text-decoration:underline" 
                    	href="{!IF(LEN($Setup.CommDefine__c.ps__RoomTypeDateLinkFlg__c) = 0 || $Setup.CommDefine__c.ps__RoomTypeDateLinkFlg__c == '1', '/apex/RoomIndicatorInfo?dt='+col.name, '/' + reportId + '?colDt_s=' + col.name + '&colDt_e=' + col.name )}" title="{!col.holidayLab}">{!col.label}</a>
                </th>
            </apex:repeat>
            <th class="headerRow leftPanel" nowrap="nowrap" colspan="1">
            <!-- 部屋タイプ -->
                <apex:outputText value="{!$Label.ps__msg_003_0046}"/>
            </th>
        </tr>
        <!-- 六曜 -->
        <tr class="headerRow" nowrap="nowrap" style="display:{!IF(isShowQreqki,'','none')}">
            <th class="headerRow leftPanel" nowrap="nowrap" colspan="1"><!-- 六輝 -->{!$Label.MSG_003_0047}</th>
            <apex:repeat var="col" value="{!dispHeaders}">
                <td class="headerRow" nowrap="nowrap" style="text-align:center;width:38px;">
                    <span class="qrekispan" dtval="{!col.name}"></span>
                </td>
            </apex:repeat>
            <th class="headerRow leftPanel" nowrap="nowrap" colspan="1"><!-- 六輝 -->{!$Label.MSG_003_0047}</th>
        </tr>

		<!-- 2015/10/08 AGT機能営業日（ビュー）表示機能追加 -->
		<tr style="background:#FFFACD; url({!URLFOR($Resource.reportFiles, 'img/blank')});display:{!if(isShowTierHeader, 'true', 'none')}">
            <th class="headerRow" nowrap="nowrap">
                <!-- 営業 -->
               {!$Label.ps__msg_003_0051}
            </th>
            <apex:repeat var="col" value="{!dispHeaders}">
                <td class="headerRow" nowrap="nowrap" >
                <div style="width:38px; overflow:hidden;white-space: nowrap;text-align:center; ">
                     <span style="color: {!colorInfoMap[col.days]};">{!restInfoMap[col.days]}</span>
                </div>
                </td>
            </apex:repeat>
            <th class="headerRow" nowrap="nowrap">
                <!-- 営業 -->
                {!$Label.ps__msg_003_0051}
            </th>
        </tr>
        
        </thead>
        
		<tbody>


<tr style="display: {!if(isHaveTaSaleInfo && isHaveTlSaleInfo ,'','none;')}">
<td colspan="{!dispHeaders.size + 2}">TL-リンカーン</td>
</tr>

<!-- MODE1:部屋タイプ別 -->
<!-- 店舗別単位 -->
<apex:repeat var="shop" value="{!showShopList}" rendered="{!isSfRoomTypeLayout}">

<!-- 店舗タイトル情報 -->
<tr><td class="sfShopInfoLine" title="{!shop.shopName}">{!shop.shopName}</td>
		<!-- 曜日期間情報を表示する -->
		<apex:repeat var="col" value="{!dispHeaders}">
			<td class="sfShopInfoLine remaindCountItem">{!shop.remaindCountSumMap[col.yyyymmdd]}</td>
		</apex:repeat>
	<td class="sfShopInfoLine" title="{!shop.shopName}">{!shop.shopName}</td>
</tr>

<!-- 部屋タイプ -->
<apex:repeat var="sfRmType" value="{!sfRoomTypeAgtInfoMap[shop.shopCode]}">
	<!-- SFの部屋タイプ定義情報 -->
	<tr>
		<td class="sfRoomTypeLine" title="{!sfRmType.rmTypeName}">{!sfRmType.rmTypeName}</td>
			<apex:repeat var="col" value="{!dispHeaders}">
			<td class="sfRoomTypeLine remaindCountItem">{!sfRmType.remaindCountSumMap[col.yyyymmdd]}</td>
			</apex:repeat>
		<td class="sfRoomTypeLine" title="{!sfRmType.rmTypeName}">{!sfRmType.rmTypeName}</td>
	</tr>
	<!-- AGT単位表示[ネット販売] -->		
	<apex:repeat var="agt" value="{!sfRmType.tlSalesInfoLst}">
	<tr>
		<!-- ネット -->		<!-- リアル -->		<!-- ネット -->		<!-- リアル -->
		<td class="salesCompanyLine" title="{!agt.agtName}{!IF(!agt.isRealAgt, $Label.MSG_003_0107, $Label.MSG_003_0108 )}">{!agt.agtName}{!IF(!agt.isRealAgt, $Label.MSG_003_0107, $Label.MSG_003_0108 )}</td>
			<apex:repeat var="col" value="{!dispHeaders}">
			<td class="salesCompanyLine remaindCountItem">{!agt.remaindCountSumMap[col.yyyymmdd]}</td>
			</apex:repeat>
		<!-- ネット -->		<!-- リアル -->		<!-- ネット -->		<!-- リアル -->
		<td class="salesCompanyLine" title="{!agt.agtName}{!IF(!agt.isRealAgt, $Label.MSG_003_0107, $Label.MSG_003_0108 )}">{!agt.agtName}{!IF(!agt.isRealAgt, $Label.MSG_003_0107, $Label.MSG_003_0108 )}</td>
	</tr>
	<!-- AGT単位に室タイプ配列情報 -->
	<apex:repeat var="rmtype" value="{!agt.agtRmTypeLst}">
	<tr>
		<!-- 左側情報を表示する -->
		<td class="salesRoomTypeLine" title="{!rmtype.rmTypeName}" >&nbsp;&nbsp;{!rmtype.rmTypeName}</td>
		<!-- 曜日期間情報を表示する -->
		<apex:repeat var="col" value="{!dispHeaders}">
			<td class="remaindCountItem {!IF(rmtype.dailyStockMap[col.yyyymmdd].salesStatus == '2', 'statusSalesStop','statusSalesNormal')}">{!rmtype.dailyStockMap[col.yyyymmdd].remainingCount}</td>
		</apex:repeat>
		<!-- 右側情報を表示する -->
		<td class="salesRoomTypeLine" title="{!rmtype.rmTypeName}" >&nbsp;&nbsp;{!rmtype.rmTypeName}</td>
	</tr>
	
	</apex:repeat>
	</apex:repeat>

</apex:repeat>

</apex:repeat>
		
		
<!-- MODE2:販売先別 -->		
<!-- 店舗別単位 -->
<apex:repeat var="shop" value="{!showShopList}" rendered="{!!isSfRoomTypeLayout}">

<!-- 店舗情報 -->
<tr><td class="sfShopInfoLine" title="{!shop.shopName}">{!shop.shopName}</td>
		<!-- 曜日期間情報を表示する -->
		<apex:repeat var="col" value="{!dispHeaders}">
			<td class="sfShopInfoLine remaindCountItem">{!shop.remaindCountSumMap[col.yyyymmdd]}</td>
		</apex:repeat>
	<td class="sfShopInfoLine" title="{!shop.shopName}">{!shop.shopName}</td>
</tr>

<!-- AGT単位表示[ネット販売] -->		
<apex:repeat var="netAgt" value="{!netAgtInfoMap[shop.shopCode]}">
<!-- ネット -->		<!-- ネット -->
<tr><td class="salesCompanyLine" title="{!netAgt.agtName}{!$Label.MSG_003_0107}">{!netAgt.agtName}{!$Label.MSG_003_0107}</td>
		<!-- 曜日期間情報を表示する -->
		<apex:repeat var="col" value="{!dispHeaders}">
			<td class="salesCompanyLine remaindCountItem">{!netAgt.remaindCountSumMap[col.yyyymmdd]}</td>
		</apex:repeat>
	<!-- ネット -->		<!-- ネット -->
	<td class="salesCompanyLine" title="{!netAgt.agtName}{!$Label.MSG_003_0107}">{!netAgt.agtName}{!$Label.MSG_003_0107}</td>
</tr>

<!-- AGT単位に室タイプ配列情報 -->
<apex:repeat var="rmtype" value="{!netAgt.agtRmTypeLst}">
		<tr>
		<!-- 左側情報を表示する -->
		<td  class="salesRoomTypeLine" title="{!rmtype.rmTypeName}({!rmtype.sfRmTypeName})">&nbsp;&nbsp;{!rmtype.rmTypeName}</td>
		<!-- 曜日期間情報を表示する -->
		<apex:repeat var="col" value="{!dispHeaders}">
			<td class="remaindCountItem {!IF(rmtype.dailyStockMap[col.yyyymmdd].salesStatus == '2', 'statusSalesStop','statusSalesNormal')}">{!rmtype.dailyStockMap[col.yyyymmdd].remainingCount}</td>
		</apex:repeat>
		<!-- 右側情報を表示する -->
		<td  class="salesRoomTypeLine" title="{!rmtype.rmTypeName}({!rmtype.sfRmTypeName})">&nbsp;&nbsp;{!rmtype.rmTypeName}</td>
		</tr>
</apex:repeat><!-- 販売先室タイプ表示完了 -->
</apex:repeat><!-- 販売先表示完了 -->

<!-- AGT単位表示[旅行会社] -->	
<apex:repeat var="realAgt" value="{!realAgtInfoMap[shop.shopCode]}">
<!-- リアル -->		<!-- リアル -->
<tr><td class="salesCompanyLine" title="{!realAgt.agtName}{!$Label.MSG_003_0108}">{!realAgt.agtName}{!$Label.MSG_003_0108}</td>
		<!-- 曜日期間情報を表示する -->
		<apex:repeat var="col" value="{!dispHeaders}">
			<td class="salesCompanyLine remaindCountItem">{!realAgt.remaindCountSumMap[col.yyyymmdd]}</td> 
		</apex:repeat>
	<!-- リアル -->		<!-- リアル -->
	<td class="salesCompanyLine" title="{!realAgt.agtName}{!$Label.MSG_003_0108}">{!realAgt.agtName}{!$Label.MSG_003_0108}</td>
</tr>
<!-- AGT単位に室タイプ配列情報 -->
<apex:repeat var="rmtype" value="{!realAgt.agtRmTypeLst}">
	<tr>
		<!-- 左側情報を表示する -->
		<td class="salesRoomTypeLine" title="{!rmtype.rmTypeName}({!rmtype.sfRmTypeName})">&nbsp;&nbsp;{!rmtype.rmTypeName}</td>
		<!-- 曜日期間情報を表示する -->
		<apex:repeat var="col" value="{!dispHeaders}">
			<td class="remaindCountItem {!IF(rmtype.dailyStockMap[col.yyyymmdd].salesStatus == '2', 'statusSalesStop','statusSalesNormal')}">{!rmtype.dailyStockMap[col.yyyymmdd].remainingCount}</td>
		</apex:repeat>
		<!-- 右側情報を表示する -->
		<td class="salesRoomTypeLine" title="{!rmtype.rmTypeName}({!rmtype.sfRmTypeName})">&nbsp;&nbsp;{!rmtype.rmTypeName}</td>
	</tr>
</apex:repeat><!-- 販売先室タイプ表示完了 -->
</apex:repeat><!-- 販売先表示完了 -->
</apex:repeat><!-- 店舗表示完了 -->

<!-- TA残室情報表示 -->
<tr style="display: {!if(isHaveTaSaleInfo && isHaveTlSaleInfo ,'','none;')}">
<td colspan="{!dispHeaders.size + 2}">手間いらず</td>
</tr>

<!-- TA残室数情報を表示する -->
<apex:repeat var="shop" value="{!taSaleInfo}" rendered="{!isHaveTaSaleInfo}">
<!-- 店舗タイトル情報 -->
<tr><td class="sfShopInfoLine" title="{!shop.shopName}">{!shop.shopName}</td>
		<!-- 曜日期間情報を表示する -->
		<apex:repeat var="col" value="{!dispHeaders}">
			<td class="sfShopInfoLine remaindCountItem">{!shop.remaindCountSumMap[col.yyyymmdd]}</td>
		</apex:repeat>
	<td class="sfShopInfoLine" title="{!shop.shopName}">{!shop.shopName}</td>
</tr>

<!-- 部屋タイプ -->
<apex:repeat var="sfRmTypeCd" value="{!shop.sfRmTypeCdLst}">
	<apex:variable var="rmtype" value="{!shop.sfRmTypeMap[sfRmTypeCd]}" />
	<tr>
		<!-- 左側情報を表示する -->
		<td class="salesRoomTypeLine" title="{!rmtype.rmTypeName}" >&nbsp;&nbsp;{!rmtype.rmTypeName}</td>
		<!-- 曜日期間情報を表示する -->
		<apex:repeat var="col" value="{!dispHeaders}">
			<td class="salesRoomTypeLine remaindCountItem {!IF(rmtype.remaindCountSumMap[col.yyyymmdd].salesStatus == '1', 'taStatusSalesStop','statusSalesNormal')}">{!rmtype.remaindCountSumMap[col.yyyymmdd].remainingCount}</td>
		</apex:repeat>
		<!-- 右側情報を表示する -->
		<td class="salesRoomTypeLine" title="{!rmtype.rmTypeName}" >&nbsp;&nbsp;{!rmtype.rmTypeName}</td>
	</tr>
</apex:repeat><!-- 部屋タイプ表示完了 -->
</apex:repeat><!-- 店舗表示完了 -->

		</tbody>
	</table>
</apex:outputPanel>

 

</apex:pageBlock>
   
   
   
   
   
   
   
   
   
   
   
<!-- のリアルＡＧＴ残室数 -->   
<apex:pageBlock title="{!thisYear}/{!thisMonth}{!$Label.ps__msg_003_0052}" rendered="{!isHaveTravelInfo && isStockFlg}">
    <apex:pageBlockButtons location="top">

        <!-- 前月 -->
        <apex:commandButton style="width:100px;" styleClass="btn" value="{!$Label.ps__msg_003_0025}" action="{!toPrev}" reRender="dispForm, messageForm" status="refStatusBlock"/>
        <!-- 今月 -->
        <apex:commandButton style="width:100px;" styleClass="btn" value="{!$Label.ps__msg_003_0026}" action="{!init}" reRender="dispForm, messageForm" status="refStatusBlock"/>
        <!-- 来月 -->
        <apex:commandButton style="width:100px;" styleClass="btn" value="{!$Label.ps__msg_003_0027}" action="{!toNext}" reRender="dispForm, messageForm" status="refStatusBlock"/>
        <!-- 在庫更新 -->
        <input type="button" class="btn"
            style="color: #ffffff; background-color: #00FF00; background-image: url({!URLFOR($Resource.reportFiles, 'img/blank')}); width: 100px"
            value="{!$Label.MSG_003_0028}" onclick="javascript:stockRefresh()"  />
        <!-- タイムテーブル -->
        <input type="button" value="{!$Label.MSG_003_0029}" class="btn" style="width:100px;" onclick="openBookingInfoWin()"/>
        <!-- 2020/11/30 リアルAGT増返室ボタン機能新規追加 WGCH BEGIN -->
        <!-- 増返室 -->
        <input type="button" value="{!$Label.MSG_003_0113}" class="btn newleadmode" style="min-width:100px; display: {!if(isStockSyncIsMode, 'true', 'none')};" onclick="conModeFun(this)"/>
        <!-- 2020/11/30 リアルAGT増返室ボタン機能新規追加 WGCH END -->
        <apex:outputPanel style="{!IF(yearMonthRightPosition,IF(yearMonthLeftFlg,'position:absolute;left:230px','float:right;') ,'float:left;margin-right:10px')};vertical-align:top;">
            <apex:selectList size="1" value="{!thisYear}" style="height:24px;font-size:16px;" id="selectYear">
                <apex:selectOptions value="{!yearList}" />
				<!-- 2021/05/31 年、月を変えた後に送信ボタンで更新がかかる機能対応 by WSQ BEGIN-->
                <apex:actionSupport event="onchange" onsubmit="syncSelectInfo(this.value, 'selectYear'); {!IF(yearMonthChangeEventByBtn, 'return false;', '')}" 
                action="{!gotoYearMonth}" rerender="dispForm, messageForm" status="refStatusBlock"/>
				<!-- 2021/05/31 年、月を変えた後に送信ボタンで更新がかかる機能対応 by WSQ END-->
            </apex:selectList>
            <apex:commandButton value="<<" action="{!toPrev}" reRender="dispForm, messageForm"
                style="margin-left:-5px;margin-right:2px;height:24px;width:24px;vertical-align:top;" status="refStatusBlock"/>
            <apex:selectList size="1" value="{!thisMonth}" style="height:24px;font-size:16px;" id="selectMonth">
                <!-- 1月 -->
                <apex:selectOption itemValue="1" itemLabel="{!$Label.ps__msg_003_0030}"/>
                <!-- 2月 -->
                <apex:selectOption itemValue="2" itemLabel="{!$Label.ps__msg_003_0031}"/>
                <!-- 3月 -->
                <apex:selectOption itemValue="3" itemLabel="{!$Label.ps__msg_003_0032}"/>
                <!-- 4月 -->
                <apex:selectOption itemValue="4" itemLabel="{!$Label.ps__msg_003_0033}"/>
                <!-- 5月 -->
                <apex:selectOption itemValue="5" itemLabel="{!$Label.ps__msg_003_0034}"/>
                <!-- 6月 -->
                <apex:selectOption itemValue="6" itemLabel="{!$Label.ps__msg_003_0035}"/>
                <!-- 7月 -->
                <apex:selectOption itemValue="7" itemLabel="{!$Label.ps__msg_003_0036}"/>
                <!-- 8月 -->
                <apex:selectOption itemValue="8" itemLabel="{!$Label.ps__msg_003_0037}"/>
                <!-- 9月 -->
                <apex:selectOption itemValue="9" itemLabel="{!$Label.ps__msg_003_0038}"/>
                <!-- 10月 -->
                <apex:selectOption itemValue="10" itemLabel="{!$Label.ps__msg_003_0039}"/>
                <!-- 11月 -->
                <apex:selectOption itemValue="11" itemLabel="{!$Label.ps__msg_003_0040}"/>
                <!-- 12月 -->
                <apex:selectOption itemValue="12" itemLabel="{!$Label.ps__msg_003_0041}"/>
				<!-- 2021/05/31 年、月を変えた後に送信ボタンで更新がかかる機能対応 by WSQ BEGIN-->
                <apex:actionSupport event="onchange" onsubmit="syncSelectInfo(this.value, 'selectMonth');  {!IF(yearMonthChangeEventByBtn, 'return false;', '')}" 
                action="{!gotoYearMonth}" rerender="dispForm, messageForm" status="refStatusBlock" />
				<!-- 2021/05/31 年、月を変えた後に送信ボタンで更新がかかる機能対応 by WSQ END-->
            </apex:selectList>
            <apex:commandButton value=">>" action="{!toNext}"
                reRender="dispForm, messageForm" style="margin-left:-5px;height:24px;width:24px;vertical-align:top;" status="refStatusBlock"/>
	    	<!-- 2021/05/31 年、月を変えた後に送信ボタンで更新がかかる機能対応 by WSQ BEGIN-->
            <apex:commandButton value="送信" action="{!gotoYearMonth}"
                reRender="dispForm, messageForm" style="height:24px;width:60px;vertical-align:top;" status="refStatusBlock"
                rendered="{!yearMonthChangeEventByBtn}"/>
	    	<!-- 2021/05/31 年、月を変えた後に送信ボタンで更新がかかる機能対応 by WSQ END-->
        </apex:outputPanel>
    </apex:pageBlockButtons>
	<apex:outputPanel id="ciTableAgt" >
    <table id="dTableAgt" class="list datatable" border="0" cellpadding="0" cellspacing="0">
        <thead class="rich-table-thead">
        <tr class="headerRow _firstrow" nowrap="nowrap">
            <th class="headerRow leftPanel" nowrap="nowrap" colspan="2">
                <!-- リアルＡＧＴ名と部屋タイプ -->
                <apex:outputText value="{!$Label.ps__msg_003_0053}"/>
            </th>
            <apex:repeat var="col" value="{!dispHeaders}">
                <!-- 2019/10/30 予約ポップで表示されている残室数を期間指定してcsv出力 BY zyz BEGIN -->
                <th class="headerRow" nowrap="nowrap" dt="{!col.name}" style="width:38px; background: {!headerColorMap[col.days]}; url({!URLFOR($Resource.reportFiles, 'img/blank')});">
                <!-- 2019/10/30 予約ポップで表示されている残室数を期間指定してcsv出力 BY zyz END -->
                    <a target="_blank" style ="text-decoration:underline" 
                    	href="{!IF(LEN($Setup.CommDefine__c.ps__RoomTypeDateLinkFlg__c) = 0 || $Setup.CommDefine__c.ps__RoomTypeDateLinkFlg__c == '1', '/apex/RoomIndicatorInfo?dt='+col.name, '/' + reportId + '?colDt_s=' + col.name + '&colDt_e=' + col.name )}" title="{!col.holidayLab}">{!col.label}</a>
                </th>
            </apex:repeat>
            <th class="headerRow leftPanel" nowrap="nowrap" colspan="2">
                <!-- リアルＡＧＴ名と部屋タイプ -->
                <apex:outputText value="{!$Label.ps__msg_003_0053}"/>
            </th>
        </tr>

        <!-- 六曜 -->
        <tr class="headerRow" nowrap="nowrap" style="display:{!IF(isShowQreqki,'','none')}">
            <!-- 六輝 -->
            <th class="headerRow leftPanel" nowrap="nowrap" colspan="2">{!$Label.MSG_003_0047}</th>
            <apex:repeat var="col" value="{!dispHeaders}">
                <td class="headerRow" nowrap="nowrap" style="width:38px;">
                    <span class="qrekispan" dtval="{!col.name}"></span>
                </td>
            </apex:repeat>
            <!-- 六輝 -->
            <th class="headerRow leftPanel" nowrap="nowrap" colspan="2">{!$Label.MSG_003_0047}</th>
        </tr>
        
        <tr style="background:#FFFCDB; url({!URLFOR($Resource.reportFiles, 'img/blank')});">
            <th class="headerRow" nowrap="nowrap" colspan="2">
            	<!-- 2021/06/31 #JP10243　対応　by zy BEGIN -->
                <!-- 提供数 -->
                <apex:outputText value="{!if(isRealAgtLayoutSimple,$Label.ps__msg_003_0054, $Label.ps__msg_003_0115)}"/>
                <!-- 2021/06/31 #JP10243　対応　by zy END -->
            </th>
            <apex:repeat var="col" value="{!dispHeaders}">
                <td class="headerRow" nowrap="nowrap" style="text-align: center;">
                    <apex:outputText value="{0,number,###}">
		    		<!-- 2021/06/31 #JP10243　対応　by zy BEGIN -->
                    <apex:param value="{!if (isRealAgtLayoutSimple,mstAgtRoomsMap[col.days],usedAgtRoomsMap[col.days])}" />
		    		<!-- 2021/06/31 #JP10243　対応　by zy END -->
                    </apex:outputText>
                </td>
            </apex:repeat>
            <th class="headerRow" nowrap="nowrap" colspan="2">
            	<!-- 2021/06/31 #JP10243　対応　by zy BEGIN -->
                <!-- 提供数 -->
                <apex:outputText value="{!if(isRealAgtLayoutSimple,$Label.ps__msg_003_0054, $Label.ps__msg_003_0115)}"/>
                <!-- 2021/06/31 #JP10243　対応　by zy END -->
            </th>
        </tr>
        <tr style="background:#FFFCDB; url({!URLFOR($Resource.reportFiles, 'img/blank')});">
            <th class="headerRow" nowrap="nowrap" colspan="2">
                <!-- リアルＡＧＴ残室 -->
                <apex:outputText value="{!$Label.ps__msg_003_0055}"/>
            </th>
            <apex:repeat var="col" value="{!dispHeaders}">
                <td class="headerRow" nowrap="nowrap" style="text-align: center;">
					<!-- 2021/06/31 #JP10243　対応　by zy BEGIN -->
                    <apex:outputText value="{0,number,###}" style="color:{!IF(isRealAgtLayoutSimple ,if((mstAgtRoomsMap[col.days] - usedAgtRoomsMap[col.days]) <= 0, 'red','black'),if((lastAgtRoomsMap[col.days] - usedAgtRoomsMap[col.days]) <= 0, 'red','black'))}">
                    	<apex:param value="{!if (isRealAgtLayoutSimple,mstAgtRoomsMap[col.days] - usedAgtRoomsMap[col.days],lastAgtRoomsMap[col.days] - usedAgtRoomsMap[col.days])}" />
		            </apex:outputText>
		    		<!-- 2021/06/31 #JP10243　対応　by zy END -->
                </td>
            </apex:repeat>
            <th class="headerRow" nowrap="nowrap" colspan="2">
                <!-- リアルＡＧＴ残室 -->
                <apex:outputText value="{!$Label.ps__msg_003_0055}"/>
            </th>
        </tr>

        </thead>
        <tbody>
		<!-- 旅行会社ＬＯＯＰ -->
		<apex:repeat var="travelId" value="{!travelIdList}">
		<!-- 旅行会社単体 -->
		<apex:repeat var="travelobj" value="{!dispAgtRecordMap[travelId]}">
		
		<apex:variable var="count" value="{!0}"/>
		<!-- 定義する部屋タイプ情報 -->
        <apex:repeat var="roomtypes" value="{!travelobj.roomTypes}">
		 
		 <apex:repeat var="row" value="{!roomtypes}">
         	<tr>
            <!-- 2019/10/30 予約ポップで表示されている残室数を期間指定してcsv出力 BY zyz BEGIN -->
            <td class="dataCell leftPanelItem" name="itemAgt">
            <!-- 2019/10/30 予約ポップで表示されている残室数を期間指定してcsv出力 BY zyz END -->
            <apex:outputPanel rendered="{!IF(count == 0, true, false)}">
				<a href="/{!travelId}" id="{!travelId}1" 
					onblur="LookupHoverDetail.getHover('{!travelId}1').hide();" 
					onfocus="LookupHoverDetail.getHover('{!travelId}1', '/{!travelId}/m?retURL=%2F{!travelId}&isAjaxRequest=1').show();" 
					onmouseout="LookupHoverDetail.getHover('{!travelId}1').hide();" 
					onmouseover="LookupHoverDetail.getHover('{!travelId}1', '/{!travelId}/m?retURL=%2F{!travelId}&isAjaxRequest=1').show();">{!travelobj.travelName}</a>
            </apex:outputPanel>
            </td>
            <td class="dataCell leftPanelItem" >
            <a href="/{!row.roomTypeId}" id="{!row.roomTypeId}3{!travelId}" onblur="LookupHoverDetail.getHover('{!row.roomTypeId}3{!travelId}').hide();" onfocus="LookupHoverDetail.getHover('{!row.roomTypeId}3{!travelId}', '/{!row.roomTypeId}/m?retURL=%2F{!row.roomTypeId}&isAjaxRequest=1').show();" onmouseout="LookupHoverDetail.getHover('{!row.roomTypeId}3{!travelId}').hide();" onmouseover="LookupHoverDetail.getHover('{!row.roomTypeId}3{!travelId}', '/{!row.roomTypeId}/m?retURL=%2F{!row.roomTypeId}&isAjaxRequest=1').show();">{!row.roomTypeNm}</a>
            </td>

            <apex:repeat var="col" value="{!row.roomList}">
                <td class="dataCell" nowrap="nowrap" style="text-align:center;">
                    <!-- 2018/03/12 ラックレート部屋タイプ別の対応　by　zy　BEGIN -->
                    <!-- 2020/11/30 リアルAGT増返室ボタン機能新規追加 WGCH BEGIN -->
                    <apex:outputLabel value="{!FLOOR(col.stock.QtyOfStock__c)}" rendered="{!colStatusMap[col.stock.StockDate__c].disable}"
                        styleClass="{!if(colStatusMap[col.stock.StockDate__c].disable, 'showCls', '')}"
                        style="width:36px;
                        color:{!IF(FLOOR(col.stock.QtyOfStock__c) < 0, 'red','black')};" />
                    <!-- 2020/11/30 リアルAGT増返室ボタン機能新規追加 WGCH END -->
                    <!-- 2020/04/30 予約ポップの残室数画面を改修 WGCH BEGIN -->
                    <apex:outputLabel rendered="{!!isRaceRateComFlg}">
                    <!-- 2020/11/30 リアルAGT増返室ボタン機能新規追加 WGCH BEGIN -->
                    <input name="bookingBtn" type="button" class="btn"
                        style="width:36px;
                        color:{!IF(FLOOR(col.stock.QtyOfStock__c) < 0, 'red','black')};
                        display: {!if (colStatusMap[col.stock.StockDate__c].disable, 'none', 'true')};" 
                        stockDate="{!col.stock.StockDate__c}" roomTypeId="{!row.roomTypeId}" roomTyNm="{!HTMLENCODE(row.roomTypeNm)}"
                        travelId = "{!travelId}"
                        disableFlg = "{!if (colStatusMap[col.stock.StockDate__c].disable, 'true', 'false')}"
                        value="{!FLOOR(col.stock.QtyOfStock__c)}" />
                    <!-- 2020/11/30 リアルAGT増返室ボタン機能新規追加 WGCH END -->
                    </apex:outputLabel>
                    <apex:outputLabel rendered="{!isRaceRateComFlg}">
                    <!-- 2020/05/29 エステなど商品を追加したプラン機能 WGCH BEGIN -->
                    <!-- 2020/11/30 リアルAGT増返室ボタン機能新規追加 WGCH BEGIN -->
                    <input name="bookingBtn" type="button" class="btn btnCls"
                        style="max-width:50px;height:32px;min-width:36px;
                        color:{!IF(FLOOR(col.stock.QtyOfStock__c) < 0, 'red','black')};
                        color:{!IF(FLOOR(col.stock.QtyOfStock__c) < 0, 'red','black')};
                        display:none;" 
                        raceRatePrice="{!TEXT(raceRatePriceMap[row.roomTypeId][col.stock.StockDate__c])}"
                        stockDate="{!col.stock.StockDate__c}" roomTypeId="{!row.roomTypeId}" roomTyNm="{!HTMLENCODE(row.roomTypeNm)}"
                        travelId = "{!travelId}"
                        disableFlg = "{!if (colStatusMap[col.stock.StockDate__c].disable, 'true', 'false')}"
                        value="" />
                    <!-- 2020/11/30 リアルAGT増返室ボタン機能新規追加 WGCH END -->
                    <!-- 2020/05/29 エステなど商品を追加したプラン機能 WGCH END -->
                        <div class="k-button btnCls" style="min-width:96%;padding: 0px;margin: 0px; display: {!if (colStatusMap[col.stock.StockDate__c].disable, 'none', 'true')};" onclick="openNewWindow(this)" disableFlg = "{!if (colStatusMap[col.stock.StockDate__c].disable, 'true', 'false')}" >
                        	<div style="height: 14px;padding: 0px;margin: 0px;color:{!IF(FLOOR(col.stock.QtyOfStock__c) < 0, 'red','black')};">{!FLOOR(col.stock.QtyOfStock__c)}</div>
                        	<div style="height: 16px;padding: 0px;margin: 0px;">{!TEXT(raceRatePriceMap[row.roomTypeId][col.stock.StockDate__c])}</div>
                        </div>
                    </apex:outputLabel>
                    <!-- 2020/04/30 予約ポップの残室数画面を改修 WGCH END -->
                	<!-- 2018/03/12 ラックレート部屋タイプ別の対応　by　zy　END -->
                	<!-- 2020/11/30 リアルAGT増返室ボタン機能新規追加 WGCH BEGIN -->
                	<input class="numerictextbox {!if (colStatusMap[col.stock.StockDate__c].disable, '', 'showCls')}" style="width: 100%; display: none"
                			oldval="{!FLOOR(col.stock.QtyOfStock__c)}"
                			maxval="{!FLOOR(agtStockInfoMap[col.managerKey2].allQtyOfStock)}"
                			sfQtyOfStock="{!FLOOR(sfStockInfoMap[col.managerKey].sfQtyOfStock)}"
                			maxRooms="{!FLOOR(sfStockInfoMap[col.managerKey].maxRooms)}"
                			value="{!FLOOR(col.stock.QtyOfStock__c)}"
                			roomTypeId="{!row.roomTypeId}"
                			stockDate="{!col.stock.StockDate__c}"
                			accountId="{!travelId}"
                			rmngval="{!FLOOR(col.diffRoomInt)}"
                			managerKey="{!col.managerKey}"
                			managerKey2="{!col.managerKey2}"
                			disableFlg = "{!if (colStatusMap[col.stock.StockDate__c].disable, 'true', 'false')}"
                			 />
                	<!-- 变更角标 -->
                	<span name="updateSpan" class="tierClass" style="display: none;"></span>
                	<!-- 2020/11/30 リアルAGT増返室ボタン機能新規追加 WGCH END -->
                </td>
            </apex:repeat>
            <!-- 2019/10/30 予約ポップで表示されている残室数を期間指定してcsv出力 BY zyz BEGIN -->
            <td class="dataCell leftPanelItem" name="itemAgt">
            <!-- 2019/10/30 予約ポップで表示されている残室数を期間指定してcsv出力 BY zyz END -->
            <apex:outputPanel rendered="{!IF(count == 0, true, false)}">
				<a href="/{!travelId}" id="{!travelId}2" 
					onblur="LookupHoverDetail.getHover('{!travelId}2').hide();" 
					onfocus="LookupHoverDetail.getHover('{!travelId}2', '/{!travelId}/m?retURL=%2F{!travelId}&isAjaxRequest=1').show();" 
					onmouseout="LookupHoverDetail.getHover('{!travelId}2').hide();" 
					onmouseover="LookupHoverDetail.getHover('{!travelId}2', '/{!travelId}/m?retURL=%2F{!travelId}&isAjaxRequest=1').show();">{!travelobj.travelName}</a>
            </apex:outputPanel>
             </td>
            <td class="dataCell leftPanelItem">
             <a href="/{!row.roomTypeId}" id="{!row.roomTypeId}4{!travelId}" onblur="LookupHoverDetail.getHover('{!row.roomTypeId}4{!travelId}').hide();" onfocus="LookupHoverDetail.getHover('{!row.roomTypeId}4{!travelId}', '/{!row.roomTypeId}/m?retURL=%2F{!row.roomTypeId}&isAjaxRequest=1').show();" onmouseout="LookupHoverDetail.getHover('{!row.roomTypeId}4{!travelId}').hide();" onmouseover="LookupHoverDetail.getHover('{!row.roomTypeId}4{!travelId}', '/{!row.roomTypeId}/m?retURL=%2F{!row.roomTypeId}&isAjaxRequest=1').show();">{!row.roomTypeNm}</a>
             </td>
         </tr>
         <apex:variable var="count" value="{!count+1}"/>

         </apex:repeat>
         </apex:repeat>
        </apex:repeat>
        </apex:repeat>   
        

        </tbody>
    </table>
    </apex:outputPanel>

   </apex:pageBlock>
	<apex:actionFunction name="initFun" action="{!refreshStockInfo}" reRender="dispForm,messagePanel" oncomplete="AfterFun()"/>   
	<!-- 2018/07/27 宿泊税計算 WGCH BEGIN -->
	<script>
		var thisRoomSpcd = "";
		var planItemPriceMap = new Map();
		var planItemTypeMap = new Map();
		var hotelData = JSON.parse($j("#hidHotelInfoJson").val());
		function getPlanKeyFun(rowIndex){
			var _productId = $j("input:hidden[id$=':" + rowIndex + ":hidProductId']");
			return _productId.val() + '_' + _productId.attr('rowNo');
		}
	</script>
	<!-- 2018/07/27 宿泊税計算 WGCH END -->
 </apex:form>

<!-- This is the content of the modal dialog -->
<div id="myPanel" style="display: none; width: 740px" >
  <div class="hd">
    <!-- 新規予約 -->
    <apex:outputText value="{!$Label.ps__msg_003_0056}" />
  </div>
  <apex:outputPanel rendered="{!orgPopWindowFlag}">
  <apex:form id="createForm">
  <div class="bd" style="height: 540px; overflow: auto;" >
        <apex:inputHidden value="{!newLead.SalesOfficeInfoRef__c}" id="hidTravelId"/><!-- Hidden:旅行会社 -->
        <apex:inputHidden value="{!startDays}" id="hidStartDays"/><!-- Hidden:到着日 -->
        <apex:inputHidden value="{!roomType}" id="hidRoomType"/><!-- Hidden:部屋タイプID -->
        <input type="hidden"  id="hidRackratePrice" /> <!-- 画面から指定している室料 -->
        <apex:pageBlock id="createPageBlock">

        <!-- Message Panel Block -->        
        <apex:outputPanel id="messagePanel">
          <apex:pageMessages id="inputFormMsg"/>
          <apex:inputHidden value="{!bookingCreateOK}" id="hidDataCreateOK"/><!-- Hidden:Data Create IS OK -->
        </apex:outputPanel>

            <apex:pageBlockSection columns="2" id="createPageBlockSection">
            <!-- 予約名 -->
            <!-- 
            <apex:pageBlockSectionItem id="leadNameItem" >
                <apex:outputLabel value="予約名"/>
                <apex:inputField id="leadName" value="{!newLead.name}" required="true"/>
            </apex:pageBlockSectionItem>
             -->
             <!-- お客様 -->
          <apex:pageBlockSectionItem id="relcontactItem" helpText="{!$ObjectType.Contact.Fields.Name1__c.InlineHelpText}"> 
          <!-- お客様 -->
	        <apex:outputLabel value="{!$Label.ps__msg_003_0057}"/>
	        <apex:outputPanel styleClass="requiredInput" layout="block">
	        <apex:outputPanel styleClass="requiredBlock" layout="block"/>
	        <span class="lookupInput">
	        <apex:inputText id="relcontact" value="{!contactName}" html-placeholder="{!$Label.ps__inf_0002}" style="width:200px" maxlength="80">
	        <apex:inputHidden value="{!newLead.Relcontact__c}" id="relcontact_lkid"/>
	        <apex:inputHidden id="relcontact_lkold"/>		<!-- PopupWin利用 -->
	        <input type="hidden" id="relcontact_lkid_org" />	<!-- JS判断用 -->
	        <c:AutoCompleteComp objectname="Contact" 
	        	additionalfield="{!$Setup.CommDefine__c.AppNS__c}KanaName1__c,{!$Setup.CommDefine__c.AppNS__c}Name1__c,Phone,{!$Setup.CommDefine__c.AppNS__c}CompanyNameCal__c,{!$Setup.CommDefine__c.AppNS__c}Katakana__c"
	        	autocomplete_textbox="{!$Component.relcontact}" 
				showField="{!$Setup.CommDefine__c.AppNS__c}KanaName1__c,{!$Setup.CommDefine__c.AppNS__c}Katakana__c,Phone,{!$Setup.CommDefine__c.AppNS__c}CompanyNameCal__c,Description"
				maxLenFilter="Description:16"
	        	showFieldSeparator=", "
                addFilter="IsDelete__c!=true"
	        />
	        </apex:inputText>
	        <!-- 部屋選択 -->
	        <img title="" onmouseover="this.className = 'lookupIconOn';this.className = 'lookupIconOn';"
	         onmouseout="this.className = 'lookupIcon';this.className = 'lookupIcon';"
	         onfocus="this.className = 'lookupIconOn';"
	         onblur="this.className = 'lookupIcon';"
	         class="lookupIcon" alt="" src="/s.gif" style="cursor: pointer;vertical-align:middle;border: 0px"
	         name="accountPopup" />
	         </span>
	        </apex:outputPanel>
	      </apex:pageBlockSectionItem>
            <!-- 部屋タイプ -->
            <apex:pageBlockSectionItem id="refTypeOfRoomsItem">
                <apex:outputLabel value="{!$Label.ps__msg_003_0046}"/>
                <apex:outputText id="refTypeOfRooms" value="" />
            </apex:pageBlockSectionItem>
            <!-- お客様 -->
            <!-- 
            <apex:pageBlockSectionItem id="relcontactItem">
                <apex:outputLabel value="お客様"/>
                <apex:inputField id="relcontact" value="{!newLead.Relcontact__c}" required="true"/>
            </apex:pageBlockSectionItem>
             -->
             <!-- 予約名 -->
            <apex:pageBlockSectionItem id="leadNameItem" >
                <apex:outputLabel value="{!$Label.ps__msg_003_0058}"/>
		        <apex:outputPanel styleClass="requiredInput" layout="block">
		        <apex:outputPanel styleClass="requiredBlock" layout="block"/>
                <apex:inputField id="leadName" value="{!newLead.name}" style="width:200px" />
                </apex:outputPanel>
            </apex:pageBlockSectionItem>
            <!-- $到着日 -->
            <apex:pageBlockSectionItem id="entryDateItem">
                <apex:outputLabel value="{!$Label.ps__msg_003_0059}"/>
                <apex:outputPanel >
                <apex:outputText id="entryDate" value="" />
                
                </apex:outputPanel>
            </apex:pageBlockSectionItem>
            
    <apex:pageBlockSectionItem helpText="{!$ObjectType.Contact.Fields.Katakana__c.InlineHelpText}" id="katakanaItem">
        <apex:outputLabel value="{!$ObjectType.Contact.Fields.Katakana__c.label}"/>
        <apex:inputText id="katakana" value="{!newContact.Katakana__c}" maxlength="80" />
    </apex:pageBlockSectionItem>

            <!-- 到着時刻 -->
            <apex:pageBlockSectionItem id="entryTimeItem">
                <apex:outputLabel value="{!$ObjectType.Lead__c.Fields.Field4__c.label}"/>
                <apex:inputField id="entryTime" value="{!newLead.Field4__c}" required="true"/>
            </apex:pageBlockSectionItem>

    <apex:pageBlockSectionItem helpText="{!$ObjectType.Contact.Fields.KanaName1__c.InlineHelpText}" id="kanaNameItem">
        <!-- カタカナ -->
        <apex:outputLabel value="{!$Label.ps__msg_003_0060}"/>
        <apex:inputText id="kanaName" value="{!newContact.KanaName1__c}" />
    </apex:pageBlockSectionItem>

            <!-- $出発日 -->
            <apex:pageBlockSectionItem id="departureDateItem">
                <apex:outputLabel value="{!$Label.ps__msg_003_0061}"/>
                <apex:outputText id="departureDate" value="" />
            </apex:pageBlockSectionItem>       
	 
    <apex:pageBlockSectionItem id="custPhoneItem">
        <!-- TEL -->
        <apex:outputLabel value="{!$Label.ps__msg_003_0062}"/>
        <apex:inputText id="custPhone" value="{!newContact.Phone}" />
    </apex:pageBlockSectionItem>

            <!-- $出発時刻 -->
            <apex:pageBlockSectionItem id="departureTimeItem">
                <apex:outputLabel value="{!$ObjectType.Lead__c.Fields.Field3__c.label}"/>
                <apex:inputField id="departureTime" value="{!newLead.Field3__c}" required="true"/>
            </apex:pageBlockSectionItem>
             
            <!-- 予約人数 -->
            <apex:pageBlockSectionItem id="stayPersonItem">
                <apex:outputLabel value="{!$Label.ps__msg_003_0063}"/>
		        <apex:outputPanel styleClass="requiredInput" layout="block">
		        <apex:outputPanel styleClass="requiredBlock" layout="block"/>
                <apex:inputField id="stayPerson" value="{!newLead.StayPersons__c}" required="false"/>
                </apex:outputPanel>
            </apex:pageBlockSectionItem>
            <!-- セミナー -->
            <apex:inputField id="seminarOrderFlg" value="{!newLead.SeminarOrderFlg__c}" rendered="{!isHaveSeminar}"/>
            <apex:outputLabel value="" rendered="{!!isHaveSeminar}"/>
            
            <!-- 泊数 -->
            <apex:pageBlockSectionItem id="staysNumsItem">
                <apex:outputLabel value="{!$Label.ps__msg_003_0064}"/>
                <apex:inputText id="staysNums" value="{!staysNums}" onchange="setDepartureDateAuto()"/>
            </apex:pageBlockSectionItem>

            <!-- エキストラベッド -->
            <apex:inputField id="extrabedFlg" value="{!newLead.ExtraBedChk__c}" rendered="{!isHaveEbInfo}"/>
            <apex:outputLabel value="" rendered="{!!isHaveEbInfo}"/>
            
            <!-- 部屋数 -->
            <apex:pageBlockSectionItem id="bookingRoomsItem">
                <apex:outputLabel value="{!$Label.ps__msg_003_0065}"/>
                <apex:inputText id="bookingRooms" value="{!bookingRooms}"  />
            </apex:pageBlockSectionItem>
			<apex:outputLabel value="" />
			


<!-- 部屋 -->
<apex:pageblockSectionItem id="broom" helpText="{!$ObjectType.Lead__c.Fields.Rroom__c.inlineHelpText}" rendered="{!isHaveRoom}">
    <apex:outputlabel value="{!$ObjectType.Lead__c.Fields.Rroom__c.label}" />
    <apex:outputPanel styleClass="lookupInput" style="vertical-align:top">
    <span class="lookupInput">
        <apex:inputText value="{!roomName}" id="name" style="background-color:#E0E0E0" disabled="true" />
        <apex:inputHidden value="{!newLead.Rroom__c}" id="id"/>
        <!-- 部屋クリア -->
        <c:ClearInputValueComp elementIds="
            '{!$Component.createForm.createPageBlock.createPageBlockSection.broom.id}',
            '{!$Component.createForm.createPageBlock.createPageBlockSection.broom.name}'" 
            tips="{!$Label.ps__msg_003_0066}"/>
        <!-- 部屋選択 -->
        <img title="" onmouseover="this.className = 'lookupIconOn';this.className = 'lookupIconOn';"
         onmouseout="this.className = 'lookupIcon';this.className = 'lookupIcon';"
         onfocus="this.className = 'lookupIconOn';"
         onblur="this.className = 'lookupIcon';"
         class="lookupIcon" alt="" src="/s.gif" style="cursor: pointer;vertical-align:middle;border: 0px"
         name="roomPopup" />
    </span>
    </apex:outputPanel>
   	
</apex:pageblockSectionItem>
            <apex:outputLabel value="" rendered="{!isHaveRoom}"/>

            <!-- プラン -->
            <apex:pageBlockSectionItem id="planItem">
                <apex:outputLabel value="{!$Label.ps__msg_003_0067}"/>
    <apex:outputPanel styleClass="lookupInput" style="vertical-align:top">
    <span class="lookupInput">
				<apex:inputField id="plan" value="{!newLead.Field310__c}" html-placeholder="{!$Label.ps__inf_0002}" style="width:180px" >
					<c:AutoCompleteComp objectname="Plan__c"
						jslibnew="false"
						additionalfield="{!$Setup.CommDefine__c.AppNS__c}PlanNo__c,{!$Setup.CommDefine__c.AppNS__c}PackageCode__c"
						autocomplete_textbox="{!$Component.plan}" addFilter="IsClosed__c=false" callbackFunction="planRest"  soslExtend="false"/>
				</apex:inputField>
    		<!-- プラン詳細 -->
                <img src="{!URLFOR($Resource.AppImages, 'extend/jiahao.png')}" style="cursor: pointer; width: 18px; height: 18px;"
	                		onclick="javascript:openMiniPlanSetup(this);" id="planCustomeBtn" title="{!$Label.MSG_003_0068}"/>
				</span>
				<apex:inputHidden value="{!newLead.PlanDetailSyncInfo__c}" id="nl_hidPlanDetailInfo"/>
				</apex:outputPanel>
            </apex:pageBlockSectionItem>
            <apex:outputLabel value="" />
            <!-- 支払方法 -->
            <apex:pageBlockSectionItem id="paymentTypeItem">
                <apex:outputLabel value="{!$Label.ps__msg_003_0069}"/>
                <apex:selectList value="{!newLead.Field315__c}" multiselect="false" size="1" id="paymentType">
                	<apex:selectOptions value="{!paymentTypeLst}"/>
                </apex:selectList>
            </apex:pageBlockSectionItem>
            <apex:outputLabel value="" />
            <!-- 予約チャネル -->
            <apex:pageBlockSectionItem id="channel">
            	<apex:outputLabel value="{!$Label.ps__msg_003_0070}"/>
		        <apex:outputPanel styleClass="requiredInput" layout="block">
		        <apex:outputPanel styleClass="requiredBlock" layout="block"/>
	            <apex:inputField value="{!newLead.Field2__c}" id="chanelId"/>
            	</apex:outputPanel>
            </apex:pageBlockSectionItem>
            <apex:outputLabel value="" />
            <!-- セグメント -->
            <apex:pageBlockSectionItem id="segmentItem">
                <apex:outputLabel value="{!$Label.ps__msg_003_0071}"/>
                <apex:inputField id="segment" value="{!newLead.Segment__c}" />
            </apex:pageBlockSectionItem>
            <apex:outputLabel value="" />
          </apex:pageBlockSection>
        
		<!-- Extend Field -->        	
     	<apex:dynamicComponent componentValue="{!InputExtendFields}" /> 

        <apex:pageBlockSection columns="1" id="createPageBlockSection2" >
            <apex:inputTextarea value="{!newLead.Comment3__c}" id="comment3" richtext="false" rows="4" cols="160" styleClass="ckeditorClass"/>
        </apex:pageBlockSection>

        </apex:pageBlock>
        <!-- 
        <div style="text-align: right;" >
          <apex:commandButton value="保存" onclick="doBeforeSave();" oncomplete="bookingCreateCallBack();"
            action="{!bookinCreate}" reRender="dispForm,messagePanel"  status="refStatusBlock"/>
          <input type="button" value="キャンセル" id="cancelBtn" class="btn" />
        </div>
       -->
  </div>

  <div class="ft" style="font-size: 10px;">
    <apex:outputPanel layout="block">
        <div style="text-align: right;" >
          <input type="reset" value="reset" id="formresetbtn" style="display: none;"/>
            <!-- 保存 -->
           <input type="button" value="{!$Label.MSG_003_0072}" class="btn" style="width: 100px"  onclick="javascript:if (checkRoomsNumber()) {doBeforeSave(); saveLeadFun();}"/>
           <apex:actionFunction name="saveLeadFun" oncomplete="bookingCreateCallBack();"
          							action="{!bookingCreate}" reRender="dispForm,messagePanel"  status="refStatusBlock" />
            <!-- キャンセル -->
          <input type="button" value="{!$Label.MSG_003_0073}" id="cancelBtn" class="btn" style="width: 100px"/>
        </div>
    </apex:outputPanel>
  </div>
  
</apex:form>
  </apex:outputPanel>
  <apex:outputPanel rendered="{!!orgPopWindowFlag}">
  	<c:CustomLeadWindow ShopCode="{!branchShopNm}"/>
  </apex:outputPanel>
</div>

<!-- Tier情報設定フォーム -->

<div id="schedule" style="display: none;min-width: 480px" >
  <!-- Header -->
  <div class="hd">
    <!-- Tier設定 -->
    <apex:outputText value="{!$Label.ps__msg_003_0074}" />
  </div>
  
  <apex:form >
  <!-- Body -->
  <div class="bd" >

	  <!-- Message Panel Block -->        
	  <apex:outputPanel id="scheduleMessagePanel">
	    <apex:pageMessages id="inputTierFormMsg"/>
	    <apex:inputHidden value="{!bookingCreateOK}" id="sch_hidDataCreateOK"/><!-- Hidden:Data Create IS OK -->
	    <!-- 2016/12/14 CTI予約 BEGIN by zyz -->
		<apex:inputHidden value="{!ctiContactInf}" id="ctiContactInf"/>
		<!-- 2016/12/14 CTI予約 END by zyz -->
	  </apex:outputPanel>

	  <table>
	  	<col style="width: 80px;" />
	  	<col style="width: 90px;" />
	  	<col style="width: 350px;" />
	  	<tr style="vertical-align: top;">
	  	<td colspan="2"/>
	  	<td >
	  	<select id="tierSelect">
	  		<apex:repeat var="tier" value="{!tiersLst}">
	  		<option value="{!tier.value}">{!tier.label}</option>
	  		</apex:repeat>
	  	</select>
	  	<!-- 2018/03/12 ラックレート部屋タイプ別の対応　by　zy　BEGIN -->
	  	<span style="margin-left:22px"><input type='checkbox' id="roomTypeCtlCheckBox" checked="checked" onclick="changeSelectRm(this)"/>{!$Label.MSG_003_0084_01}</span>
	  	<!-- 2018/03/12 ラックレート部屋タイプ別の対応　by　zy　END -->
	  	</td>
	  	</tr>
	  	<tr style="vertical-align: top;">
        <!-- 頻度 -->
	  	<td style="text-align: right;"><span style="margin-right: 10px;margin-top: 14px;">{!$Label.MSG_003_0075}</span></td>
	  	<td>
            <!-- 毎週 -->
	  		<label for="repeatWeek">{!$Label.MSG_003_0076}</label> 
	  		<input type="radio" id="repeatWeek" name="repeatDayType" value="week" checked="checked"/>
	  		<br/>
	  		<br/>
	  		<!-- 
	  		<label for="repeatMonth">毎月</label> 
	  		<input type="radio" id="repeatMonth" name="repeatDayType"  value="month" checked="checked" onclick="switchOption(this.value)"/>
	  		 -->
	  	</td>
	  	<td>
	  	<!-- 2018/03/12 ラックレート部屋タイプ別の対応　by　zy　BEGIN -->
  		<div style="background-color: white;position: relative;" id="weekBlock">
  		<!-- 2018/03/12 ラックレート部屋タイプ別の対応　by　zy　END -->
  		<table style="margin-left:0px;border-spacing: 0px;border-width: 0px;table-layout: fixed;">
			<tr>
			   <td>
            <!-- 月曜 -->
	  		<label for="Monday">{!$Label.MSG_003_0077}</label> 
	  		   </td>
	  		   <td>
	  		<input type="checkbox" id="Monday" value="Monday" name="weekOpts"/>
  			   </td>
			</tr>
			<tr>
			   <td>
            <!-- 火曜 -->
	  		<label for="Tuesday">{!$Label.MSG_003_0078}</label> 
	  		 </td>
	  		   <td>
	  		<input type="checkbox" id="Tuesday" value="Tuesday" name="weekOpts"/>
  			   </td>
			</tr>
			<tr>
			   <td>
            <!-- 水曜 -->
	  		<label for="Wednesday">{!$Label.MSG_003_0079}</label> 
	  		 </td>
	  		   <td>
	  		<input type="checkbox" id="Wednesday" value="Wednesday" name="weekOpts"/>
  			   </td>
			</tr>
			<tr>
			   <td>
            <!-- 木曜 -->
	  		<label for="Thursday">{!$Label.MSG_003_0080}</label> 
	  		 </td>
	  		   <td>
	  		<input type="checkbox" id="Thursday" value="Thursday" name="weekOpts"/>
  			   </td>
			</tr>
			<tr>
			   <td>
            <!-- 金曜 -->
	  		<label for="Friday">{!$Label.MSG_003_0081}</label> 
	  		 </td>
	  		   <td>
	  		<input type="checkbox" id="Friday" value="Friday" name="weekOpts"/>
  			   </td>
			</tr>
			<tr>
			   <td>
            <!-- 土曜 -->
	  		<label for="Saturday">{!$Label.MSG_003_0082}</label> 
	  		 </td>
	  		   <td>
	  		<input type="checkbox" id="Saturday" value="Saturday" name="weekOpts"/>
  			   </td>
			</tr>
			<tr>
			   <td>
            <!-- 日曜 -->
	  		<label for="Sunday">{!$Label.MSG_003_0083}</label> 
	  		 </td>
	  		   <td>
	  		<input type="checkbox" id="Sunday" value="Sunday" name="weekOpts"/>
  		   </td>
			</tr>
			<tr>
			   <td colspan="2">
			 <!-- に繰り返し -->{!$Label.MSG_003_0084}
			    </td>
			</tr>
			</table>
			<!-- 2018/03/12 ラックレート部屋タイプ別の対応　by　zy　BEGIN  -->
			<!-- 2019/06/30 JINYABUG-1935 bug fix by zy BEGIN -->
			<div class="roomtypepanel rackset">
			<!-- 2019/06/30 JINYABUG-1935 bug fix by zy END -->
				<table cellspacing='0' style="width: 100%;">
					<apex:repeat id="repeat" var="typesobj" value="{!roomTypeLst}">
						<tr class="checkRow" name="{!typesobj.id}" onclick="onTierRoomTypeClick(this)">
							<td>
								<input type='checkbox' name='roomTypeSel' checked='checked' />
								{!typesobj.name}
							</td>
						</tr>
					</apex:repeat>
				</table>
			</div>
			<!-- 2018/03/12 ラックレート部屋タイプ別の対応　by　zy　END  -->
  		</div>
  		
  		<div style="background-color: white;display: none;" id="monthBlock">
  		<input type="radio" id="repeatMonth1" name="repeatMonthType" 
  			   value="month1" checked="checked" onclick="switchMonthOption(this.value)"/>
  		<label for="dayOfMonth"><!-- 毎月 -->{!$Label.MSG_003_0085}</label> 
  		<select id="dayOfMonth">
			<option value="1">1</option>
			<option value="2">2</option>
			<option value="3">3</option>
			<option value="4">4</option>
			<option value="5">5</option>
			<option value="6">6</option>
			<option value="7">7</option>
			<option value="8">8</option>
			<option value="9">9</option>
			<option value="10">10</option>
			<option value="11">11</option>
			<option value="12">12</option>
			<option value="13">13</option>
			<option value="14">14</option>
			<option value="15">15</option>
			<option value="16">16</option>
			<option value="17">17</option>
			<option value="18">18</option>
			<option value="19">19</option>
			<option value="20">20</option>
			<option value="21">21</option>
			<option value="22">22</option>
			<option value="23">23</option>
			<option value="24">24</option>
			<option value="25">25</option>
			<option value="26">26</option>
			<option value="27">27</option>
			<option value="28">28</option>
			<option value="29">29</option>
			<option value="30">30</option>
			<option value="31">31</option>
            <!-- 最終 -->
			<option value="99">{!$Label.MSG_003_0086}</option>
  		</select>
  		<label ><!-- 日 -->{!$Label.MSG_003_0087}</label> 
  		
		<input type="radio" id="repeatMonth2" name="repeatMonthType" 
		       value="month2" onclick="switchMonthOption(this.value)"/>
  		<label for="weekOfMonth"><!-- 毎月 -->{!$Label.MSG_003_0085}</label> 
  		<select id="weekOfMonth" disabled="disabled">
  			<option value="1"><!-- 第１ -->{!$Label.MSG_003_0088}</option>
  			<option value="2"><!-- 第２ -->{!$Label.MSG_003_0089}</option>
  			<option value="3"><!-- 第３ -->{!$Label.MSG_003_0090}</option>
  			<option value="4"><!-- 第４ -->{!$Label.MSG_003_0091}</option>
  			<option value="9"><!-- 最終 -->{!$Label.MSG_003_0086}</option>
  		</select>
  		<select id="dayOfWeek" disabled="disabled">
  			<option value="Monday"><!-- 月曜 -->{!$Label.MSG_003_0077}</option>
  			<option value="Tuesday"><!-- 火曜 -->{!$Label.MSG_003_0078}</option>
  			<option value="Wednesday"><!-- 水曜 -->{!$Label.MSG_003_0079}</option>
  			<option value="Thursday"><!-- 木曜 -->{!$Label.MSG_003_0080}</option>
  			<option value="Friday"><!-- 金曜 -->{!$Label.MSG_003_0081}</option>
  			<option value="Saturday"><!-- 土曜 -->{!$Label.MSG_003_0082}</option>
  			<option value="Sunday"><!-- 日曜 -->{!$Label.MSG_003_0083}</option>
  		</select>
  		</div>
  		</td>
	  	</tr>
	  	
	  	<tr><td colspan="3" style="height: 10px">&nbsp;</td></tr>
	  	<tr>
	  	<td style="text-align: right;margin-right: 5px"><!-- 開始日付 -->{!$Label.MSG_003_0092}</td>
	  	<td colspan="2">
	  	<apex:inputField id="sch_startDate" value="{!workSobj.StartDate__c}" style="font-size: 14px; width: 90px;" onblur="dateFormatFun(this)"/>
	  	</td>
	  	</tr>
	  	
	  	<tr>
	  	<td style="text-align: right;margin-right: 5px"><!-- 終了日付 -->{!$Label.MSG_003_0093}</td>
	  	<td colspan="2">
	  	<apex:inputField id="sch_endDate" value="{!workSobj.EndDate__c}" style="font-size: 14px; width: 90px;" onblur="dateFormatFun(this)"/>
	  	</td>
	  	</tr>
  	</table>

  </div>
  <!-- Footer -->
  <div class="ft" >
    <apex:outputPanel layout="block">
        <div style="text-align: right;" >
          <input type="reset" value="reset" id="scheduleFormresetbtn" style="display: none;"/>
          <!-- 保存 -->
          <input type="button" value="{!$Label.MSG_003_0072}" 		class="btn" style="width:100px" 	onclick="createRaceRateFun()"/>
          <!-- キャンセル -->
          <input type="button" value="{!$Label.MSG_003_0073}" class="btn" style="width: 100px" 	onclick="YAHOO.force.com.hideSchedule()" />
        </div>
    </apex:outputPanel>
  </div>
  </apex:form>
  
  <apex:form id="scheduleForm">
  <apex:actionFunction name="scheduleSaveFun" action="{!createRaceTableDetail}" oncomplete="raceRateCreateCallBack();"
  					   status="refStatusBlock" reRender="dispForm, scheduleMessagePanel" />
  <apex:inputHidden value="{!tierInfo.tier}" 		id="hidTier"/>
  <apex:inputHidden value="{!tierInfo.isWeekRepeat}" 	id="hidRepeatType"/>
  <apex:inputHidden value="{!tierInfo.weekOpts}" 	id="hidWeekOpts"/>
  <apex:inputHidden value="{!tierInfo.isDayOfMonth}" id="hidIsDayOfMonth"/>
  <apex:inputHidden value="{!tierInfo.dayOfMonth}" 	id="hidDayOfMonth"/>
  <apex:inputHidden value="{!tierInfo.weekOfmonth}" id="hidWeekOfMonth"/>
  <apex:inputHidden value="{!tierInfo.dayOfWeek}" 	id="hidDayOfWeek"/>
  <apex:inputHidden value="{!tierInfo.startDate}" 	id="hidStartDate"/>
  <apex:inputHidden value="{!tierInfo.endDate}" 	id="hidEndDate"/>
  <!-- 2018/03/12 ラックレート部屋タイプ別の対応　by　zy　BEGIN -->
  <!-- Tierタイプ別の対応 -->
  <apex:inputHidden value="{!tierInfo.roomTypeId}" id="hidRoomTypes"/>
  <apex:inputHidden value="{!tierInfo.moreTypeMsg}" id="hidMoreTypeMsg"/>
  <!-- 2018/03/12 ラックレート部屋タイプ別の対応　by　zy　END -->
  </apex:form>
  
</div>


<div id="layoffPanel" style="display: none;" >
	<div class="hd">
    <!-- 期間設定 -->
    <apex:outputText value="{!$Label.ps__msg_003_0094}" id="restFormTitle"/>
	</div>
  
	<apex:form id="restTermForm">
	<div class="bd" >

	 <!-- Message Panel Block -->        
	 <apex:outputPanel id="restMessagePanel">
	   <apex:pageMessages id="inputTierFormMsg"/>
	   <apex:inputHidden value="{!bookingCreateOK}" id="rest_hidDataCreateOK"/><!-- Hidden:Data Create IS OK -->
	 </apex:outputPanel>
	  
  	<table>

  	<col style="width: 240px;" />
  	<col style="width: 240px;" />
  	<tr>
  	<td colspan="2">
  	<div style="margin: 0px 0px 0px 0px;font-size: 14px;text-align: center;">
  	<apex:repeat var="status" value="{!roomStatusList}">
	<span style="margin-left: 20px;white-space: nowrap;">
  	<input type="radio" name="roomstatusRadio" value="{!status}"/>{!status}</span>
  	</apex:repeat>
  	</div>
  	</td>
  	</tr>
  	
  	<tr>
  	<td colspan="2">
  	<hr/>
  	</td></tr>
  	
  	<tr>

  	<td><!-- 開始日 -->{!$Label.MSG_003_0095}<apex:inputField id="layoff_startDate" value="{!workSobj.StartDate__c}" style="font-size: 14px; width: 90px;" onblur="dateFormatFun(this)"/>
  	</td>
  	<td><!-- 終了日 -->{!$Label.MSG_003_0096}<apex:inputField id="layoff_endDate" value="{!workSobj.StartDate__c}" style="font-size: 14px; width: 90px;" onblur="dateFormatFun(this)"/>
  	</td>
  	</tr>
	</table>
	</div>

	<div class="ft" >
    <apex:outputPanel layout="block">
        <div style="text-align: right;" >
          <input type="reset" value="reset" id="termFormresetbtn" style="display: none;"/>
          <!-- oncomplete="YAHOO.force.com.hideMe();"  -->
          <!-- 保存 -->
          <input type="button" value="{!$Label.MSG_003_0072}" 	class="btn" style="width:100px" onclick="createRestHotelInfoJsFun()" />
          <!-- キャンセル -->
          <input type="button" value="{!$Label.MSG_003_0073}" id="cancelBtn" onclick="YAHOO.force.com.hideLayoffPanel()" class="btn" style="width: 100px"/>
        </div>
    </apex:outputPanel>
	</div>
	<apex:inputHidden id="hidRestHotelStatus" value="{!hotelInf.hotelStatus}" /> <!-- Open: true(休館) false(通常) -->
	<apex:inputHidden id="hidRestStartDate" value="{!hotelInf.startDate}" />
	<apex:inputHidden id="hidRestEndDate" value="{!hotelInf.endDate}" />
  	<apex:actionFunction name="createRestHotelInfoFun" action="{!updateHotelStatus}" oncomplete="restUpdateCallBack();"
  					   status="refStatusBlock" reRender="dispForm, restMessagePanel" />
	</apex:form>
</div>
<!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz BEGIN -->
<div class="PlanscheduleScreen"></div>
<div id="Planschedule" style="display: none;min-width: 480px" >
  <!-- Header -->
  <div class="hd">
    <!-- Tier設定 -->
    <apex:outputText value="{!$Label.ps__msg_003_0074}" />
  </div>
  
  <apex:form id="windowFormId">
  <!-- Body -->
  <div class="bd" >

	  <table>
	  	<col style="width: 80px;" />
	  	<col style="width: 90px;" />
	  	<col style="width: 350px;" />
	  	<tr style="vertical-align: top;">
	  	<td colspan="2"/>
	  	<td >
	  	<!-- vip -->
	  	<select id="vipSelectId">
	  		<apex:repeat var="planVip" value="{!vipTypeLst}">
	  		<option value="{!planVip}">{!planVip}</option>
	  		</apex:repeat>
	  	</select>
	  	<select id="tierSelectId">
	  		<apex:repeat var="tier" value="{!tiersLst}">
	  		<option value="{!tier.value}">{!tier.label}</option>
	  		</apex:repeat>
	  	</select>
	  	<!-- 販売状態 -->
	  	<select id="salesSelId">
	  		<!-- 2020/05/30 予約ポップラックレート設定[プラン]bug対応 BY zyz BEGIN -->
	  		<option value=""></option>
	  		<!-- 2020/05/30 予約ポップラックレート設定[プラン]bug対応 BY zyz END -->
  			<option value="1">{!STOCK_SETTYPE_SALE}</option>
  			<option value="2">{!STOCK_SETTYPE_STOP}</option>
	  	</select>
	  	<!-- 2020/05/30 予約ポップラックレート設定[プラン]bug対応 BY zyz BEGIN -->
	  	<span style="margin-left:22px;display:{!IF(isPlanActionFlg && !isBasePlanFlg,'none;','')}"><input type='checkbox' id="roomTypeCtlCheckBoxs" checked="checked" onclick="changeSelectRmPlan(this)"/>{!$Label.MSG_003_0084_01}</span>
	  	<!-- 2020/05/30 予約ポップラックレート設定[プラン]bug対応 BY zyz END -->
	  	</td>
	  	</tr>
	  	<tr style="vertical-align: top;">
        <!-- 頻度 -->
	  	<td style="text-align: right;"><span style="margin-right: 10px;margin-top: 14px;">{!$Label.MSG_003_0075}</span></td>
	  	<td>
            <!-- 毎週 -->
	  		<label for="PlanrepeatWeek">{!$Label.MSG_003_0076}</label> 
	  		<input type="radio" id="PlanrepeatWeek" name="repeatDayType" value="week" checked="checked"/>
	  		<br/>
	  		<br/>
	  	</td>
	  	<td>
	  	<!-- 2018/03/12 ラックレート部屋タイプ別の対応　by　zy　BEGIN -->
  		<div style="background-color: white;position: relative;" id="PlanweekBlock">
  		<!-- 2018/03/12 ラックレート部屋タイプ別の対応　by　zy　END -->
  		<table style="margin-left:0px;border-spacing: 0px;border-width: 0px;table-layout: fixed;">
			<tr>
			   <td>
            <!-- 月曜 -->
	  		<label for="Monday">{!$Label.MSG_003_0077}</label> 
	  		   </td>
	  		   <td>
	  		<input type="checkbox" id="Monday" value="Monday" name="PlanweekOpts"/>
  			   </td>
			</tr>
			<tr>
			   <td>
            <!-- 火曜 -->
	  		<label for="Tuesday">{!$Label.MSG_003_0078}</label> 
	  		 </td>
	  		   <td>
	  		<input type="checkbox" id="Tuesday" value="Tuesday" name="PlanweekOpts"/>
  			   </td>
			</tr>
			<tr>
			   <td>
            <!-- 水曜 -->
	  		<label for="Wednesday">{!$Label.MSG_003_0079}</label> 
	  		 </td>
	  		   <td>
	  		<input type="checkbox" id="Wednesday" value="Wednesday" name="PlanweekOpts"/>
  			   </td>
			</tr>
			<tr>
			   <td>
            <!-- 木曜 -->
	  		<label for="Thursday">{!$Label.MSG_003_0080}</label> 
	  		 </td>
	  		   <td>
	  		<input type="checkbox" id="Thursday" value="Thursday" name="PlanweekOpts"/>
  			   </td>
			</tr>
			<tr>
			   <td>
            <!-- 金曜 -->
	  		<label for="Friday">{!$Label.MSG_003_0081}</label> 
	  		 </td>
	  		   <td>
	  		<input type="checkbox" id="Friday" value="Friday" name="PlanweekOpts"/>
  			   </td>
			</tr>
			<tr>
			   <td>
            <!-- 土曜 -->
	  		<label for="Saturday">{!$Label.MSG_003_0082}</label> 
	  		 </td>
	  		   <td>
	  		<input type="checkbox" id="Saturday" value="Saturday" name="PlanweekOpts"/>
  			   </td>
			</tr>
			<tr>
			   <td>
            <!-- 日曜 -->
	  		<label for="Sunday">{!$Label.MSG_003_0083}</label> 
	  		 </td>
	  		   <td>
	  		<input type="checkbox" id="Sunday" value="Sunday" name="PlanweekOpts"/>
  		   </td>
			</tr>
			<tr>
			   <td colspan="2">
			 <!-- に繰り返し -->{!$Label.MSG_003_0084}
			    </td>
			</tr>
			</table>
			<div class="planpanel" style="">
				<table cellspacing='0' style="width: 100%;">
					<apex:repeat id="planRepeat" var="sobj" value="{!baseplanLst}">
						<!-- 2020/05/30 予約ポップラックレート設定[プラン]bug対応 BY zyz BEGIN -->
						<tr class="checkRow" name="{!sobj.id}" style="display:{!IF(isPlanActionFlg && !isBasePlanFlg,IF(sobj.id == actionModeType,'','none'),'')}" onclick="onPlanClick(this)">
							<td>
								<input type='checkbox' name='planSel' checked='checked' />
								{!sobj.name}
							</td>
						</tr>
						<!-- 2020/05/30 予約ポップラックレート設定[プラン]bug対応 BY zyz END -->
					</apex:repeat>
				</table>
			</div>
  		</div>
  		
  		</td>
	  	</tr>
	  	
	  	<tr><td colspan="3" style="height: 10px">&nbsp;</td></tr>
	  	<tr>
	  	<td style="text-align: right;margin-right: 5px"><!-- 開始日付 -->{!$Label.MSG_003_0092}</td>
	  	<td colspan="2">
	  	<apex:inputField id="Plansch_startDate" value="{!workSobj.StartDate__c}" style="font-size: 14px; width: 90px;" onblur="dateFormatFun(this)"/>
	  	</td>
	  	</tr>
	  	
	  	<tr>
	  	<td style="text-align: right;margin-right: 5px"><!-- 終了日付 -->{!$Label.MSG_003_0093}</td>
	  	<td colspan="2">
	  	<apex:inputField id="Plansch_endDate" value="{!workSobj.EndDate__c}" style="font-size: 14px; width: 90px;" onblur="dateFormatFun(this)"/>
	  	</td>
	  	</tr>
  	</table>

  </div>
  <!-- Footer -->
  <div class="ft" >
    <apex:outputPanel layout="block">
        <div style="text-align: right;" >
          <input type="reset" value="reset" id="PlanscheduleFormresetbtn" style="display: none;"/>
          <!-- 保存 -->
          <input type="button" value="{!$Label.MSG_003_0072}" 		class="btn" style="width:100px" 	onclick="createPlanFun()"/>
          <!-- キャンセル -->
          <input type="button" value="{!$Label.MSG_003_0073}" class="btn" style="width: 100px" 	onclick="YAHOO.force.com.hidePlanSchedule()" />
        </div>
    </apex:outputPanel>
  </div>
  </apex:form>
</div>
<!-- 2020/03/31 予約ポップでラックレートのテーブルを複数持つ機能 BY zyz END -->
<script>
$j(document).ready(function() {
	// 新規予約初期化呼び出し
	YAHOO.force.com.init();
	/* Window:F5 / Ctrl+R  Mac:Command+R 対応[2015/12/10 ADD] */
	var $key = key.noConflict();
	$key.filter = function(event){
		// 全画面から画面更新可能
		return true;
	}
	$key('command+r, ctrl+r, f5', function(e){ 
		stopRunning();
		stockRefreshFun();
		_messageComp_refreshMessage();
		e.preventDefault();
		return false;
	});
	// 2019/09/30 新規予約など、保存(Ctrl+S)対応 WGCH BEGIN
	$key('command+s, ctrl+s', function(e){
		if($j("#myPanel_mask").is(":visible") && JINYACONNECT.CUSTOM.CheckRoomsNumber()) JINYACONNECT.CUSTOM.doBeforeSave();
		e.preventDefault();
		return false;
	});
	// 2019/09/30 新規予約など、保存(Ctrl+S)対応 WGCH END
});
// 2019/04/30 予約ポップの在庫設定(AGT)の変更機能 BY zyz BEGIN
// 在庫設定画面保存
function salesSavePanel1(){
	var sch = $("#salesSched");
	var weekOpts = [];
	var typeSels = [];
	var startDt = $("input[id$=sale_startDate1]").val();
	var endDt = $("input[id$=sale_endDate1]").val();
	var typeRowSel = [];
	var indexArr = [];
    // 有効な日付をチェックする
    var vStartDt = kendo.parseDate(startDt,JINYACONNECT.DateFormat);
    var vEndDt = kendo.parseDate(endDt,JINYACONNECT.DateFormat);
    if (vStartDt == null || vEndDt == null) {
        //開始日付、終了日付に有効な日付の値を入力してください。
    	alert("{!$Label.MSG_003_0016}");
    	return false;
    }
    // 期間チェック
    if (vStartDt > vEndDt ) {
      alert("{!$Label.ERR_0108}");
      return false;
    }
	$("input[name=weekOpts1]:checked",sch).each(function(){
		weekOpts.push($(this).val());
	});
	var dtRow = $("tr.headerRow").has("th[dt]").first();
	var startCol = dtRow.find("[dt='" + startDt + "']");
	indexArr.push({dt:startDt,index:startCol.index()});
	startCol.nextAll().each(function(){
		var col = $(this);
		var dt = col.attr("dt");
		if (dt != undefined) indexArr.push({dt:dt,index:col.index()});
	});
	// 2019/03/12 画面外の販売状態設定不正修正 by zy BEGIN
	// 画面外期間限定チェック
	var lastDt = indexArr[indexArr.length - 1].dt;
	if (endDt > lastDt) {
		// 今日
		var dt = kendo.toString(new Date(),JINYACONNECT.DateFormat);
		var begDt = $j("input.salesBtn:first").attr("date");
		var endDt = $j("input.salesBtn:last").attr("date");
		if (begDt < dt) begDt = dt;
	 	var alretMsg = '開始日付が「' + begDt + '」以後、終了日付が「' + endDt + '」以前の日付を設定してください。';
		alert(alretMsg);
		return false;
	}
	// 2019/03/12 画面外の販売状態設定不正修正 by zy END
	if (weekOpts.length == 0) {
        //曜日を選択してください
		alert("{!$Label.MSG_003_0015}");
		return false;
	}
	if (weekOpts.length > 0) {
		var remainCntMap = {};
		var diffRoomCntMap = {};
		$("tr.checkRows").each(function(){
			// 2019/05/30 控制在库未变更的数据过滤 BY zyz BEGIN
			var changeData= $('input.changeClass',this).val();
			if( changeData == undefined || changeData == "" || changeData == null ) return true;
			// 2019/05/30 控制在库未变更的数据过滤 BY zyz END
			var typeid = $(this).attr("typeid");
			typeSels.push(typeid);
			var roomCnt = 0;
			var diffCnt = 0;
			var curRow = $("tr.stockRow[typeid='" + typeid + "']");
			var cols = $(">td.dataCell",curRow);
			for (var i = 0 ; i < indexArr.length ; i++) {
				var arrObj = indexArr[i];
				var idx = arrObj.index;
				var dt = arrObj.dt;
				var curTd = cols.eq(idx);
				var roomInput = curTd.find(".roomInput");
				if (roomInput.length > 0) {
					var roomCnt = kendo.parseInt(roomInput.attr("rmngval"));
					if (roomCnt == null) roomCnt = 0; 
					var changeValue = kendo.parseInt($('input.valClass',this).val());
					if (changeValue == null) changeValue = 0;
					roomCnt += changeValue;
					var key = typeid + '_' + dt;
					remainCntMap[key] = kendo.parseInt(changeValue);
					diffRoomCntMap[key] = kendo.parseInt(roomCnt);
				}
			}
		});
		var reqObj = {
			beg:startDt,
			endDt:endDt,
			rtps:typeSels,
			weekOpts:weekOpts,
			remanMap:remainCntMap,
			diffRoomMap:diffRoomCntMap
		};
		$("input[id$=hidRequestJson]").val(JSON.stringify(reqObj));
		updateWeekOptsFun1();
	}
	panelHide();
}
// 在庫变更颜色等处理
function roomChange1(){
	// 該当入力対象
	var ect = event.currentTarget;
	// 前回入力値
	var val = $(ect).data("orgvalue");
	// 最大残室数
	var maxVal = $(ect).data("maxvalue");
	var newValue = kendo.parseInt(ect.value);
	// 負数チェック
	if (val < 0) val = 0;
	// 無効値チェック
	if (newValue == null || newValue < 0) {
		ect.value = val;
		newValue = val;
	// 最大数チェック
	} else if (newValue > maxVal) {
		ect.value = maxVal;
		newValue = maxVal;
	}
	// 変更チェック
	if (newValue != val) $(ect).addClass("changeClass");
	else $(ect).removeClass("changeClass");
}
// 在库取消按钮响应
function cancelChgStock1() {
	$j(".changeClass,.changed").each(function(){
		var val = $j(this).data("orgvalue");
		$j(this).val(val);
		$j(this).removeClass("changeClass changed");
	});
}
// 2019/04/30 予約ポップの在庫設定(AGT)の変更機能 BY zyz END
// 2019/10/30 予約ポップで表示されている残室数を期間指定してcsv出力 BY zyz BEGIN
function downloadCsv(){
	var modetype = $j("select[id$=':pageModeType']").val();
	var beginDt = "{!JSENCODE(dispHeaders[0].yyyymmdd)}";
	var endDt = "{!JSENCODE(dispHeaders[dispHeaders.size-1].yyyymmdd)}";
	var fileName = modetype + "_" + beginDt + "_" + endDt +".csv";
	// 予定表情報
	var gridCsv = generalCsvContentGrid('dTable');
	var realCsv = "";
	if (gridCsv != "" && $j("#dTableAgt").length > 0) realCsv = '\r\n\r\n'+generalCsvContentGrid('dTableAgt');
	// UTF8-SJISに変更
	var array = str2array(gridCsv + realCsv);
	var sjis_array = Encoding.convert(array, "SJIS", "UNICODE");
	var uint8_array = new Uint8Array(sjis_array);
	// Blob Create
	var blob = new Blob([uint8_array], { type: 'text/csv' }); //Blob.js
    //EXPORT TO BROWSER
    saveAs(blob, fileName); //FileSaver.js
}
var str2array = function(str) {
    var array = [],i,il=str.length;
    for (i=0; i<il; i++) array.push(str.charCodeAt(i));
    return array;
};
function generalCsvContentGrid(onetableId){
	// 数据Table
	var tableArray = $j("#"+onetableId).find('tr');
	// 数据内容
	var contentcsv = '';
	// AGTのTRAVEL名を格納する
	var travelName = "";
	// 循环TR行
	for (var y = 0; y < tableArray.length; y++) {
		// 隐藏行去除
		if(tableArray[y].closest("thead") != null) {
			if(tableArray[y].closest("thead").style.display == 'none') continue;
		}
		if(tableArray[y].style.display == 'none') continue;
		// 該当行目データ情報を取得する
		var trArray = tableArray[y].cells;
		var isdtline = tableArray[y].classList.contains("_firstrow");//該当行目は日付表示行目を判断する
		if(contentcsv != '') {
			contentcsv +='\r\n';
		}
		// 循环TD行
		for(var i = 0; i < trArray.length; i++){
			// 第一行日期特殊处理
			var opval = '';
			// 該当行目は日付行目の場合
			if (isdtline) {
				// 日付列の場合
				if(trArray[i].getAttribute("dt") != null) opval = trArray[i].getAttribute("dt");
				// 部屋タイプ名列場合
				else opval = trArray[i].outerText;
			// 数据处理
			} else {
				// AGTセクションCSV出力場合
				if (onetableId == "dTableAgt" && trArray[i].getAttribute("name") == "itemAgt") {
					var accVal = trArray[i].outerText;//旅行会社名
					var rtVal = trArray[i+1].outerText;//部屋タイプ名
					if(accVal == undefined || accVal == null || accVal == "") accVal = travelName;
					else travelName = accVal;
					if(rtVal == undefined || rtVal == null) rtVal = '';
					opval = rtVal+"("+accVal+")";
					// ２列一緒に処理を行う
					i++;
				}else{
					if(trArray[i].outerText != '') opval = trArray[i].outerText;
					else opval = $j("input[class=btn]",trArray[i]).val();
				}
			}
			if(opval == undefined || opval == null) opval = '';
			contentcsv += '"' + opval + '",';
		}
	}
	return contentcsv;
}
// 2019/10/30 予約ポップで表示されている残室数を期間指定してcsv出力 BY zyz END
// 2020/04/30 複数のプランとそれぞれのプランの人数を選択し機能対応 WGCH BEGIN
function isBasePlanMode(){
	var selPlanNm = $j("#hidPlanNm").val();
	var selAccId = $j("#hidPlanAccId").val();
	return selPlanNm != "" && selAccId != "";
}
function getSpcdCode(){
	// 指定日 // 支店コード
	return $j("select[id$=':branchShopCd']").length > 0 ? $j("select[id$=':branchShopCd']").val() : "";
}
function getTierMap(btn){
	var p1 = $j(btn).attr("stockDate");
	var entryDate = comDateFormat(new Date(p1), JINYACONNECT.DateFormat);
	var obj = {
		queryDt : entryDate,
		// 2021/06/31 #11821 bug fixed by zy BEGIN 
		// ベースプランの店舗コード区分
		// spcd : getSpcdCode(),
		spcd : getBasePlanCode(),
		// 2021/06/31 #11821 bug fixed by zy END 
		guestType :  $("[id$=planVipStr]").val(),
		typeId :  $j(btn).attr("roomTypeId")
	};
	blockUi();
	RoomTypeInventoryRemoteCenter('getTierMapInfo',JSON.stringify(obj),afterGetTierMap.bind({clickBtn : btn}));
}
function afterGetTierMap(result){
	let {clickBtn} = this;
	window.J_RACK_TIER_MAP = result;
	clickBtn.click.call(clickBtn);
	unblock();
}
function RoomTypeInventoryRemoteCenter(type,data,callback){
    Visualforce.remoting.Manager.invokeAction(
        "{!$RemoteAction.RoomTypeInventory.remoteCenter}", type,data, function(result, event){
            // 異常
            if(event.type == 'exception') {
            } else {}
            if (callback) callback(result,event);
    });
}
// 2020/04/30 複数のプランとそれぞれのプランの人数を選択し機能対応 WGCH END
// 2021/06/31 #11821 bug fixed by zy BEGIN 
function getBasePlanCode(){
	return $("#hidBaePlanShopCode").val();
}
// 2021/06/31 #11821 bug fixed by zy END
</script>
<!-- This component is added to show call register popup -->
<c:CallRegisterPopup ></c:CallRegisterPopup>
<!-- 2018/03/12 ラックレート部屋タイプ別の対応　by　zy　BEGIN -->
<div id="floatTierPanel">
	<div class="foot">
		<span class="roomFunBtn" onclick="cancelChgTier()">{!$Label.ps__msg_003_0073}</span>
		<span class="roomFunBtn" onclick="saveChangeTier()">{!$Label.ps__msg_003_0072}</span>
	</div>
</div>
<!-- 2018/03/12 ラックレート部屋タイプ別の対応　by　zy　END -->
<!-- 2020/11/30 リアルAGT増返室ボタン機能新規追加 WGCH BEGIN -->
<div id="floatAgtPanel">
	<div class="foot">
		<span class="agtFootBtn" onclick="agtRoomsCancelFun()">キャンセル</span>
		<span class="agtFootBtn" onclick="agtRoomsSaveFun()">保存</span>
	</div>
</div>
<!-- 2020/11/30 リアルAGT増返室ボタン機能新規追加 WGCH END -->
<!-- 2018/12/15 在庫調整と販売状態管理 by zy BEGIN -->
<style>
.taskScreen{
	z-index: 10004;
    border: none;
    margin: 0px;
    padding: 0px;
    width: 100%;
    height: 100%;
    top: 0px;
    left: 0px;
    background-color: rgb(0, 0, 0);
    opacity: 0.6;
    cursor: wait;
    position: fixed;
    display:none;
}
.taskContPanel{
	z-index: 10005;
	position: fixed;
	left: 30%;
	top:30%;
	background: rgb(255,255,255);
	display:none;
}
#deleteTaskPanel{
	z-index: 10005;
	position: fixed;
	left: 30%;
	top:40%;
	background: rgb(255,255,255);
	display:none;
}
.datePicker{
	z-index:10006;
}
div.bd{
    overflow: auto;
    padding: 10px;
    background-color: #f2f2f2;
    border-style: solid;
    border-width: 0 1px;
    border-color: #808080;
    margin: 0 -1px;
}
/* 2019/04/30 予約ポップの在庫設定(AGT)の変更機能 BY zyz BEGIN */
div.bdCls{
    overflow: auto;
    padding: 10px;
    background-color: #f2f2f2;
    border-width: 0 1px;
    border-color: #808080;
    margin: 0 -1px;
}
/* 2019/04/30 予約ポップの在庫設定(AGT)の変更機能 BY zyz END */
div.ft{
	text-align: right;
    border-top: solid 1px #808080;
    padding: 5px 10px;
    font-size: 77%;
    background-color: #f2f2f2;
}
</style>
<div class="taskScreen"></div>
<div class="taskContPanel">
<div id="salesSched" style="min-width: 480px;    overflow: hidden; " >
<!-- 2019/04/30 予約ポップの在庫設定(AGT)の変更機能 BY zyz BEGIN -->
  <!-- Header -->
  <apex:outputpanel rendered="{!!StockFlg}">
  <div class="hd" style="background: linear-gradient(to bottom, rgb(255,255,255) 10%, rgb(204,204,204) 80%);height:20px;">
  </div>
  </apex:outputpanel>
  <ul style="display:{!IF(StockFlg,'','none')};">
	<li name="sales" class="k-state-active">販売</li>
	<li name="stock" >在庫</li>
</ul>
  <div>
<!-- 2019/04/30 予約ポップの在庫設定(AGT)の変更機能 BY zyz END -->
  <apex:form >
  <!-- Body -->
  <!-- 2019/04/30 予約ポップの在庫設定(AGT)の変更機能 BY zyz BEGIN -->
  <div class="bdCls" >
  <!-- 2019/04/30 予約ポップの在庫設定(AGT)の変更機能 BY zyz END -->
	  <!-- Message Panel Block -->        
	  <apex:outputPanel id="scheduleMessagePanel">
	    <apex:pageMessages id="inputTierFormMsg"/>
	  </apex:outputPanel>
	 <table>
	  	<col style="width: 80px;" />
	  	<col style="width: 90px;" />
	  	<col style="width: 350px;" />
	  	<tr style="vertical-align: top;">
	  	<td colspan="2"/>
	  	<td >
		  	<select id="salesSel">
	  			<option value="1">{!STOCK_SETTYPE_SALE}</option>
	  			<option value="2">{!STOCK_SETTYPE_STOP}</option>
		  	</select>
	  	<!-- 2018/03/12 ラックレート部屋タイプ別の対応　by　zy　BEGIN -->
	  	<span>全て<input type='checkbox' id="rtpCheckBox" checked="checked" onclick="changeSelectRm(this)"/></span>
	  	<!-- 2018/03/12 ラックレート部屋タイプ別の対応　by　zy　END -->
	  	</td>
	  	</tr>
	  	<tr style="vertical-align: top;">
        <!-- 頻度 -->
	  	<td style="text-align: right;"><span style="margin-right: 10px;margin-top: 14px;">{!$Label.MSG_003_0075}</span></td>
	  	<td>
            <!-- 毎週 -->
	  		<label>{!$Label.MSG_003_0076}</label> 
	  		<input type="radio" name="repeatDayType" value="week" checked="checked"/>
	  		<br/>
	  		<br/>
	  	</td>
	  	<td>
	  	<!-- 2018/03/12 ラックレート部屋タイプ別の対応　by　zy　BEGIN -->
  		<div style="background-color: white;position: relative;" class="weekBlock">
  		<!-- 2018/03/12 ラックレート部屋タイプ別の対応　by　zy　END -->
  		<table style="margin-left:0px;border-spacing: 0px;border-width: 0px;table-layout: fixed;">
			<tr>
			   <td>
            <!-- 月曜 -->
	  		<label for="Monday">{!$Label.MSG_003_0077}</label> 
	  		   </td>
	  		   <td>
	  		<input type="checkbox" value="Monday" name="weekOpts"/>
  			   </td>
			</tr>
			<tr>
			   <td>
            <!-- 火曜 -->
	  		<label for="Tuesday">{!$Label.MSG_003_0078}</label> 
	  		 </td>
	  		   <td>
	  		<input type="checkbox" value="Tuesday" name="weekOpts"/>
  			   </td>
			</tr>
			<tr>
			   <td>
            <!-- 水曜 -->
	  		<label for="Wednesday">{!$Label.MSG_003_0079}</label> 
	  		 </td>
	  		   <td>
	  		<input type="checkbox" value="Wednesday" name="weekOpts"/>
  			   </td>
			</tr>
			<tr>
			   <td>
            <!-- 木曜 -->
	  		<label for="Thursday">{!$Label.MSG_003_0080}</label> 
	  		 </td>
	  		   <td>
	  		<input type="checkbox" value="Thursday" name="weekOpts"/>
  			   </td>
			</tr>
			<tr>
			   <td>
            <!-- 金曜 -->
	  		<label for="Friday">{!$Label.MSG_003_0081}</label> 
	  		 </td>
	  		   <td>
	  		<input type="checkbox" value="Friday" name="weekOpts"/>
  			   </td>
			</tr>
			<tr>
			   <td>
            <!-- 土曜 -->
	  		<label for="Saturday">{!$Label.MSG_003_0082}</label> 
	  		 </td>
	  		   <td>
	  		<input type="checkbox" value="Saturday" name="weekOpts"/>
  			   </td>
			</tr>
			<tr>
			   <td>
            <!-- 日曜 -->
	  		<label for="Sunday">{!$Label.MSG_003_0083}</label> 
	  		 </td>
	  		   <td>
	  		<input type="checkbox" value="Sunday" name="weekOpts"/>
  		   </td>
			</tr>
			<tr>
			   <td colspan="2">
			 <!-- に繰り返し -->{!$Label.MSG_003_0084}
			    </td>
			</tr>
			</table>
			<!-- 2018/03/12 ラックレート部屋タイプ別の対応　by　zy　BEGIN  -->
			<div class="roomtypepanel">
				<table cellspacing='0'>
					<apex:repeat var="typesobj" value="{!roomTypeLst}">
						<tr class="checkRow" name="{!typesobj.id}" onclick="onTierRoomTypeClick(this)">
							<td>
								<input type='checkbox' name='roomTypeSel' checked='checked' />
								{!typesobj.name}
							</td>
						</tr>
					</apex:repeat>
				</table>
			</div>
			<!-- 2018/03/12 ラックレート部屋タイプ別の対応　by　zy　END  -->
  		</div>
  		</td>
	  	</tr>
	  	<tr><td colspan="3" style="height: 10px">&nbsp;</td></tr>
	  	<tr>
	  	<td style="text-align: right;margin-right: 5px"><!-- 開始日付 -->{!$Label.MSG_003_0092}</td>
	  	<td colspan="2">
	  	<apex:inputField id="sale_startDate" value="{!workSobj.StartDate__c}" style="font-size: 14px; width: 90px;" onblur="dateFormatFun(this)"/>
	  	</td>
	  	</tr>
	  	<tr>
	  	<td style="text-align: right;margin-right: 5px"><!-- 終了日付 -->{!$Label.MSG_003_0093}</td>
	  	<td colspan="2">
	  	<apex:inputField id="sale_endDate" value="{!workSobj.StartDate__c}" style="font-size: 14px; width: 90px;" onblur="dateFormatFun(this)"/>
	  	</td>
	  	</tr>
  	</table>
  </div>
  <!-- Footer -->
  <div class="ft" >
    <apex:outputPanel layout="block">
        <div style="text-align: right;" >
          <!-- 保存 -->
          <input type="button" value="{!$Label.MSG_003_0072}" 		class="btn" style="width:100px" 	onclick="salesSavePanel()"/>
          <!-- キャンセル -->
          <input type="button" value="{!$Label.MSG_003_0073}" class="btn" style="width: 100px" 	onclick="panelHide()" />
        </div>
    </apex:outputPanel>
  </div>
  </apex:form>
  <!-- 2019/04/30 予約ポップの在庫設定(AGT)の変更機能 BY zyz BEGIN -->
  </div>
  <div style="display:{!IF(StockFlg,'','none')};">
  <apex:form id="StockForm">
  <!-- Body -->
  <div class="bdCls" >
	  <!-- Message Panel Block -->        
	  <apex:outputPanel id="scheduleMessagePanel">
	    <apex:pageMessages id="inputTierFormMsg"/>
	  </apex:outputPanel>
	 <table>
	  	<col style="width: 80px;" />
	  	<col style="width: 90px;" />
	  	<col style="width: 350px;" />
	  	<tr style="vertical-align: top;">
	  	<td colspan="2" />
	  	</tr>
	  	<tr style="vertical-align: top;">
        <!-- 頻度 -->
	  	<td style="text-align: right;"><span style="margin-right: 10px;margin-top: 14px;">{!$Label.MSG_003_0075}</span></td>
	  	<td>
            <!-- 毎週 -->
	  		<label>{!$Label.MSG_003_0076}</label> 
	  		<input type="radio" name="repeatDayType" value="week" checked="checked"/>
	  		<br/>
	  		<br/>
	  	</td>
	  	<td>
	  	<!-- 2018/03/12 ラックレート部屋タイプ別の対応　by　zy　BEGIN -->
  		<div style="background-color: white;position: relative;" class="weekBlock1">
  		<!-- 2018/03/12 ラックレート部屋タイプ別の対応　by　zy　END -->
  		<table style="margin-left:0px;border-spacing: 0px;border-width: 0px;table-layout: fixed;">
			<tr>
			   <td>
            <!-- 月曜 -->
	  		<label for="Monday">{!$Label.MSG_003_0077}</label> 
	  		   </td>
	  		   <td>
	  		<input type="checkbox" value="Monday" name="weekOpts1"/>
  			   </td>
			</tr>
			<tr>
			   <td>
            <!-- 火曜 -->
	  		<label for="Tuesday">{!$Label.MSG_003_0078}</label> 
	  		 </td>
	  		   <td>
	  		<input type="checkbox" value="Tuesday" name="weekOpts1"/>
  			   </td>
			</tr>
			<tr>
			   <td>
            <!-- 水曜 -->
	  		<label for="Wednesday">{!$Label.MSG_003_0079}</label> 
	  		 </td>
	  		   <td>
	  		<input type="checkbox" value="Wednesday" name="weekOpts1"/>
  			   </td>
			</tr>
			<tr>
			   <td>
            <!-- 木曜 -->
	  		<label for="Thursday">{!$Label.MSG_003_0080}</label> 
	  		 </td>
	  		   <td>
	  		<input type="checkbox" value="Thursday" name="weekOpts1"/>
  			   </td>
			</tr>
			<tr>
			   <td>
            <!-- 金曜 -->
	  		<label for="Friday">{!$Label.MSG_003_0081}</label> 
	  		 </td>
	  		   <td>
	  		<input type="checkbox" value="Friday" name="weekOpts1"/>
  			   </td>
			</tr>
			<tr>
			   <td>
            <!-- 土曜 -->
	  		<label for="Saturday">{!$Label.MSG_003_0082}</label> 
	  		 </td>
	  		   <td>
	  		<input type="checkbox" value="Saturday" name="weekOpts1"/>
  			   </td>
			</tr>
			<tr>
			   <td>
            <!-- 日曜 -->
	  		<label for="Sunday">{!$Label.MSG_003_0083}</label> 
	  		 </td>
	  		   <td>
	  		<input type="checkbox" value="Sunday" name="weekOpts1"/>
  		   </td>
			</tr>
			<tr>
			   <td colspan="2">
			 <!-- に繰り返し -->{!$Label.MSG_003_0084}
			    </td>
			</tr>
			</table>
			<!-- 2018/03/12 ラックレート部屋タイプ別の対応　by　zy　BEGIN  -->
			<div class="roomtypepanel1">
				<table cellspacing='0' id="checkRowTable">
					<apex:repeat var="typesobj" value="{!roomTypeLst}">
						<tr class="checkRows" name="{!typesobj.id}" typeid="{!typesobj.id}" >
							<td style="width:15px;text-align: center;"><apex:outputText id="roomTypeStocklabel"  /></td>
							<td>→</td>
							<td>
								<input type="text" class="valClass" style="width:30px;" onchange="roomChange1()" name="roomTypeStock_{!typesobj.id}" value="0" data-orgvalue="0" data-maxvalue="0" data-rmngval="0"></input>
								<input type="hidden" style="width:30px;" name="roomTypeStockstockName" value="0"></input>
							</td>
							<td>
								{!typesobj.name}
							</td>
						</tr>
					</apex:repeat>
				</table>
			</div>
			<!-- 2018/03/12 ラックレート部屋タイプ別の対応　by　zy　END  -->
  		</div>
  		</td>
	  	</tr>
	  	<tr><td colspan="3" style="height: 10px">&nbsp;</td></tr>
	  	<tr>
	  	<td style="text-align: right;margin-right: 5px"><!-- 開始日付 -->{!$Label.MSG_003_0092}</td>
	  	<td colspan="2">
	  	<apex:inputField id="sale_startDate1" value="{!workSobj.StartDate__c}" style="font-size: 14px; width: 90px;" onblur="dateFormatFun(this)"/>
	  	</td>
	  	</tr>
	  	<tr>
	  	<td style="text-align: right;margin-right: 5px"><!-- 終了日付 -->{!$Label.MSG_003_0093}</td>
	  	<td colspan="2">
	  	<apex:inputField id="sale_endDate1" value="{!workSobj.StartDate__c}" style="font-size: 14px; width: 90px;" onblur="dateFormatFun(this)"/>
	  	</td>
	  	</tr>
  	</table>
  </div>
  <!-- Footer -->
  <div class="ft" >
    <apex:outputPanel layout="block">
        <div style="text-align: right;" >
          <!-- 保存 -->
          <input type="button" value="{!$Label.MSG_003_0072}" 		class="btn" style="width:100px" 	onclick="salesSavePanel1()"/>
          <!-- キャンセル -->
          <input type="button" value="{!$Label.MSG_003_0073}" class="btn" style="width: 100px" 	onclick="panelHide()" />
        </div>
    </apex:outputPanel>
  </div>
  </apex:form>
  </div>
  <!-- 2019/04/30 予約ポップの在庫設定(AGT)の変更機能 BY zyz END -->
  </div>
</div>
<!-- 2018/12/15 在庫調整と販売状態管理 by zy END -->
<!-- 2021/03/31 予約ポップやルームインジケータから予約作成する際に郵便番号検索が使えるようにして欲しい by zy BEGIN -->
<c:ZipCodeSearchComp />
<!-- 2021/03/31 予約ポップやルームインジケータから予約作成する際に郵便番号検索が使えるようにして欲しい by zy END -->
</apex:page>